---
title: "Codebook draft for DBS and BIO vars"
author: "Shaina Trevino"
date: "2023-12-15"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

if (!require("pacman")) install.packages("pacman")

pacman::p_load(readxl, here, tidyverse, openxlsx, gt, tidyverse, scales, ggpubr)

```

```{r import, include = FALSE}
#Import DBS file
#file path
dbs_fp <- here("do_not_push", "dbs_archive.xlsx")

#import data from all tabs
dbs_cho_df <- read_excel(dbs_fp, sheet = "CHO") 

dbs_hdl_df <- read_excel(dbs_fp, sheet = "HDL") 

dbs_trg_df <- read_excel(dbs_fp, sheet = "TRG")

dbs_crp_df <- read_excel(dbs_fp, sheet = "CRP")

dbs_ebv_df <- read_excel(dbs_fp, sheet = "EBV")

dbs_a1c_df <- read_excel(dbs_fp, sheet = "A1c")

dbs_il6_df <- read_excel(dbs_fp, sheet = "IL6")

#import BIO assessment file
bio_df <- read_excel(here("do_not_push", "bio_archive.xlsx"))
#import meta data for variable tables
bio_md <- read_excel(here("do_not_push", "bio_metadata_archive.xlsx")) %>% 
  rename(Variable = DATA,
         Description = `Variable description`)

```

```{r DELETE}
#COPIED FROM CODEBOOK SO THIS WILL RENDER WITH SAME FORMAT/THEME - DELETE WHEN INTEGRATING INTO FULL CODEBOOK
source(here("functions", "codebook_fun.R"))

# Color palettes 
 Two_color = c("#246B69", "#604C41")

# Histogram style 
# hist_style <- geom_histogram(bins=20, color = "white", fill = "#246B69", alpha = 0.7)


bar_style <- geom_bar(color = "white", fill = "#246B69", alpha = 0.7)

THEME <-     theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(fill = "transparent"),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black",size = .8),
          axis.text = element_text(size = 10), axis.title = element_text(size = 10),
          legend.text = element_text(size = 10),legend.key = element_rect(fill = "White", colour = "transparent"),plot.title = element_text(size= 13),
    )

#re-work JP cutoff function due to error "cant use `{{` in non-quoting function
cutoff_plot2 <- function(data,
                        x,
                        cutoff = 0,
                        cutoff_color = '#324B4A',
                        cutoff_other = NULL,
                        cutoff_other_color = '#95B1AF',
                        cutoff_other2 = NULL,
                        cutoff_other2_color = '#546085',
                        bins = 20) {

  library(magrittr)
  library(dplyr)
  library(ggplot2)

  x <- enquo(x)

  if (is.null(cutoff_other)) {
    data %>%
      ggplot(aes(!!x)) +
      geom_histogram(bins = bins,
                     color = 'white',
                     fill = '#246B69',
                     alpha = .7) +
      geom_vline(xintercept = cutoff,
                 color = cutoff_color,
                 linetype = 2,
                 linewidth = 1.25)+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(fill = "transparent"),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black",size = .8),
          axis.text = element_text(size = 10), axis.title = element_text(size = 10),
          legend.text = element_text(size = 10),
          legend.key = element_rect(fill = "White",
                                    colour = "transparent"),
          plot.title = element_text(size= 20),
          #scale_x_discrete(guide = guide_axis(n.dodge=3))
    )
  } else if (is.null(cutoff_other2)) {
    data %>%
      ggplot(aes(!!x)) +
      geom_histogram(bins = bins,
                     color = 'white',
                     fill = '#246B69',
                     alpha = .7) +
      geom_vline(xintercept = cutoff,
                 color = cutoff_color,
                 linetype = 2,
                 linewidth = 1.25) +
      geom_vline(xintercept = cutoff_other,
                 color = cutoff_other_color,
                 linetype = 3,
                 linewidth = 1.25)+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(fill = "transparent"),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black",size = .8),
          axis.text = element_text(size = 10), axis.title = element_text(size = 10),
          legend.text = element_text(size = 10),
          legend.key = element_rect(fill = "White",
                                    colour = "transparent"),
          plot.title = element_text(size= 13),
          #scale_x_discrete(guide = guide_axis(n.dodge=3))
    )
  } else {
    data %>%
      ggplot(aes(!!x)) +
      geom_histogram(bins = bins,
                     color = 'white',
                     fill = 'black',
                     alpha = .7) +
      geom_vline(xintercept = cutoff,
                 color = cutoff_color,
                 linetype = 2,
                 linewidth = 1.25) +
      geom_vline(xintercept = cutoff_other,
                 color = cutoff_other_color,
                 linetype = 3,
                 linewidth = 1.25) +
      geom_vline(xintercept = cutoff_other2,
                 color = cutoff_other2_color,
                 linetype = 4,
                 linewidth = 1.25)+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(fill = "transparent"),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black",size = .8),
          axis.text = element_text(size = 10), axis.title = element_text(size = 10),
          legend.text = element_text(size = 10),
          legend.key = element_rect(fill = "White",
                                    colour = "transparent"),
          plot.title = element_text(size= 13),
          #scale_x_discrete(guide = guide_axis(n.dodge=3))
    )
  }
}

# gt-theme-general
apply_tbl_theme <- function(table) {
  table %>% 
  tab_style(style = list(cell_borders(sides = "all", color = "black", weight = px(1))),
            locations = cells_body(columns = everything())) %>% 
  tab_style(style = list(cell_borders(sides = "all", color = "black", weight = px(1)),
                         cell_fill(color = "#246B69", alpha = .7)),
            locations = cells_column_labels()) %>% 
  tab_options(column_labels.border.top.color = "black",
              column_labels.border.bottom.color = "black",
              table_body.border.bottom.color = "black",
              table.border.top.color = "white",
              heading.border.bottom.color = "black",
              table_body.hlines.color = "white")%>% 
  tab_options(table.align = "left")
}

#theme for value label tables
apply_labtab_theme <- function(table) {
  table %>% 
  cols_align(columns = everything(), align = "center") %>% 
  tab_style(style = list(cell_borders(sides = "all", color = "black", weight = px(1))),
            locations = cells_body(columns = everything())) %>% 
  tab_style(style = list(cell_borders(sides = "all", color = "black", weight = px(1)),
                         cell_fill(color = "#246B69", alpha = .7)),
            locations = cells_column_labels()) %>% 
  tab_options(column_labels.border.top.color = "black",
              column_labels.border.bottom.color = "black",
              table_body.border.bottom.color = "black",
              table.border.top.color = "white",
              heading.border.bottom.color = "black",
              table_body.hlines.color = "white") %>% 
  tab_options(table.align = "left")
}

```


# Allostatic Load Assessment

*<MARIA> INSERT BRIEF DESCRIPTION ABOUT CONSTRUCT DOMAIN (includes DBS and bio assessment data)*

## Dried Blood Spot Data Collection

These data are in the `dbs_archive.xlsx` file where each construct domain is a separate tab. 

*<MARIA, insert brief description about DBS assessment/construct domain and how it was measured>* 

The seven biological constructs assessed were cholesterol, high-density lipoprotein cholesterol, Triglycerides, c-reactive protein, Epstein-Barr virus, hemoglobin A1C, and Interleukin-6.. 

For each biological construct, allostatic load indicators were calculated based on *<MARIA INSERT, include difference between AL and percentile AL indicator if possible>.*

*<MARIA, insert any references to include here (or only for composite scores?)>*

### Cholesterol (CHO) Description

These data include variables related to the cholesterol assessment, including direct and plasma equivalent (PE) cholesterol values for participants. Higher values indicate higher cholesterol. The PE cholesterol value was used to calculate allostatic load indicators.

The missing data rule was not applied since composite variables were based on a single item. Missing data for each variable is presented in the descriptive statistics table below.

Reference: *<MARIA> INSERT REF if applicable*


#### Value Labels

The value labels for all `_note` variables (`cho_punch_note`, `cho_assay_note`, and `cho_result_note`) are below: 

```{r CHO-label-table, results = 'asis'}

cho_label_df <- data.frame(
  value = c("1", "4", "5", "37", "42"),
  label = c("Blank punch",
            "Small spot, <80%",
            "Non-circular dried blood spot",
            "Punch did not elute",
            "Blood from filter paper touched inside back cover")
) %>% 
  t() %>% 
  as.data.frame()

cho_label_df <- setNames(cho_label_df[-1, ], unlist(cho_label_df[1, ]))


#create table
cho_label_table <- cho_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(cho_label_table)

```


Allostatic load indicators, `cho_cal` and `cho_pal` are dichotomous:

```{r CHO-dichot-value, results = 'asis'}
#create dichotomous table to be re-used
dichot_label_df <- data.frame(
  value = c("0", "1"),
  label = c("No",
            "Yes")
) %>% 
  t() %>% 
  as.data.frame()

dichot_label_df <- setNames(dichot_label_df[-1, ], unlist(dichot_label_df[1, ]))


#create table
dichot_label_table <- dichot_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(dichot_label_table)

```


#### Variables

All CHO variables are presented in the following table.

```{r CHO-var-table, results = 'asis'}
#create table of info
cho_var_df <- data.frame(
  Variable = c("dbs_id", "family", "cho_direct", "cho_pe", "cho_punch_note", "cho_assay_note", "cho_result_note", 
            "cho_plate", "cho_date", "cho_cal", "cho_pal"),
  Description = c("Unique ID for each assay",
            "Participant ID",
            "Direct cholesterol analyte concentrate obtained from dried blood spot",
            "Plasma-equivalent cholesterol analyte concentration",
            "Note made by technician during sample preparation (punching)",
            "Note made by technician during assay",
            "Note indicating reportability of values",
            "ID for the plate used during assay",
            "Date of assay",
            "Clinical allostatic load indicator for out-of-range cholesterol",
            "Percentile-based allostatic load indicator for out-of-range cholesterol")) %>% 
  mutate(Notes = ifelse(grepl("_note", Variable), "When multiple notes were provided, they are separated by a semi-colon", ""))

#create gt table
cho_var_table <- cho_var_df %>%
  gt() %>% 
apply_tbl_theme() %>% 
  cols_width(Description ~ px(300),
             Variable ~ px(100)
             ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

#print table
print(cho_var_table)

```

#### Composite Variables

Using the plasma-equivalent cholesterol value, two allostatic load indicators were calculated. One based on the clinical cut-off for high cholesterol (`cho_cal`) and the other is a percentile-based cut-off for high cholesterol (`cho_pal`) defined as the top 25% of cholesterol values. 

```{r CHO-subscale-table, results = 'asis'}
#create table of info for AL indicators
cho_scale_df <- data.frame(
  var_name = c("cho_cal", "cho_pal"),
  scale = c("Allostatic load indicator based on clinical cut-off  for high cholesterol (1)",
            "Allostatic load indicator based on top 25% of cholesterol values (1)"),
  scale_construction = c("`cho_pe` > 199", 
                         "Top 25% of observed `cho_pe` values"),
  scale_range = c("0-1", "0-1"))

#create gt table
cho_scale_table <- cho_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  #cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme() 

#print table
print(cho_scale_table)

```

#### Descriptive Statistics

Descriptive statistics are presented below for key CHO variables.

**Raw cholesterol values:** 

```{r cho-cont-summary-table, results = 'asis'}
#create function for calculating continuous summary statistics
calc_cont_sum_stats <- function(df) {
  stats_list <- lapply(names(df), function(name) {
    x <- df[[name]]
    mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
    sd_val <- round(sd(x, na.rm = TRUE), 2)
    range_val <- paste(round(min(x, na.rm = TRUE), 2),
                       round(max(x, na.rm = TRUE), 2), sep = "-")
    miss_val <- round(mean(is.na(x)) * 100, 2)
    data.frame(Variable = name, Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
  })
  stats_df <- do.call(rbind, stats_list)
  return(stats_df)
}


#apply function to calculate summary stats
cho_sum_df <- dbs_cho_df %>% 
  select(cho_direct, cho_pe) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% 
  calc_cont_sum_stats()

#create gt table
cho_sum_tbl <- cho_sum_df  %>%
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
cho_sum_tbl

```

**Allostatic load indicators:** 

```{r cho-dichot-summary-table, results = 'asis'}
#create function for calculating dichotomous summary statistics
calc_dichot_sum_stats <- function(df) {
  stats_list <- lapply(names(df), function(name) {
    x <- df[[name]]
    per_no <- paste0(round(sum(x == 0, na.rm = TRUE) / length(x) *100, 1), "%")
    per_yes <- paste0(round(sum(x == 1, na.rm = TRUE) / length(x) *100, 1), "%")
    num_no <- sum(x == 0, na.rm = TRUE)
    num_yes <-sum(x == 1, na.rm = TRUE)
    miss_val <- round(mean(is.na(x)) * 100, 2)
    data.frame(Variable = name, per_no = per_no, per_yes = per_yes, num_no = num_no, num_yes = num_yes, Missing = paste(miss_val, "%", sep = ""))
  })
  stats_df <- do.call(rbind, stats_list)
  return(stats_df)
}

#apply function to calculate summary stats
cho_dichot_df <- dbs_cho_df %>% 
  select(cho_cal, cho_pal) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% 
  calc_dichot_sum_stats()

#create gt table
cho_tbl_dichot <- cho_dichot_df %>%
  gt() %>%
  cols_label(num_no = "N",
             per_no = "%",
             num_yes = "N",
             per_yes = "%",
             Missing = "% Missing") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("per_no", "per_yes", "num_no", "num_yes", "Missing"), align = "center") %>% 
  tab_spanner(label = "No", columns = c(num_no, per_no)) %>% 
  tab_spanner(label = "Yes", columns = c(num_yes, per_yes)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(num_yes, num_no, per_yes, per_no))) 

# Render the table
cho_tbl_dichot

```

**Data collection notes:** 

```{r cho-cat-summary-table, results = 'asis'}
#create function to process columns with multiple responses
calc_multi_column <- function(column, responses) {
  responses_list <- strsplit(as.character(column), ";")
  flat_responses <- unlist(responses_list)
  flat_responses <- trimws(flat_responses)  # Remove leading/trailing spaces
  
  # Modify to include -55 as a valid response
  valid_responses <- flat_responses[flat_responses %in% c(responses, "-55")]

  count_response <- function(response) {
    sum(valid_responses == response, na.rm = TRUE)
  }

  total_valid_responses <- length(valid_responses)

  response_counts <- sapply(c(responses, "-55"), count_response)
  response_percents <- round(response_counts / total_valid_responses * 100, 1)

  data.frame(
    Response = c(responses, "-55"),
    Count = response_counts,
    Percent = response_percents,
    stringsAsFactors = FALSE
  )
}

#notes for cho_df
cho_notes <- c(1, 4, 5, 37, 42)

cho_note_df <- dbs_cho_df %>% 
  select(ends_with("note"))

#apply function to each note column
cho_note_list <- lapply(cho_note_df, function(column) calc_multi_column(column, cho_notes))

#combine results into df
cho_note_sum <- bind_rows(cho_note_list, .id = "Variable") %>% 
  pivot_wider(names_from = Response, values_from = c(Count, Percent)) %>% 
  mutate(across(starts_with("Percent"), ~ paste0(.x, "%"))) %>% 
  select(-`Count_-55`)

#create gt table
cho_tbl_notes <- cho_note_sum %>%
  gt() %>%
  cols_label(Count_1 = "N",
             Count_4 = "N",
             Count_5 = "N",
             Count_37 = "N",
             Count_42 = "N",
             Percent_1 = "%",
             Percent_4 = "%",
             Percent_5 = "%",
             Percent_37 = "%",
             Percent_42 = "%",
             `Percent_-55` = "% NA*") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Count_1", "Count_4", "Count_5", "Count_37", "Count_42", "Percent_1",
                         "Percent_4", "Percent_5", "Percent_37", "Percent_42", "Percent_-55"), align = "center") %>% 
  tab_spanner(label = "Blank punch",  columns =  c(Count_1, Percent_1)) %>% 
  tab_spanner(label = "Small spot,",  columns =  c(Count_4, Percent_4)) %>% 
  tab_spanner(label = "Non-circular",  columns = c(Count_5, Percent_5)) %>% 
  tab_spanner(label = "Did not elute", columns = c(Count_37, Percent_37)) %>% 
  tab_spanner(label = "Touched cover", columns = c(Count_42, Percent_42)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  tab_footnote(footnote = "*NA = Not Applicable") %>%
  tab_options(table.border.bottom.style = "hidden") %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(Count_1, Percent_1, Count_4, Percent_4,
                                                        Count_5, Percent_5, Count_37, Percent_37,
                                                        Count_42, Percent_42))) 

# Render the table
print(cho_tbl_notes) 



```

#### Distributions

Distributions are presented below for the allostatic load indicators.

```{r cho-dist-plots}
#create function to create plot for AL indicators
create_AL_plot <- function(data, column_name, composite_name) {
  #transform values to labels
  transform_AL_plot <- function(x) {
    factor(x, levels = c("0", "1", "-99"), labels = c("No", "Yes", "Missing"))
  }

  #ensure that column_name is a character and exists in the dataframe
  if (!is.character(column_name) || !column_name %in% names(data)) {
    stop("column_name must be a character string and exist in the dataframe.")
  }
  
  #create plot
  data %>%
    mutate("{column_name}" := transform_AL_plot(.[[column_name]])) %>%
    ggplot(aes_string(x = column_name)) +
    bar_style +
    labs(x = "Response", y = "Count", title = paste("Distribution for", composite_name)) +
    THEME
}


#cho_cal
p_cho_cal <- create_AL_plot(dbs_cho_df, "cho_cal", "CHO Clinical \nAllostatic Load (AL) Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#cho_pal
p_cho_pal <- create_AL_plot(dbs_cho_df, "cho_pal", "CHO Percentile- \nDetermined AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_cho_cal, p_cho_pal)

```

#### Clinical Categories

The distribution for plasma-equivalent cholesterol values (`cho_pe`) alongside the clinical and percentile-determined allostatic load cutoffs are presented below.

```{r cho-clinical-plot}
dbs_cho_df %>%
  filter(cho_pe != "-99") %>% 
  mutate(cho_pe = as.numeric(cho_pe)) %>% 
  cutoff_plot2(
    x = cho_pe,
    cutoff = 200,
    cutoff_other = 171.5
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for CHO',
    caption = 'Clinical cutoff is 200 and \n percentile-determined cutoff is 172.'
  )+
  annotate("text", x = 160, y = 18.5, label = "Percentile") +
  annotate("text", x = 209, y = 18.5, label = "Clinical")

```


### High-Density Lipoprotein Cholesterol (HDL) Description

These data include variables related to the HDL cholesterol assessment, including direct and plasma equivalent (PE) HDL cholesterol values for participants. Higher values indicate higher HDL cholesterol. The PE value was used to calculate allostatic load indicators.

*<MARIA> INSERT INFO RE: LOWER HDL IS WORSE (FOR AL INDICATOR) if desired - since HDL AL indicator is based off low values vs higher values in other variables*

The missing data rule was not applied since composite variables were based on a single item. Missing data for each variable is presented in the descriptive statistics table below.

Reference: *<MARIA> INSERT REF if applicable*


#### Value Labels

The value labels for all `_note` variables (`hdl_punch_note`, `hdl_assay_note`, and `hdl_result_note`) are below: 

```{r hdl-label-table, results = 'asis'}
#same notes as cho vars
# Print the table
print(cho_label_table)

```

Allostatic load indicators, `hdl_cal` and `hdl_pal` are dichotomous:

```{r hdl-dichot-value, results = 'asis'}
# Print the table
print(dichot_label_table)

```

#### Variables

All HDL variables are presented in the following table.

```{r hdl-var-table, results = 'asis'}
#create table of info
hdl_var_df <- data.frame(
  Variable = c("dbs_id", "family", "hdl_direct", "hdl_pe", "hdl_punch_note", "hdl_assay_note", "hdl_result_note", 
            "hdl_plate", "hdl_date", "hdl_cal", "hdl_pal"),
  Description = c("Unique ID for each assay",
            "Participant ID",
            "Direct HDL cholesterol analyte concentrate obtained from dried blood spot",
            "Plasma-equivalent HDL cholesterol analyte concentration",
            "Note made by technician during sample preparation (punching)",
            "Note made by technician during assay",
            "Note indicating reportability of values",
            "ID for the plate used during assay",
            "Date of assay",
            "Clinical allostatic load indicator for out-of-range HDL cholesterol",
            "Percentile-based allostatic load indicator for out-of-range HDL cholesterol")) %>% 
  mutate(Notes = ifelse(grepl("_note", Variable), "When multiple notes were provided, they are separated by a semi-colon", ""))

#create gt table
hdl_var_table <- hdl_var_df %>%
  gt() %>% 
apply_tbl_theme() %>% 
  cols_width(Description ~ px(300),
             Variable ~ px(100)
             ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

#print table
print(hdl_var_table)

```

#### Composite Variables

Using the plasma-equivalent HDL cholesterol value, two allostatic load indicators were calculated. One based on the clinical cut-off for high HDL cholesterol (`hdl_cal`) and the other is a percentile-based cut-off for high HDL cholesterol (`hdl_pal`) defined as the top 25% of HDL cholesterol values. 

```{r hdl-subscale-table, results = 'asis'}
#create table of info for AL indicators
hdl_scale_df <- data.frame(
  var_name = c("hdl_cal", "hdl_pal"),
  scale = c("Allostatic load indicator based on clinical cut-off  for high HDL cholesterol (1)",
            "Allostatic load indicator based on top 25% of HDL cholesterol values (1)"),
  scale_construction = c("`hdl_pe` < 40", 
                         "Bottom 25% of observed `hdl_pe` values"),
  scale_range = c("0-1", "0-1"))

#create gt table
hdl_scale_table <- hdl_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  #cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme() 

#print table
print(hdl_scale_table)

```


#### Descriptive Statistics

Descriptive statistics are presented below for key HDL variables.

**Raw HDL cholesterol values:** 

```{r hdl-cont-summary-table, results = 'asis'}
#apply function to calculate summary stats
hdl_sum_df <- dbs_hdl_df %>% 
  select(hdl_direct, hdl_pe) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% # warning due to <10 response
  calc_cont_sum_stats()

#create gt table
hdl_sum_tbl <- hdl_sum_df  %>%
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
hdl_sum_tbl

```

**Allostatic load indicators:**  

```{r hdl-dichot-summary-table, results = 'asis'}

#apply function to calculate summary stats
hdl_dichot_df <- dbs_hdl_df %>% 
  select(hdl_cal, hdl_pal) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% 
  calc_dichot_sum_stats()

#create gt table
hdl_tbl_dichot <- hdl_dichot_df %>%
  gt() %>%
  cols_label(num_no = "N",
             per_no = "%",
             num_yes = "N",
             per_yes = "%",
             Missing = "% Missing") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("per_no", "per_yes", "num_no", "num_yes", "Missing"), align = "center") %>% 
  tab_spanner(label = "No", columns = c(num_no, per_no)) %>% 
  tab_spanner(label = "Yes", columns = c(num_yes, per_yes)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(num_yes, num_no, per_yes, per_no))) 

# Render the table
hdl_tbl_dichot

```

**Data collection notes:** 

```{r hdl-cat-summary-table, results = 'asis'}

#notes for hdl_df
hdl_notes <- c(1, 4, 5, 37, 42)

hdl_note_df <- dbs_hdl_df %>% 
  select(ends_with("note"))

#apply function to each note column
hdl_note_list <- lapply(hdl_note_df, function(column) calc_multi_column(column, hdl_notes))

#combine results into df
hdl_note_sum <- bind_rows(hdl_note_list, .id = "Variable") %>% 
  pivot_wider(names_from = Response, values_from = c(Count, Percent)) %>% 
  mutate(across(starts_with("Percent"), ~ paste0(.x, "%"))) %>% 
  select(-`Count_-55`)

#create gt table
hdl_tbl_notes <- hdl_note_sum %>%
  gt() %>%
  cols_label(Count_1 = "N",
             Count_4 = "N",
             Count_5 = "N",
             Count_37 = "N",
             Count_42 = "N",
             Percent_1 = "%",
             Percent_4 = "%",
             Percent_5 = "%",
             Percent_37 = "%",
             Percent_42 = "%",
             `Percent_-55` = "% NA*") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Count_1", "Count_4", "Count_5", "Count_37", "Count_42", "Percent_1",
                         "Percent_4", "Percent_5", "Percent_37", "Percent_42", "Percent_-55"), align = "center") %>% 
  tab_spanner(label = "Blank punch",  columns =  c(Count_1, Percent_1)) %>% 
  tab_spanner(label = "Small spot,",  columns =  c(Count_4, Percent_4)) %>% 
  tab_spanner(label = "Non-circular",  columns = c(Count_5, Percent_5)) %>% 
  tab_spanner(label = "Did not elute", columns = c(Count_37, Percent_37)) %>% 
  tab_spanner(label = "Touched cover", columns = c(Count_42, Percent_42)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  tab_footnote(footnote = "*NA = Not Applicable") %>%
  tab_options(table.border.bottom.style = "hidden") %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(Count_1, Percent_1, Count_4, Percent_4,
                                                        Count_5, Percent_5, Count_37, Percent_37,
                                                        Count_42, Percent_42))) 

# Render the table
print(hdl_tbl_notes) 



```

#### Distributions

Distributions are presented below for the allostatic load indicators.

```{r hdl-dist-plots}

#hdl_cal
p_hdl_cal <- create_AL_plot(dbs_hdl_df, "hdl_cal", "HDL Clinical \nAllostatic Load (AL) Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#hdl_pal
p_hdl_pal <- create_AL_plot(dbs_hdl_df, "hdl_pal", "HDL Percentile- \nDetermined AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_hdl_cal, p_hdl_pal)

```

#### Clinical Categories

The distribution for plasma-equivalent HDL cholesterol values (`hdl_pe`) alongside the clinical and percentile-determined allostatic load cutoffs are presented below.

```{r hdl-clinical-plot}
dbs_hdl_df %>%
  filter(hdl_pe != "-99") %>% 
  mutate(hdl_pe = as.numeric(hdl_pe)) %>% 
  cutoff_plot2(
    x = hdl_pe,
    cutoff = 39,
    cutoff_other = 37.5
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for HDL',
    caption = 'Clinical cutoff is <39 and \n percentile-determined cutoff is <37.'
  )+
  annotate("text", x = 58, y = 15, label = "Percentile") +
  annotate("text", x = 35, y = 15, label = "Clinical")

```


### Triglycerides (TRG) Description

These data include variables related to the triglycerides assessment, including direct and plasma equivalent (PE) triglyceride values for participants. Higher values indicate higher triglycerides. The PE triglyceride value was used to calculate allostatic load indicators.

The missing data rule was not applied since composite variables were based on a single item. Missing data for each variable is presented in the descriptive statistics table below.

Reference: *<MARIA> INSERT REF if applicable*


#### Value Labels

The value labels for all `_note` variables (`trg_punch_note`, `trg_assay_note`, and `trg_result_note`) are below: 

```{r trg-label-table, results = 'asis'}
#Same as CHO notes table
# Print the table
print(cho_label_table)

```


Allostatic load indicators, `trg_cal` and `trg_pal` are dichotomous:

```{r trg-dichot-value, results = 'asis'}
# Print the table
print(dichot_label_table)

```


#### Variables

All TRG variables are presented in the following table.

```{r TRG-var-table, results = 'asis'}
#create table of info
trg_var_df <- data.frame(
  Variable = c("dbs_id", "family", "trg_direct", "trg_pe", "trg_punch_note", "trg_assay_note", "trg_result_note", 
            "trg_plate", "trg_date", "trg_cal", "trg_pal"),
  Description = c("Unique ID for each assay",
            "Participant ID",
            "Direct triglycerides analyte concentrate obtained from dried blood spot",
            "Plasma-equivalent triglycerides analyte concentration",
            "Note made by technician during sample preparation (punching)",
            "Note made by technician during assay",
            "Note indicating reportability of values",
            "ID for the plate used during assay",
            "Date of assay",
            "Clinical allostatic load indicator for out-of-range triglycerides",
            "Percentile-based allostatic load indicator for out-of-range triglycerides")) %>% 
  mutate(Notes = ifelse(grepl("_note", Variable), "When multiple notes were provided, they are separated by a semi-colon", ""))

#create gt table
trg_var_table <- trg_var_df %>%
  gt() %>% 
apply_tbl_theme() %>% 
  cols_width(Description ~ px(300),
             Variable ~ px(100)
             ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

#print table
print(trg_var_table)

```

#### Composite Variables

Using the plasma-equivalent triglyceride value, two allostatic load indicators were calculated. One based on the clinical cut-off for high triglycerides (`trg_cal`) and the other is a percentile-based cut-off for high triglycerides (`trg_pal`) defined as the top 25% of triglyceride values. 

```{r trg-subscale-table, results = 'asis'}
#create table of info for AL indicators
trg_scale_df <- data.frame(
  var_name = c("trg_cal", "trg_pal"),
  scale = c("Allostatic load indicator based on clinical cut-off  for high triglycerides (1)",
            "Allostatic load indicator based on top 25% of triglyceride values (1)"),
  scale_construction = c("`trg_pe` > 149", 
                         "Top 25% of observed `trg_pe` values"),
  scale_range = c("0-1", "0-1"))

#create gt table
trg_scale_table <- trg_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  #cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme() 

#print table
print(trg_scale_table)

```

#### Descriptive Statistics

Descriptive statistics are presented below for key TRG variables.

**Raw triglyceride values:** 

```{r trg-cont-summary-table, results = 'asis'}
#apply function to calculate summary stats
trg_sum_df <- dbs_trg_df %>% 
  select(trg_direct, trg_pe) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% 
  calc_cont_sum_stats()

#create gt table
trg_sum_tbl <- trg_sum_df  %>%
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
trg_sum_tbl

```

**Allostatic load indicators:**  

```{r trg-dichot-summary-table, results = 'asis'}
#apply function to calculate summary stats
trg_dichot_df <- dbs_trg_df %>% 
  select(trg_cal, trg_pal) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% 
  calc_dichot_sum_stats()

#create gt table
trg_tbl_dichot <- trg_dichot_df %>%
  gt() %>%
  cols_label(num_no = "N",
             per_no = "%",
             num_yes = "N",
             per_yes = "%",
             Missing = "% Missing") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("per_no", "per_yes", "num_no", "num_yes", "Missing"), align = "center") %>% 
  tab_spanner(label = "No", columns = c(num_no, per_no)) %>% 
  tab_spanner(label = "Yes", columns = c(num_yes, per_yes)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(num_yes, num_no, per_yes, per_no))) 

# Render the table
trg_tbl_dichot

```

**Data collection notes:** 

```{r trg-cat-summary-table, results = 'asis'}
#notes for trg_df
trg_notes <- c(1, 4, 5, 37, 42)

trg_note_df <- dbs_trg_df %>% 
  select(ends_with("note"))

#apply function to each note column
trg_note_list <- lapply(trg_note_df, function(column) calc_multi_column(column, trg_notes))

#combine results into df
trg_note_sum <- bind_rows(trg_note_list, .id = "Variable") %>% 
  pivot_wider(names_from = Response, values_from = c(Count, Percent)) %>% 
  mutate(across(starts_with("Percent"), ~ paste0(.x, "%"))) %>% 
  select(-`Count_-55`)

#create gt table
trg_tbl_notes <- trg_note_sum %>%
  gt() %>%
  cols_label(Count_1 = "N",
             Count_4 = "N",
             Count_5 = "N",
             Count_37 = "N",
             Count_42 = "N",
             Percent_1 = "%",
             Percent_4 = "%",
             Percent_5 = "%",
             Percent_37 = "%",
             Percent_42 = "%",
             `Percent_-55` = "% NA*") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Count_1", "Count_4", "Count_5", "Count_37", "Count_42", "Percent_1",
                         "Percent_4", "Percent_5", "Percent_37", "Percent_42", "Percent_-55"), align = "center") %>% 
  tab_spanner(label = "Blank punch",  columns =  c(Count_1, Percent_1)) %>% 
  tab_spanner(label = "Small spot,",  columns =  c(Count_4, Percent_4)) %>% 
  tab_spanner(label = "Non-circular",  columns = c(Count_5, Percent_5)) %>% 
  tab_spanner(label = "Did not elute", columns = c(Count_37, Percent_37)) %>% 
  tab_spanner(label = "Touched cover", columns = c(Count_42, Percent_42)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  tab_footnote(footnote = "*NA = Not Applicable") %>%
  tab_options(table.border.bottom.style = "hidden") %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(Count_1, Percent_1, Count_4, Percent_4,
                                                        Count_5, Percent_5, Count_37, Percent_37,
                                                        Count_42, Percent_42))) 

# Render the table
print(trg_tbl_notes) 



```

#### Distributions

Distributions are presented below for the allostatic load indicators.

```{r trg-dist-plots}
#trg_cal
p_trg_cal <- create_AL_plot(dbs_trg_df, "trg_cal", "TRG Clinical \nAllostatic Load (AL) Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#trg_pal
p_trg_pal <- create_AL_plot(dbs_trg_df, "trg_pal", "TRG Percentile- \nDetermined AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_trg_cal, p_trg_pal)

```

#### Clinical Categories

The distribution for plasma-equivalent triglyceride values (`trg_pe`) alongside the clinical and percentile-determined allostatic load cutoffs are presented below.

```{r trg-clinical-plot}
dbs_trg_df %>%
  filter(trg_pe != "-99") %>% 
  mutate(trg_pe = as.numeric(trg_pe)) %>% 
  cutoff_plot2(
    x = trg_pe,
    cutoff = 150,
    cutoff_other = 97
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for TRG',
    caption = 'Clinical cutoff is 150 and \n percentile-determined cutoff is 97.'
  )+
  annotate("text", x = 106.5, y = 17, label = "Percentile") +
  annotate("text", x = 158, y = 17, label = "Clinical")

```


### C-Reactive Protein (CRP) Description

These data include variables related to the c-reactive protein assessment, including direct and plasma equivalent (PE) c-reactive protein values for participants. Higher values indicate higher c-reactive protein. The PE value was used to calculate allostatic load indicators.

The missing data rule was not applied since composite variables were based on a single item. Missing data for each variable is presented in the descriptive statistics table below.

Reference: *<MARIA> INSERT REF if applicable*


#### Value Labels

The value labels for all `_note` variables (`crp_punch_note`, `crp_assay_note`, and `crp_result_note`) are below: 

```{r CRP-label-table, results = 'asis'}
crp_label_df <- data.frame(
  value = c("1", "3", "4", "5", "29", "42"),
  label = c("Blank punch",
            "Smeared Drops/ Inconsistent Absorption",
            "Small spot, <80%",
            "Non-circular dried blood spot",
            "Below lower limit of detection (LLoD)",
            "Blood from filter paper touched inside back cover")
) %>% 
  t() %>% 
  as.data.frame()

crp_label_df <- setNames(crp_label_df[-1, ], unlist(crp_label_df[1, ]))


#create table
crp_label_table <- crp_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(crp_label_table)

```


Allostatic load indicators, `crp_cal` and `crp_pal` are dichotomous:

```{r crp-dichot-value, results = 'asis'}
# Print the table
print(dichot_label_table)

```


#### Variables

All CRP variables are presented in the following table.

```{r CRP-var-table, results = 'asis'}
#create table of info
crp_var_df <- data.frame(
  Variable = c("dbs_id", "family", "crp_direct", "crp_pe", "crp_punch_note", "crp_assay_note", "crp_result_note", 
            "crp_plate", "crp_date", "crp_cal", "crp_pal"),
  Description = c("Unique ID for each assay",
            "Participant ID",
            "Direct c-reactive protein analyte concentrate obtained from dried blood spot",
            "Plasma-equivalent c-reactive protein analyte concentration",
            "Note made by technician during sample preparation (punching)",
            "Note made by technician during assay",
            "Note indicating reportability of values",
            "ID for the plate used during assay",
            "Date of assay",
            "Clinical allostatic load indicator for out-of-range c-reactive protein",
            "Percentile-based allostatic load indicator for out-of-range c-reactive protein")) %>% 
  mutate(Notes = ifelse(grepl("_note", Variable), "When multiple notes were provided, they are separated by a semi-colon", ""))

#create gt table
crp_var_table <- crp_var_df %>%
  gt() %>% 
apply_tbl_theme() %>% 
  cols_width(Description ~ px(300),
             Variable ~ px(100)
             ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

#print table
print(crp_var_table)

```

#### Composite Variables

Using the plasma-equivalent c-reactive protein value, two allostatic load indicators were calculated. One based on the clinical cut-off for high c-reactive protein (`crp_cal`) and the other is a percentile-based cut-off for high c-reactive protein (`crp_pal`) defined as the top 25% of c-reactive protein values. 

```{r CRP-subscale-table, results = 'asis'}
#create table of info for AL indicators
crp_scale_df <- data.frame(
  var_name = c("crp_cal", "crp_pal"),
  scale = c("Allostatic load indicator based on clinical cut-off  for high c-reactive protein (1)",
            "Allostatic load indicator based on top 25% of c-reactive protein values (1)"),
  scale_construction = c("`crp_pe` > 0.2", 
                         "Top 25% of observed `crp_pe` values"),
  scale_range = c("0-1", "0-1"))

#create gt table
crp_scale_table <- crp_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  #cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme() 

#print table
print(crp_scale_table)

```


#### Descriptive Statistics

Descriptive statistics are presented below for key CRP variables.

**Raw c-reactive protein values:** 

```{r CRP-cont-summary-table, results = 'asis'}
#apply function to calculate summary stats
crp_sum_df <- dbs_crp_df %>% 
  select(crp_direct, crp_pe) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% # warning due to <10 response
  calc_cont_sum_stats()

#create gt table
crp_sum_tbl <- crp_sum_df  %>%
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
crp_sum_tbl

```

**Allostatic load indicators:**  

```{r crp-dichot-summary-table, results = 'asis'}

#apply function to calculate summary stats
crp_dichot_df <- dbs_crp_df %>% 
  select(crp_cal, crp_pal) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% 
  calc_dichot_sum_stats()

#create gt table
crp_tbl_dichot <- crp_dichot_df %>%
  gt() %>%
  cols_label(num_no = "N",
             per_no = "%",
             num_yes = "N",
             per_yes = "%",
             Missing = "% Missing") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("per_no", "per_yes", "num_no", "num_yes", "Missing"), align = "center") %>% 
  tab_spanner(label = "No", columns = c(num_no, per_no)) %>% 
  tab_spanner(label = "Yes", columns = c(num_yes, per_yes)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(num_yes, num_no, per_yes, per_no))) 

# Render the table
crp_tbl_dichot

```

**Data collection notes:** 

```{r crp-cat-summary-table, results = 'asis'}
#notes for crp_df
crp_notes <- c(1, 3, 4, 5, 29, 42)

crp_note_df <- dbs_crp_df %>% 
  select(ends_with("note"))

#apply function to each note column
crp_note_list <- lapply(crp_note_df, function(column) calc_multi_column(column, crp_notes))

#combine results into df
crp_note_sum <- bind_rows(crp_note_list, .id = "Variable") %>% 
  pivot_wider(names_from = Response, values_from = c(Count, Percent)) %>% 
  mutate(across(starts_with("Percent"), ~ paste0(.x, "%"))) %>% 
  select(-`Count_-55`)

#create gt table
crp_tbl_notes <- crp_note_sum %>%
  gt() %>%
  cols_label(Count_1 = "N",
             Count_3 = "N", 
             Count_4 = "N",
             Count_5 = "N",
             Count_29 = "N",
             Count_42 = "N",
             Percent_1 = "%",
             Percent_3 = "%",
             Percent_4 = "%",
             Percent_5 = "%",
             Percent_29 = "%",
             Percent_42 = "%",
             `Percent_-55` = "% NA*") %>% 
  tab_options(table.width = pct(100)) %>%
  cols_align(columns = c("Count_1", "Count_3", "Count_4", "Count_5", "Count_29", "Count_42", "Percent_1", "Percent_3",
                         "Percent_4", "Percent_5", "Percent_29", "Percent_42", "Percent_-55"), align = "center") %>% 
  tab_spanner(label = "Blank punch",  columns =  c(Count_1, Percent_1)) %>% 
  tab_spanner(label = "Smeared drops",  columns =  c(Count_3, Percent_3)) %>% 
  tab_spanner(label = "Small spot,",  columns =  c(Count_4, Percent_4)) %>% 
  tab_spanner(label = "Non-circular",  columns = c(Count_5, Percent_5)) %>% 
  tab_spanner(label = "Below limit", columns = c(Count_29, Percent_29)) %>% 
  tab_spanner(label = "Touched cover", columns = c(Count_42, Percent_42)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  tab_footnote(footnote = "*NA = Not Applicable") %>%
  tab_options(table.border.bottom.style = "hidden") %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(Count_1, Percent_1, Count_3, Percent_3,
                                                        Count_4, Percent_4, Count_5, Percent_5, 
                                                        Count_29, Percent_29, Count_42, Percent_42))) 

# Render the table
print(crp_tbl_notes) 


```

#### Distributions

Distributions are presented below for the allostatic load indicators.

```{r crp-dist-plots}

#crp_cal
p_crp_cal <- create_AL_plot(dbs_crp_df, "crp_cal", "CRP Clinical \nAllostatic Load (AL) Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#crp_pal
p_crp_pal <- create_AL_plot(dbs_crp_df, "crp_pal", "CRP Percentile- \nDetermined AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_crp_cal, p_crp_pal)

```

#### Clinical Categories

The distribution for plasma-equivalent c-reactive protein values (`crp_pe`) alongside the clinical and percentile-determined allostatic load cutoffs are presented below.

```{r crp-clinical-plot}
dbs_crp_df %>%
  filter(crp_pe != "-99") %>% 
  mutate(crp_pe = as.numeric(crp_pe)) %>% 
  cutoff_plot2(
    x = crp_pe,
    cutoff = 0.3,
    cutoff_other = 5.3
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for CRP',
    caption = 'Clinical cutoff is 0.3 and \n percentile-determined cutoff is 5.3.'
  )+
  annotate("text", x = 8.9, y = 35, label = "Percentile") +
  annotate("text", x = 2.7, y = 42, label = "Clinical")

```


### Epstein-Barr virus (EBV) Description

These data include variables related to the Epstein-Barr virus assessment, including direct and plasma equivalent (PE) Epstein-Barr virus values for participants. Higher values indicate higher Epstein-Barr virus concentration *<MARIA> CONFRIM CORRECT*. The PE Epstein-Barr virus value was used to calculate allostatic load indicators.

The missing data rule was not applied since composite variables were based on a single item. Missing data for each variable is presented in the descriptive statistics table below.

Reference: *<MARIA> INSERT REF if applicable*


#### Value Labels

The value labels for all `_note` variables (`ebv_punch_note`, `ebv_assay_note`, and `ebv_result_note`) are below: 

```{r ebv-label-table, results = 'asis'}
#specify notes in EBV data
ebv_label_df <- data.frame(
  value = c("1", "3", "4", "5", "12", "13", "42"),
  label = c("Blank punch",
            "Smeared Drops/ Inconsistent Absorption",
            "Small spot, <80%",
            "Non-circular dried blood spot",
            "Drop outside printed circle",
            "No DBS remains",
            "Blood from filter paper touched inside back cover")
) %>% 
  t() %>% 
  as.data.frame()

ebv_label_df <- setNames(ebv_label_df[-1, ], unlist(ebv_label_df[1, ]))


#create table
ebv_label_table <- ebv_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(ebv_label_table)

```


The allostatic load indicator, `ebv_pal`, is dichotomous:

```{r ebv-dichot-value, results = 'asis'}
# Print the table
print(dichot_label_table)

```


#### Variables

All EBV variables are presented in the following table.

```{r EBV-var-table, results = 'asis'}
#create table of info
ebv_var_df <- data.frame(
  Variable = c("dbs_id", "family", "ebv_direct", "ebv_pe", "ebv_punch_note", "ebv_assay_note", "ebv_result_note", 
            "ebv_plate", "ebv_date", "ebv_pal"),
  Description = c("Unique ID for each assay",
            "Participant ID",
            "Direct Epstein-Barr virus analyte concentrate obtained from dried blood spot",
            "Plasma-equivalent Epstein-Barr virus analyte concentration",
            "Note made by technician during sample preparation (punching)",
            "Note made by technician during assay",
            "Note indicating reportability of values",
            "ID for the plate used during assay",
            "Date of assay",
            "Percentile-based allostatic load indicator for out-of-range Epstein-Barr virus")) %>% 
  mutate(Notes = ifelse(grepl("_note", Variable), "When multiple notes were provided, they are separated by a semi-colon", ""))

#create gt table
ebv_var_table <- ebv_var_df %>%
  gt() %>% 
apply_tbl_theme() %>% 
  cols_width(Description ~ px(300),
             Variable ~ px(100)
             ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

#print table
print(ebv_var_table)

```

#### Composite Variables

Using the plasma-equivalent Epstein-Barr virus value, an allostatic load indicator was calculated. Only the percentile-based cut-off for high Epstein-Barr virus (`ebv_pal`) was used to calculate an allostatic load indicator as no standard clinical cutoff was found *<MARIA> CONFIRM*. The percentile cutoff is defined as the top 25% of Epstein-Barr virus values. 

```{r ebv-subscale-table, results = 'asis'}
#create table of info for AL indicators
ebv_scale_df <- data.frame(
  var_name = c("ebv_pal"),
  scale = c("Allostatic load indicator based on top 25% of Epstein-Barr virus values (1)"),
  scale_construction = c("Top 25% of observed `ebv_pe` values"),
  scale_range = c("0-1"))

#create gt table
ebv_scale_table <- ebv_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  #cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme() 

#print table
print(ebv_scale_table)

```

#### Descriptive Statistics

Descriptive statistics are presented below for key EBV variables.

**Raw Epstein-Barr virus values:** 

```{r ebv-cont-summary-table, results = 'asis'}
#apply function to calculate summary stats
ebv_sum_df <- dbs_ebv_df %>% 
  select(ebv_direct, ebv_pe) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% 
  calc_cont_sum_stats()

#create gt table
ebv_sum_tbl <- ebv_sum_df  %>%
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
ebv_sum_tbl

```

**Allostatic load indicators:**  

```{r ebv-dichot-summary-table, results = 'asis'}
#apply function to calculate summary stats
ebv_dichot_df <- dbs_ebv_df %>% 
  select(ebv_pal) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% 
  calc_dichot_sum_stats()

#create gt table
ebv_tbl_dichot <- ebv_dichot_df %>%
  gt() %>%
  cols_label(num_no = "N",
             per_no = "%",
             num_yes = "N",
             per_yes = "%",
             Missing = "% Missing") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("per_no", "per_yes", "num_no", "num_yes", "Missing"), align = "center") %>% 
  tab_spanner(label = "No", columns = c(num_no, per_no)) %>% 
  tab_spanner(label = "Yes", columns = c(num_yes, per_yes)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(num_yes, num_no, per_yes, per_no))) 

# Render the table
ebv_tbl_dichot

```

**Data collection notes:** 

```{r ebv-cat-summary-table, results = 'asis'}
#notes for ebv_df
ebv_notes <- c(1, 3, 4, 5, 12, 13, 42)

ebv_note_df <- dbs_ebv_df %>% 
  select(ends_with("note"))

#apply function to each note column
ebv_note_list <- lapply(ebv_note_df, function(column) calc_multi_column(column, ebv_notes))

#combine results into df
ebv_note_sum <- bind_rows(ebv_note_list, .id = "Variable") %>% 
  pivot_wider(names_from = Response, values_from = c(Count, Percent)) %>% 
  mutate(across(starts_with("Percent"), ~ paste0(.x, "%"))) %>% 
  select(-`Count_-55`)

#create gt table
ebv_tbl_notes <- ebv_note_sum %>%
  gt() %>%
  cols_label(Count_1 = "N",
             Count_3 = "N",
             Count_4 = "N",
             Count_5 = "N",
             Count_12 = "N",
             Count_13 = "N",
             Count_42 = "N",
             Percent_1 = "%",
             Percent_3 = "%",
             Percent_4 = "%",
             Percent_5 = "%",
             Percent_12 = "%",
             Percent_13 = "%",
             Percent_42 = "%",
             `Percent_-55` = "% NA*") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Count_1", "Count_3", "Count_4", "Count_5", "Count_12", "Count_13",
                         "Count_42", "Percent_1", "Percent_3", "Percent_4", "Percent_5",
                         "Percent_12", "Percent_13", "Percent_42", "Percent_-55"), 
             align = "center") %>% 
  tab_spanner(label = "Blank punch",  columns =  c(Count_1, Percent_1)) %>% 
  tab_spanner(label = "Smeared drop",  columns =  c(Count_3, Percent_3)) %>%
  tab_spanner(label = "Small spot,",  columns =  c(Count_4, Percent_4)) %>% 
  tab_spanner(label = "Non-circular",  columns = c(Count_5, Percent_5)) %>% 
  tab_spanner(label = "Outside circle",  columns = c(Count_12, Percent_12)) %>% 
  tab_spanner(label = "No DBS remains", columns = c(Count_13, Percent_13)) %>% 
  tab_spanner(label = "Touched cover", columns = c(Count_42, Percent_42)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  tab_footnote(footnote = "*NA = Not Applicable") %>%
  tab_options(table.border.bottom.style = "hidden") %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(Count_1, Percent_1, Count_3, Percent_3,
                                                        Count_4, Percent_4, Count_5, Percent_5,
                                                        Count_12, Percent_12, Count_13, Percent_13,
                                                        Count_42, Percent_42))) 

# Render the table
print(ebv_tbl_notes) 



```

#### Distributions

Distributions are presented below for the percentile-based allostatic load indicator.

```{r ebv-dist-plots}
#ebv_pal
p_ebv_pal <- create_AL_plot(dbs_ebv_df, "ebv_pal", "EBV Percentile- \nDetermined AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
p_ebv_pal

```

#### Clinical Categories

The distribution for plasma-equivalent Epstein-Barr virus values (`ebv_pe`) alongside the percentile-determined allostatic load cutoff is presented below.

```{r ebv-clinical-plot}
dbs_ebv_df %>%
  filter(ebv_pe != "-99") %>% 
  mutate(ebv_pe = as.numeric(ebv_pe)) %>% 
  cutoff_plot2(
    x = ebv_pe,
    cutoff = 410.5
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for EBV',
    caption = 'Percentile-determined cutoff is 411.'
  )+
  annotate("text", x = 482, y = 16, label = "Percentile") 

```

### Hemoglobin A1C (A1C) Description

These data include variables related to the hemoglobin A1C assessment. *<MARIA> EXPLAIN WHY NO PE AND DIRECT VALUE BUT ONLY AIC_HB VALUE* 

The missing data rule was not applied since composite variables were based on a single item. Missing data for each variable is presented in the descriptive statistics table below.

Reference: *<MARIA> INSERT REF if applicable*


#### Value Labels

The value labels for all `_note` variables (`a1c_punch_note`, `a1c_assay_note`, and `a1c_result_note`) are below: 

```{r a1c-label-table, results = 'asis'}
#specify notes
a1c_label_df <- data.frame(
  value = c("1", "3", "4", "5", "13", "37", "42"),
  label = c("Blank punch",
            "Smeared Drops/ Inconsistent Absorption",
            "Small spot, <80%",
            "Non-circular dried blood spot",
            "No DBS remains",
            "Punch did not elute",
            "Blood from filter paper touched inside back cover")
) %>% 
  t() %>% 
  as.data.frame()

a1c_label_df <- setNames(a1c_label_df[-1, ], unlist(a1c_label_df[1, ]))


#create table
a1c_label_table <- a1c_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(a1c_label_table)

```


Allostatic load indicators, `a1c_cal` and `a1c_pal` are dichotomous:

```{r a1c-dichot-value, results = 'asis'}
# Print the table
print(dichot_label_table)

```


#### Variables

All A1C variables are presented in the following table.

```{r a1c-var-table, results = 'asis'}
#create table of info
a1c_var_df <- data.frame(
  Variable = c("dbs_id", "family", "a1c_hb", "a1c_punch_note", "a1c_assay_note", "a1c_result_note", 
            "a1c_plate", "a1c_date", "a1c_cal", "a1c_pal"),
  Description = c("Unique ID for each assay",
            "Participant ID",
            "Hemoglobin A1C analyte concentrate obtained from dried blood spot",
            "Note made by technician during sample preparation (punching)",
            "Note made by technician during assay",
            "Note indicating reportability of values",
            "ID for the plate used during assay",
            "Date of assay",
            "Clinical allostatic load indicator for out-of-range hemoglobin A1C",
            "Percentile-based allostatic load indicator for out-of-range hemoglobin A1C")) %>% 
  mutate(Notes = ifelse(grepl("_note", Variable), "When multiple notes were provided, they are separated by a semi-colon", ""))

#create gt table
a1c_var_table <- a1c_var_df %>%
  gt() %>% 
apply_tbl_theme() %>% 
  cols_width(Description ~ px(300),
             Variable ~ px(100)
             ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

#print table
print(a1c_var_table)

```

#### Composite Variables

Using the hemoglobin A1C value, two allostatic load indicators were calculated. One based on the clinical cut-off for high hemoglobin A1C (`a1c_cal`) and the other is a percentile-based cut-off for high hemoglobin A1C (`a1c_pal`) defined as the top 25% of hemoglobin A1C values. 

```{r a1c-subscale-table, results = 'asis'}
#create table of info for AL indicators
a1c_scale_df <- data.frame(
  var_name = c("a1c_cal", "a1c_pal"),
  scale = c("Allostatic load indicator based on clinical cut-off  for high hemoglobin A1C (1)",
            "Allostatic load indicator based on top 25% of hemoglobin A1C values (1)"),
  scale_construction = c("`a1c_hb` > 6.4", 
                         "Top 25% of observed `a1c_hb` values"),
  scale_range = c("0-1", "0-1"))

#create gt table
a1c_scale_table <- a1c_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  #cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme() 

#print table
print(a1c_scale_table)

```


#### Descriptive Statistics

Descriptive statistics are presented below for key A1C variables.

**Raw hemoglobin A1C values:** 

```{r A1C-cont-summary-table, results = 'asis'}
#apply function to calculate summary stats
a1c_sum_df <- dbs_a1c_df %>% 
  select(a1c_hb) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% 
  calc_cont_sum_stats()

#create gt table
a1c_sum_tbl <- a1c_sum_df  %>%
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
a1c_sum_tbl

```

**Allostatic load indicators:**  

```{r a1c-dichot-summary-table, results = 'asis'}

#apply function to calculate summary stats
a1c_dichot_df <- dbs_a1c_df %>% 
  select(a1c_cal, a1c_pal) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% 
  calc_dichot_sum_stats()

#create gt table
a1c_tbl_dichot <- a1c_dichot_df %>%
  gt() %>%
  cols_label(num_no = "N",
             per_no = "%",
             num_yes = "N",
             per_yes = "%",
             Missing = "% Missing") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("per_no", "per_yes", "num_no", "num_yes", "Missing"), align = "center") %>% 
  tab_spanner(label = "No", columns = c(num_no, per_no)) %>% 
  tab_spanner(label = "Yes", columns = c(num_yes, per_yes)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(num_yes, num_no, per_yes, per_no))) 

# Render the table
a1c_tbl_dichot

```

**Data collection notes:** 

```{r a1c-cat-summary-table, results = 'asis'}
#notes for a1c_df
a1c_notes <- c(1, 3, 4, 5, 29, 42)

a1c_note_df <- dbs_a1c_df %>% 
  select(ends_with("note"))

#apply function to each note column
a1c_note_list <- lapply(a1c_note_df, function(column) calc_multi_column(column, a1c_notes))

#combine results into df
a1c_note_sum <- bind_rows(a1c_note_list, .id = "Variable") %>% 
  pivot_wider(names_from = Response, values_from = c(Count, Percent)) %>% 
  mutate(across(starts_with("Percent"), ~ paste0(.x, "%"))) %>% 
  select(-`Count_-55`)

#create gt table
a1c_tbl_notes <- a1c_note_sum %>%
  gt() %>%
  cols_label(Count_1 = "N",
             Count_3 = "N", 
             Count_4 = "N",
             Count_5 = "N",
             Count_29 = "N",
             Count_42 = "N",
             Percent_1 = "%",
             Percent_3 = "%",
             Percent_4 = "%",
             Percent_5 = "%",
             Percent_29 = "%",
             Percent_42 = "%",
             `Percent_-55` = "% NA*") %>% 
  tab_options(table.width = pct(100)) %>%
  cols_align(columns = c("Count_1", "Count_3", "Count_4", "Count_5", "Count_29", "Count_42", "Percent_1", "Percent_3",
                         "Percent_4", "Percent_5", "Percent_29", "Percent_42", "Percent_-55"), align = "center") %>% 
  tab_spanner(label = "Blank punch",  columns =  c(Count_1, Percent_1)) %>% 
  tab_spanner(label = "Smeared drops",  columns =  c(Count_3, Percent_3)) %>% 
  tab_spanner(label = "Small spot,",  columns =  c(Count_4, Percent_4)) %>% 
  tab_spanner(label = "Non-circular",  columns = c(Count_5, Percent_5)) %>% 
  tab_spanner(label = "Below limit", columns = c(Count_29, Percent_29)) %>% 
  tab_spanner(label = "Touched cover", columns = c(Count_42, Percent_42)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  tab_footnote(footnote = "*NA = Not Applicable") %>%
  tab_options(table.border.bottom.style = "hidden") %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(Count_1, Percent_1, Count_3, Percent_3,
                                                        Count_4, Percent_4, Count_5, Percent_5, 
                                                        Count_29, Percent_29, Count_42, Percent_42))) 

# Render the table
print(a1c_tbl_notes) 


```

#### Distributions

Distributions are presented below for the allostatic load indicators.

```{r a1c-dist-plots}

#a1c_cal
p_a1c_cal <- create_AL_plot(dbs_a1c_df, "a1c_cal", "A1C Clinical \nAllostatic Load (AL) Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#a1c_pal
p_a1c_pal <- create_AL_plot(dbs_a1c_df, "a1c_pal", "A1C Percentile- \nDetermined AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_a1c_cal, p_a1c_pal)

```

#### Clinical Categories

The distribution for hemoglobin A1C values (`a1c_hb`) alongside the clinical and percentile-determined allostatic load cutoffs are presented below.

```{r a1c-clinical-plot}
dbs_a1c_df %>%
  filter(a1c_hb != "-99") %>% 
  mutate(a1c_hb = as.numeric(a1c_hb)) %>% 
  cutoff_plot2(
    x = a1c_hb,
    cutoff = 6.5,
    cutoff_other = 5.9
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for A1C',
    caption = 'Clinical cutoff is 6.5 and \n percentile-determined cutoff is 5.9.'
  )+
  annotate("text", x = 5.35, y = 56, label = "Percentile") +
  annotate("text", x = 6.93, y = 50, label = "Clinical")

```

### Interleukin-6 (IL6) Description

These data include variables related to the Interleukin-6 assessment, including direct and plasma equivalent (PE) Interleukin-6 values for participants. Higher values indicate higher Interleukin-6. The PE value was used to calculate allostatic load indicators.

The missing data rule was not applied since composite variables were based on a single item. Missing data for each variable is presented in the descriptive statistics table below.

Reference: *<MARIA> INSERT REF if applicable*


#### Value Labels

The value labels for all `_note` variables (`il6_punch_note`, `il6_assay_note`, and `il6_result_note`) are below: 

```{r il6-label-table, results = 'asis'}
il6_label_df <- data.frame(`1` = "Blank punch", check.names = FALSE)


#create table
il6_label_table <- il6_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(il6_label_table)

```


Allostatic load indicators, `il6_cal` and `il6_pal` are dichotomous:

```{r il6-dichot-value, results = 'asis'}
# Print the table
print(dichot_label_table)

```


#### Variables

All IL6 variables are presented in the following table.

```{r IL6-var-table, results = 'asis'}
#create table of info
il6_var_df <- data.frame(
  Variable = c("dbs_id", "family", "il6_direct", "il6_pe", "il6_punch_note", "il6_assay_note", "il6_result_note", 
            "il6_plate", "il6_date", "il6_cal", "il6_pal"),
  Description = c("Unique ID for each assay",
            "Participant ID",
            "Direct Interleukin-6 analyte concentrate obtained from dried blood spot",
            "Plasma-equivalent Interleukin-6 analyte concentration",
            "Note made by technician during sample preparation (punching)",
            "Note made by technician during assay",
            "Note indicating reportability of values",
            "ID for the plate used during assay",
            "Date of assay",
            "Clinical allostatic load indicator for out-of-range Interleukin-6",
            "Percentile-based allostatic load indicator for out-of-range Interleukin-6")) %>% 
  mutate(Notes = ifelse(grepl("_note", Variable), "When multiple notes were provided, they are separated by a semi-colon", ""))

#create gt table
il6_var_table <- il6_var_df %>%
  gt() %>% 
apply_tbl_theme() %>% 
  cols_width(Description ~ px(300),
             Variable ~ px(100)
             ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

#print table
print(il6_var_table)

```

#### Composite Variables

Using the plasma-equivalent Interleukin-6 value, two allostatic load indicators were calculated. One based on the clinical cut-off for high Interleukin-6 (`il6_cal`) and the other is a percentile-based cut-off for high Interleukin-6 (`il6_pal`) defined as the top 25% of Interleukin-6 values. 

```{r il6-subscale-table, results = 'asis'}
#create table of info for AL indicators
il6_scale_df <- data.frame(
  var_name = c("il6_cal", "il6_pal"),
  scale = c("Allostatic load indicator based on clinical cut-off  for high Interleukin-6 (1)",
            "Allostatic load indicator based on top 25% of Interleukin-6 values (1)"),
  scale_construction = c("`il6_pe` > 6", 
                         "Top 25% of observed `il6_pe` values"),
  scale_range = c("0-1", "0-1"))

#create gt table
il6_scale_table <- il6_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  #cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme() 

#print table
print(il6_scale_table)

```


#### Descriptive Statistics

Descriptive statistics are presented below for key IL6 variables.

Raw Interleukin-6 values: 

```{r IL6-cont-summary-table, results = 'asis'}
#apply function to calculate summary stats
il6_sum_df <- dbs_il6_df %>% 
  select(il6_direct, il6_pe) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% 
  calc_cont_sum_stats()

#create gt table
il6_sum_tbl <- il6_sum_df  %>%
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
il6_sum_tbl

```

**Allostatic load indicators:**  

```{r il6-dichot-summary-table, results = 'asis'}

#apply function to calculate summary stats
il6_dichot_df <- dbs_il6_df %>% 
  select(il6_cal, il6_pal) %>% 
  mutate_all(~ifelse(. == -99, NA, as.numeric(.))) %>% 
  calc_dichot_sum_stats()

#create gt table
il6_tbl_dichot <- il6_dichot_df %>%
  gt() %>%
  cols_label(num_no = "N",
             per_no = "%",
             num_yes = "N",
             per_yes = "%",
             Missing = "% Missing") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("per_no", "per_yes", "num_no", "num_yes", "Missing"), align = "center") %>% 
  tab_spanner(label = "No", columns = c(num_no, per_no)) %>% 
  tab_spanner(label = "Yes", columns = c(num_yes, per_yes)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(num_yes, num_no, per_yes, per_no))) 

# Render the table
il6_tbl_dichot

```

**Data collection notes:** 

```{r il6-cat-summary-table, results = 'asis'}
#notes for il6_df
il6_notes <- c(1)

il6_note_df <- dbs_il6_df %>% 
  select(ends_with("note"))

#apply function to each note column
il6_note_list <- lapply(il6_note_df, function(column) calc_multi_column(column, il6_notes))

#combine results into df
il6_note_sum <- bind_rows(il6_note_list, .id = "Variable") %>% 
  pivot_wider(names_from = Response, values_from = c(Count, Percent)) %>% 
  mutate(across(starts_with("Percent"), ~ paste0(.x, "%"))) %>% 
  select(-`Count_-55`)

#create gt table
il6_tbl_notes <- il6_note_sum %>%
  gt() %>%
  cols_label(Count_1 = "N",
             Percent_1 = "%",
             `Percent_-55` = "% NA*") %>% 
  tab_options(table.width = pct(100)) %>%
  cols_align(columns = c("Count_1", "Percent_1", "Percent_-55"), align = "center") %>% 
  tab_spanner(label = "Blank punch",  columns =  c(Count_1, Percent_1)) %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  tab_footnote(footnote = "*NA = Not Applicable") %>%
  tab_options(table.border.bottom.style = "hidden") %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(Count_1, Percent_1))) 

# Render the table
print(il6_tbl_notes) 


```

#### Distributions

Distributions are presented below for the allostatic load indicators.

```{r il6-dist-plots}

#il6_cal
p_il6_cal <- create_AL_plot(dbs_il6_df, "il6_cal", "IL6 Clinical \nAllostatic Load (AL) Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#il6_pal
p_il6_pal <- create_AL_plot(dbs_il6_df, "il6_pal", "IL6 Percentile- \nDetermined AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_il6_cal, p_il6_pal)

```

#### Clinical Categories

The distribution for plasma-equivalent Interleukin-6 values (`il6_pe`) alongside the clinical and percentile-determined allostatic load cutoffs are presented below.

```{r il6-clinical-plot}
dbs_il6_df %>%
  filter(il6_pe != "-99") %>% 
  mutate(il6_pe = as.numeric(il6_pe)) %>% 
  cutoff_plot2(
    x = il6_pe,
    cutoff = 6.1,
    cutoff_other = 1.3
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for IL6',
    caption = 'Clinical cutoff is 6.1 and \n percentile-determined cutoff is 1.3.'
  )+
  annotate("text", x = 13, y = 35, label = "Percentile") +
  annotate("text", x = 6.5, y = 42, label = "Clinical")

```



## Other Health Measures 

These data are in the `bio_archive.xlsx` file. Participant ID corresponds to the `family` variable, which can be used to merge additional data files from this study. 

*<MARIA> INSERT brief description about how bio assessment (bio variables and survey variables) was measured and any special considerations for the full file/sample (e.g., incarcerated participants were not asked some questions)*


### Blood Pressure (BP) Description

These data include variables on systolic and diastolic blood pressure collected from participants. Higher scores indicate higher blood pressure. 

Using these values, average blood pressure and allostatic load indicators for high blood pressure were computed. The missing data rule was applied. Calculations were completed for participants with no missing data due to the low number of variables used in calculations. Missing data for each variable is presented in the descriptive statistics table below.

### BP Variables

#### Value Labels 

Allostatic load indicators, variables ending in `cal` or `pal`, are dichotomous:

```{r bp-al-labels, results = 'asis'}
# Print the dichot table
print(dichot_label_table)
```

#### Variables

All BP variables are presented in the following table: 

```{r bp-var-tbl, results = 'asis'}
#create function for all bio vars in bio data
create_bio_var_tbl <- function(data, prefix) {
  filtered_data <- data %>%
    filter(str_starts(Variable, prefix))
  
  # Generate and format the table
  var_table <- filtered_data %>%
    gt() %>%
    cols_width(
      Variable ~ pct(25),
      Description ~ pct(75)) %>%
    apply_tbl_theme() %>%
    tab_style(
      style = cell_text(align = "left"), 
      locations = cells_column_labels())
  
  # Return the formatted table
  return(var_table)
}

#create table for bp vars
print(create_bio_var_tbl(bio_md, "bp"))
```

#### Composite Variables

For both systolic and diastolic blood pressure, an average value and two allostatic load indicators were calculated. One based on the clinical cut off for high blood pressure (ending in `_cal`) and the other is a percentile-based cut-off for high blood pressure (ending in `pal`) defined as the top 25% of values.

Reference: *<MARIA> INSERT REFERENCE for cutoffs, if applicable*


```{r bp-comp-tbl, results = 'asis'}
#extract variables from metadata
bp_scale_vars <- bio_md %>% 
  filter(str_starts(Variable, "bp") & str_ends(Variable, "avg|al")) %>% 
  pull(Variable)

#create table of info for AL indicators
bp_scale_df <- data.frame(
  var_name = bp_scale_vars,
  scale = c("Average systolic blood pressure (2)",
            "Average diastolic blood pressure (2)",
            "Allostatic load indicator based on clinical cut-off for high systolic BP (1)",
            "Allostatic load indicator based on clinical cut-off for high diastolic BP (1)",
            "Allostatic load indicator based on top 25% of systolic BP values (1)",
            "Allostatic load indicator based on top 25% of diastolic BP values (1)"),
  scale_construction = c("mean(`bp1`, `bp3`)",
                         "mean(`bp2`, `bp4`)",
                         "`bp_sys_avg` > 139",
                         "`bp_dia_avg` > 89",
                         "Top 25% of observed `bp_sys_avg` values",
                         "Top 25% of observed `bp_dia_avg` values"),
  scale_range = c(" ", " ", "0-1", "0-1", "0-1", "0-1")) #MARIA ENTER POSSIBLE VALUES FOR BP AVERAGE or leave blank/NA

#create gt table
bp_scale_table <- bp_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  #cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme() 

#print table
print(bp_scale_table)
```

#### Descriptive Statistics

Descriptive statistics are presented below for BP variables.

**Continuous values:** 

```{r bp-cont-summary-table, results = 'asis'}
#apply function to calculate summary stats and create gt table
bp_sum_tbl <- bio_df %>% 
  select(bp1, bp2, bp3, bp4, bp_sys_avg, bp_dia_avg) %>% 
  mutate_all(~ifelse(. == -99 | . == -55 , NA, as.numeric(.))) %>% 
  calc_cont_sum_stats() %>%
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
bp_sum_tbl

```

**Allostatic load indicators:**  

```{r bp-dichot-summary-table, results = 'asis'}
#create function to make dichotomous table
create_dichot_gt_table <- function(data) {
  table <- data %>%
    gt() %>%
    cols_label(num_no = "N",
               per_no = "%",
               num_yes = "N",
               per_yes = "%",
               Missing = "% Missing") %>%
    tab_options(table.width = pct(100)) %>%
    cols_align(columns = c(per_no, per_yes, num_no, num_yes, Missing), align = "center") %>%
    tab_spanner(label = "No", columns = c(num_no, per_no)) %>%
    tab_spanner(label = "Yes", columns = c(num_yes, per_yes)) %>%
    tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_spanners()) %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = alpha("#246B69", 0.6))),
            locations = cells_column_labels(columns = c(num_yes, num_no, per_yes, per_no)))
  
  return(table)
}

#create df - apply function to calculate summary stats and create
bp_dichot_df <- bio_df %>% 
  select(starts_with("bp")) %>%
  select(ends_with("al")) %>% 
  mutate_all(~ifelse(. == -99 | . == -55, NA, as.numeric(.))) %>% 
  calc_dichot_sum_stats()


#create table
bp_tbl_dichot <- create_dichot_gt_table(bp_dichot_df)

#print table
bp_tbl_dichot


```

#### Distributions

Distributions are presented below for the average scores and allostatic load indicators.

**Average blood pressure:** 

```{r bp-avg-plot}
p_sbp_avg <- bio_df %>%
  mutate(across(ends_with("avg"), ~ifelse(. == -99 | . == -55 , NA, as.numeric(.)))) %>% 
  composite_hist(x = bp_sys_avg) + 
  labs(title = "Distribution of Average \nSystolic BP Values") + 
  theme(plot.title = element_text(hjust = 0.5))
  

p_dbp_avg <- bio_df %>%
  mutate(across(ends_with("avg"), ~ifelse(. == -99 | . == -55 , NA, as.numeric(.)))) %>% 
  composite_hist(x = bp_dia_avg) +
  labs(title = "Distribution of Average \nDiastolic BP Values") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_sbp_avg, p_dbp_avg)

```

**Allostatic load indicators:**  

```{r bp-cal-plots}

#bp_sys_cal
p_sbp_cal <- create_AL_plot(bio_df, "bp_sys_cal", "Systolic BP \nClinical AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#bp_dia_cal
p_dbp_cal <- create_AL_plot(bio_df, "bp_dia_cal", "Diastolic BP \nClinical AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#a1c_pal
# p_a1c_pal <- create_AL_plot(dbs_a1c_df, "a1c_pal", "A1C Percentile- \nDetermined AL Indicator") +
#   theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_sbp_cal, p_dbp_cal)

```

```{r bp-pal-plots}

#bp_sys_pal
p_sbp_pal <- create_AL_plot(bio_df, "bp_sys_pal", "Systolic BP \nPercentile-Based AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#bp_dia_pal
p_dbp_pal <- create_AL_plot(bio_df, "bp_dia_pal", "Diastolic BP \nPercentile-Based AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_sbp_pal, p_dbp_pal)

```

#### Clinical Categories

The distribution for average systolic and diastolic blood pressure (`bp_sys_avg` and `bp_dia_avg`) alongside the clinical and percentile-determined allostatic load cutoffs are presented below: 

```{r sys-bp-clinical-plot}
bio_df %>%
  filter(bp_sys_avg != "-99" & bp_sys_avg != "-55") %>% 
  mutate(bp_sys_avg = as.numeric(bp_sys_avg)) %>% 
  cutoff_plot2(
    x = bp_sys_avg,
    cutoff = 140,
    cutoff_other = 126.875
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for Systolic BP',
    caption = 'Clinical cutoff is 140 and \n percentile-determined cutoff is 127.'
  )+
  annotate("text", x = 121, y = 20, label = "Percentile") +
  annotate("text", x = 145, y = 20, label = "Clinical")


```

```{r dia-bp-clinical-plot}
bio_df %>%
  filter(bp_dia_avg != "-99" & bp_dia_avg != "-55") %>% 
  mutate(bp_dia_avg = as.numeric(bp_dia_avg)) %>% 
  cutoff_plot2(
    x = bp_dia_avg,
    cutoff = 90,
    cutoff_other = 87.875
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for Diastolic BP',
    caption = 'Clinical cutoff is 90 and \n percentile-determined cutoff is 88.'
  )+
  annotate("text", x = 83, y = 14, label = "Percentile") +
  annotate("text", x = 94, y = 14, label = "Clinical")

#quantile(p$bp_dia_avg, 0.75, na.rm = TRUE)

```

### Body Mass Index (BMI) Description

These data include variables on body mass index (BMI), including weight and height collected from participants. Higher scores indicate higher BMI. 

Using BMI values, allostatic load indicators for high BMI were computed. The missing data rule was not applied since all participants who were asked BMI questions had valid data. Missing data for each variable presented in the descriptive statistics table below corresponds to "Not Applicable" values (`-55`).

### BMI Variables

#### Value Labels

Allostatic load indicators, `bmi_cal`, `bmi_pal`, are dichotomous:

```{r bmi-al-labels, results = 'asis'}
# Print the dichot table
print(dichot_label_table)
```

#### Variables

All BMI variables are presented in the following table: 

```{r bmi-var-tbl, results = 'asis'}
#create table for bmi vars
print(create_bio_var_tbl(bio_md, "bmi"))
```

#### Composite Variables

Using height and weight, BMI was calculated. Two allostatic load indicators were calculated based on BMI. One based on the clinical cut off for high BMI (`bmi_cal`) and the other is a percentile-based cut-off for BMI (`bmi_pal`) defined as the top 25% of values.

Reference: *<MARIA> INSERT REFERENCE for cutoffs, if applicable*


```{r bmi-comp-tbl, results = 'asis'}
#create table of info for AL indicators
bmi_scale_df <- data.frame(
  var_name = c("bmi_score", "bmi_cal", "bmi_pal"),
  scale = c("Body mass index",
            "Allostatic load indicator based on clinical cut-off for high BMI (1)",
            "Allostatic load indicator based on top 25% of BMI values (1)"),
  scale_construction = c("`bmi2` / ((`bmi1` / 100)^2)",
                         "`bmi_score` > 29",
                         "Top 25% of observed `bmi_score` values"),
  scale_range = c(" ", "0-1", "0-1")) #MARIA INSERT POSSIBLE BMI RANGE OR NA

#create gt table
bmi_scale_table <- bmi_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  #cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme() 

#print table
print(bmi_scale_table)
```

#### Descriptive Statistics

Descriptive statistics are presented below for BMI variables.

**Continuous values:** 

```{r bmi-cont-summary-table, results = 'asis'}
#apply function to calculate summary stats and create gt table
bmi_sum_tbl <- bio_df %>% 
  select(bmi1, bmi2, bmi_score) %>% 
  mutate_all(~ifelse(. == -99 | . == -55 , NA, as.numeric(.))) %>% 
  calc_cont_sum_stats() %>%
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
bmi_sum_tbl

```

**Allostatic load indicators:**  

```{r bmi-dichot-summary-table, results = 'asis'}
#create df - apply function to calculate summary stats and create
bmi_dichot_df <- bio_df %>% 
  select(starts_with("bmi")) %>%
  select(ends_with("al")) %>% 
  mutate_all(~ifelse(. == -99 | . == -55, NA, as.numeric(.))) %>% 
  calc_dichot_sum_stats()


#create table
bmi_tbl_dichot <- create_dichot_gt_table(bmi_dichot_df)

#print table
bmi_tbl_dichot


```

#### Distributions

Distributions are presented below for BMI scores and allostatic load indicators.

**BMI scores:** 

```{r bmi-avg-plot}
p_bmi_avg <- bio_df %>%
  mutate(across(bmi_score, ~ifelse(. == -99 | . == -55 , NA, as.numeric(.)))) %>% 
  composite_hist(x = bmi_score) + 
  labs(title = "Distribution of BMI Values") + 
  theme(plot.title = element_text(hjust = 0.5))
  
#print
p_bmi_avg

```

**Allostatic load indicators:**  

```{r bmi-cal-plots}
#bmi_cal
p_bmi_cal <- create_AL_plot(bio_df, "bmi_cal", "BMI Clinical \nAL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#bmi_pal
p_bmi_pal <- create_AL_plot(bio_df, "bmi_pal", "BMI Percentile-\nBased AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_bmi_cal, p_bmi_pal)

```

#### Clinical Categories

The distribution for BMI alongside the clinical and percentile-determined allostatic load cutoffs are presented below: 

```{r bmi-clinical-plot}
bio_df %>%
  filter(bmi_score != "-99" & bmi_score != "-55") %>% 
  mutate(bmi_score = as.numeric(bmi_score)) %>% 
  cutoff_plot2(
    x = bmi_score,
    cutoff = 30,
    cutoff_other = 36.52
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for BMI',
    caption = 'Clinical cutoff is 30 and \n percentile-determined cutoff is 36.5.'
  )+
  annotate("text", x = 40, y = 20, label = "Percentile") +
  annotate("text", x = 27.5, y = 20, label = "Clinical")


```

### Waist-to-Hip Ratio (WTH) Description

These data include variables on waist-to-hip ratio collected from participants. Higher scores indicate higher measurements. 

Using waist and hip measurements, waist-to-hip ratio was calculated. Allostatic load indicators for high waist-to-hip ratio were computed. The missing data rule was not applied since all participants who were asked WTH questions had valid data. Missing data for each variable presented in the descriptive statistics table below corresponds to "Not Applicable" values (`-55`).

### WTH Variables

#### Value Labels

Allostatic load indicators, `wth_cal`, `wth_pal`, are dichotomous:

```{r wth-al-labels, results = 'asis'}
# Print the dichot table
print(dichot_label_table)
```

#### Variables

All WTH variables are presented in the following table: 

```{r wth-var-tbl, results = 'asis'}
#create table for vars
print(create_bio_var_tbl(bio_md, "wth"))
```

#### Composite Variables

Using waist circumference and hip measurement collected from participants, waist-to-hip ratio was calculated. Two allostatic load indicators were calculated based on waist-to-hip ratio. One based on the clinical cut off for high waist-to-hip ratio (`wth_cal`) and the other is a percentile-based cut-off for waist-to-hip ratio (`wth_pal`) defined as the top 25% of values.

Reference: *<MARIA> INSERT REFERENCE for cutoffs, if applicable*


```{r wth-comp-tbl, results = 'asis'}
#create table of info for AL indicators
wth_scale_df <- data.frame(
  var_name = c("wth_ratio", "wth_cal", "wth_pal"),
  scale = c("Waist-to-hip ratio",
            "Allostatic load indicator based on clinical cut-off for high waist-to-hip ratio (1)",
            "Allostatic load indicator based on top 25% of waist-to-hip ratio values (1)"),
  scale_construction = c("`wth1`/`wth2`",
                         "`wth_ratio` > 0.84",
                         "Top 25% of observed `wth_ratio` values"),
  scale_range = c(" ", "0-1", "0-1")) #MARIA enter possible range for WTH ratio

#create gt table
wth_scale_table <- wth_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  apply_tbl_theme() 

#print table
print(wth_scale_table)
```

#### Descriptive Statistics

Descriptive statistics are presented below for WTH variables.

**Continuous values:** 

```{r wth-cont-summary-table, results = 'asis'}
#apply function to calculate summary stats and create gt table
wth_sum_tbl <- bio_df %>% 
  select(wth1, wth2, wth_ratio) %>% 
  mutate_all(~ifelse(. == -99 | . == -55 , NA, as.numeric(.))) %>% 
  calc_cont_sum_stats() %>% 
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
wth_sum_tbl

```

**Allostatic load indicators:**  

```{r wth-dichot-summary-table, results = 'asis'}
#create df - apply function to calculate summary stats and create
wth_dichot_df <- bio_df %>% 
  select(starts_with("wth")) %>%
  select(ends_with("al")) %>% 
  mutate_all(~ifelse(. == -99 | . == -55, NA, as.numeric(.))) %>% 
  calc_dichot_sum_stats()


#create table
wth_tbl_dichot <- create_dichot_gt_table(wth_dichot_df)

#print table
wth_tbl_dichot


```

#### Distributions

Distributions are presented below for WTH ratio and allostatic load indicators.

**WTH ratio values:** 

```{r wth-avg-plot}
p_wth_avg <- bio_df %>%
  mutate(across(wth_ratio, ~ifelse(. == -99 | . == -55 , NA, as.numeric(.)))) %>% 
  composite_hist(x = wth_ratio) + 
  labs(title = "Distribution of WTH Ratio Values") + 
  theme(plot.title = element_text(hjust = 0.5))
  
#print
p_wth_avg

```

**Allostatic load indicators:**  

```{r wth-cal-plots}
#wth_cal
p_wth_cal <- create_AL_plot(bio_df, "wth_cal", "WTH Ratio \nClinical AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#wth_pal
p_wth_pal <- create_AL_plot(bio_df, "wth_pal", "WTH Ratio \nPercentile-Based AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_wth_cal, p_wth_pal)

```

#### Clinical Categories

The distribution for waist-to-hip ratio alongside the clinical and percentile-determined allostatic load cutoffs are presented below: 

```{r wth-clinical-plot}
bio_df %>%
  filter(wth_ratio != "-99" & wth_ratio != "-55") %>% 
  mutate(wth_ratio = as.numeric(wth_ratio)) %>% 
  cutoff_plot2(
    x = wth_ratio,
    cutoff = .85,
    cutoff_other = .9765
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for WTH Ratio',
    caption = 'Clinical cutoff is 0.85 and \n percentile-determined cutoff is 0.98.'
  )+
  annotate("text", x = .799, y = 21.5, label = "Percentile") +
  annotate("text", x = 1.02, y = 21.5, label = "Clinical")

```


### Peak Expiratory Flow (PEF) Description

These data include variables on peak expiratory flow collected from participants, including direct peak expiratory flow and forced expiratory volume measurements. Lower scores indicate worse performance. 

Using peak expiratory flow values, average peak expiratory flow was calculated. Allostatic load indicators for high peak expiratory flow were also computed. The missing data rule was applied. Calculations were completed for participants with no missing data. Missing data for each variable is presented in the descriptive statistics table below.

### PEF Variables

#### Value Labels

Allostatic load indicators, `pef_cal`, `pef_pal`, are dichotomous:

```{r pef-al-labels, results = 'asis'}
# Print the dichot table
print(dichot_label_table)
```

#### Variables

All PEF variables are presented in the following table: 

```{r pef-var-tbl, results = 'asis'}
#create table for vars
print(create_bio_var_tbl(bio_md, "pef"))
```

#### Composite Variables

For peak expiratory flow, an average was computed. Using this average, two allostatic load indicators were calculated. One based on the clinical cut off for high peak expiratory flow (`pef_cal`) and the other is a percentile-based cut-off for peak expiratory flow (`pef_pal`) defined as the bottom 25% of values.

Reference: *<MARIA> INSERT REFERENCE for cutoffs, if applicable*


```{r pef-comp-tbl, results = 'asis'}
#create table of info for AL indicators
pef_scale_df <- data.frame(
  var_name = c("pef_avg", "pef_cal", "pef_pal"),
  scale = c("Average peak expiratory flow",
            "Allostatic load indicator based on clinical cut-off for low peak expiratory flow (1)",
            "Allostatic load indicator based on bottom 25% of peak expiratory flow values (1)"),
  scale_construction = c("(`pef1`+`pef2`+`pef3`) / 3",
                         "`pef_avg` < 320",
                         "Bottom 25% of observed `pef_avg` values"),
  scale_range = c(" ", "0-1", "0-1")) #MARIA enter possible range for pef average

#create gt table
pef_scale_table <- pef_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  apply_tbl_theme() 

#print table
print(pef_scale_table)
```

#### Descriptive Statistics

Descriptive statistics are presented below for PEF variables.

**Continuous values:** 

```{r pef-cont-summary-table, results = 'asis'}
#apply function to calculate summary stats and create gt table
pef_sum_tbl <- bio_df %>% 
  select(pef1, pef2, pef3, pef4, pef5, pef6, pef_avg) %>% 
  mutate_all(~ifelse(. == -99 | . == -55 , NA, as.numeric(.))) %>% 
  calc_cont_sum_stats() %>% 
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
pef_sum_tbl

```

**Allostatic load indicators:**  

```{r pef-dichot-summary-table, results = 'asis'}
#create df - apply function to calculate summary stats and create
pef_dichot_df <- bio_df %>% 
  select(starts_with("pef")) %>%
  select(ends_with("al")) %>% 
  mutate_all(~ifelse(. == -99 | . == -55, NA, as.numeric(.))) %>% 
  calc_dichot_sum_stats()


#create table
pef_tbl_dichot <- create_dichot_gt_table(pef_dichot_df)

#print table
pef_tbl_dichot


```

#### Distributions

Distributions are presented below for the average score and allostatic load indicators.

**PEF average:** 

```{r pef-avg-plot}
p_pef_avg <- bio_df %>%
  mutate(across(pef_avg, ~ifelse(. == -99 | . == -55 , NA, as.numeric(.)))) %>% 
  composite_hist(x = pef_avg) + 
  labs(title = "Distribution of average PEF Values") + 
  theme(plot.title = element_text(hjust = 0.5))
  
#print
p_pef_avg

```

**Allostatic load indicators:**  

```{r pef-cal-plots}
#pef_cal
p_pef_cal <- create_AL_plot(bio_df, "pef_cal", "PEF \nClinical AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#pef_pal
p_pef_pal <- create_AL_plot(bio_df, "pef_pal", "PEF \nPercentile-Based AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_pef_cal, p_pef_pal)

```

#### Clinical Categories

The distribution for average peak expiratory flow alongside the clinical and percentile-determined allostatic load cutoffs are presented below: 

```{r pef-clinical-plot}
bio_df %>%
  filter(pef_avg != "-99" & pef_avg != "-55") %>% 
  mutate(pef_avg = as.numeric(pef_avg)) %>% 
  cutoff_plot2(
    x = pef_avg,
    cutoff = 319,
    cutoff_other = 193.585
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for PEF',
    caption = 'Clinical cutoff is 319 and \n percentile-determined cutoff is 193.6.'
  )+
  annotate("text", x = 150, y = 13.5, label = "Percentile") +
  annotate("text", x = 354, y = 13.5, label = "Clinical")

#quantile(p$pef_avg, 0.25, na.rm = TRUE)

```


### Pulse Reading (PULSE) Description

These data include variables on pulse readings collected from participants. Higher scores indicate increased resting pulse rate. 

Using pulse readings, average pulse rate was calculated. Allostatic load indicators for high pulse rate were computed. The missing data rule was applied. Calculations were completed for participants with no missing data due to the low number of variables used in calculations. Missing data for each variable is presented in the descriptive statistics table below.

### PULSE Variables

#### Value Labels

Allostatic load indicators, `pulse_cal`, `pulse_pal`, are dichotomous:

```{r pulse-al-labels, results = 'asis'}
# Print the dichot table
print(dichot_label_table)
```

#### Variables

All PULSE variables are presented in the following table: 

```{r pulse-var-tbl, results = 'asis'}
#create table for vars
print(create_bio_var_tbl(bio_md, "pulse"))
```

#### Composite Variables

Using both resting pulse readings, average pulse rate was calculated. Two allostatic load indicators were calculated based on average pulse rate. One based on the clinical cut off for high resting pulse (`pulse_cal`) and the other is a percentile-based cut-off for resting pulse (`pulse_pal`) defined as the top 25% of values.

Reference: *<MARIA> INSERT REFERENCE for cutoffs, if applicable*


```{r pulse-comp-tbl, results = 'asis'}
#create table of info for AL indicators
pulse_scale_df <- data.frame(
  var_name = c("pulse_avg", "pulse_cal", "pulse_pal"),
  scale = c("Average resting pulse",
            "Allostatic load indicator based on clinical cut-off for high resting pulse (1)",
            "Allostatic load indicator based on top 25% of average resting pulse values (1)"),
  scale_construction = c("(`pulse1`+`pulse2`) / 2",
                         "`pulse_avg` > 89",
                         "Top 25% of observed `pulse_avg` values"),
  scale_range = c(" ", "0-1", "0-1")) #MARIA enter possible range for pulse 

#create gt table
pulse_scale_table <- pulse_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  apply_tbl_theme() 

#print table
print(pulse_scale_table)
```

#### Descriptive Statistics

Descriptive statistics are presented below for PULSE variables.

**Continuous values:** 

```{r pulse-cont-summary-table, results = 'asis'}
#apply function to calculate summary stats and create gt table
pulse_sum_tbl <- bio_df %>% 
  select(pulse1, pulse2, pulse_avg) %>% 
  mutate_all(~ifelse(. == -99 | . == -55 , NA, as.numeric(.))) %>% 
  calc_cont_sum_stats() %>% 
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
pulse_sum_tbl

```

**Allostatic load indicators:**  

```{r pulse-dichot-summary-table, results = 'asis'}
#create df - apply function to calculate summary stats and create
pulse_dichot_df <- bio_df %>% 
  select(starts_with("pulse")) %>%
  select(ends_with("al")) %>% 
  mutate_all(~ifelse(. == -99 | . == -55, NA, as.numeric(.))) %>% 
  calc_dichot_sum_stats()


#create table
pulse_tbl_dichot <- create_dichot_gt_table(pulse_dichot_df)

#print table
pulse_tbl_dichot


```

#### Distributions

Distributions are presented below for average resting pulse and allostatic load indicators.

**Average PULSE value:** 

```{r pulse-avg-plot}
p_pulse_avg <- bio_df %>%
  mutate(across(pulse_avg, ~ifelse(. == -99 | . == -55 , NA, as.numeric(.)))) %>% 
  composite_hist(x = pulse_avg) + 
  labs(title = "Distribution of Average Resting Pulse Values") + 
  theme(plot.title = element_text(hjust = 0.5))
  
#print
p_pulse_avg

```

**Allostatic load indicators:**  

```{r pulse-cal-plots}
#pulse_cal
p_pulse_cal <- create_AL_plot(bio_df, "pulse_cal", "PULSE \nClinical AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#pulse_pal
p_pulse_pal <- create_AL_plot(bio_df, "pulse_pal", "PULSE \nPercentile-Based AL Indicator") +
  theme(plot.title = element_text(hjust = 0.5))

#arrange
ggarrange(p_pulse_cal, p_pulse_pal)

```

#### Clinical Categories

The distribution for average resting pulse rate alongside the clinical and percentile-determined allostatic load cutoffs are presented below: 

```{r pulse-clinical-plot}
bio_df %>%
  filter(pulse_avg != "-99" & pulse_avg != "-55") %>% 
  mutate(pulse_avg = as.numeric(pulse_avg)) %>% 
  cutoff_plot2(
    x = pulse_avg,
    cutoff = 90,
    cutoff_other = 87.5
  ) +
  labs(
    title = 'Allostatic Load Cutoff Values for PULSE',
    caption = 'Clinical cutoff is 90 and \n percentile-determined cutoff is 87.5.'
  )+
  annotate("text", x = 81.5, y = 17, label = "Percentile") +
  annotate("text", x = 94.5, y = 17, label = "Clinical")

#quantile(p$pulse_avg, 0.75, na.rm = TRUE)
```


### Total Allostatic Load (TOTAL) Description

These data include one variable representing total allostatic load. It is a count of all allostatic load indicators in the full data set, including allostatic load indicators from the Dried Blood Spot assessment (DBS). Higher scores indicate increased allostatic load. 

The missing data rule was applied. Calculations were completed for participants that has less than 20% missing data on allostatic load indicators. Missing data for total allostatic load is presented in the descriptive statistics table below.

### TOTAL Variables

#### Value Labels

There are no value labels, this variable is a count. 

#### Variables

Information for the `total_al` variable is presented in the following table: 

```{r total-var-tbl, results = 'asis'}
#create table for vars
print(create_bio_var_tbl(bio_md, "total"))
```

#### Composite Variables

The total allostatic load score was calculated by creating a sum of all clinical allostatic load indicator variables (ending in `_cal`), including those in the DBS data collection. The percentile-based allostatic load indicator was used for Epstein-Barr virus (`ebv_pal`) since a clinical indicator was not calculated. 

Reference: *<MARIA> INSERT REFERENCE for cutoffs, if applicable*


```{r total-comp-tbl, results = 'asis'}
#create table of info for AL indicators
total_scale_df <- data.frame(
  var_name = c("total_al"),
  scale = c("Total allostatic load score"),
  scale_construction = c("`bp_sys_cal` + `bp_dia_cal` + `bmi_cal` + `wth_cal` + \n`pef_cal` + `pulse_cal`+
                         `a1c_cal` + `cho_cal` + `crp_cal` + \n`ebv_pal` + `hdl_cal` + `il6_cal` + `trp_cal`"),
  scale_range = c("0-13"))  

#create gt table
total_scale_table <- total_scale_df %>%
  gt() %>% 
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Description (# of items)", 
            scale_construction = "Composite Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  fmt_markdown() %>% 
  apply_tbl_theme() 

#print table
print(total_scale_table)
```

#### Descriptive Statistics

Descriptive statistics are presented below for the total allostatic load score:

```{r total-cont-summary-table, results = 'asis'}
#apply function to calculate summary stats and create gt table
total_sum_tbl <- bio_df %>% 
  select(total_al) %>% 
  mutate_all(~ifelse(. == -99 | . == -55 , NA, as.numeric(.))) %>% 
  calc_cont_sum_stats() %>% 
  gt() %>%
  cols_label(Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
total_sum_tbl

```


#### Distributions

Distributions are presented below for the total allostatic load score:

```{r total-avg-plot}
p_total_avg <- bio_df %>%
  mutate(across(total_al, ~ifelse(. == -99 | . == -55 , NA, as.numeric(.)))) %>% 
  composite_hist(x = total_al) + 
  labs(title = "Distribution of Total Allostatic Load Score") + 
  theme(plot.title = element_text(hjust = 0.5))
  
#print
p_total_avg

```

#### Clinical Categories

The distribution for total allostatic load score alongside the clinical and percentile-determined cutoffs are presented below: 

```{r total-clinical-plot}
# bio_df %>%
#   filter(total_al != "-99" & total_al != "-55") %>% 
#   mutate(total_al = as.numeric(total_al)) %>% 
#   cutoff_plot2(
#     x = total_al,
#     cutoff = 90,
#     cutoff_other = 87.5
#   ) +
#   labs(
#     title = 'Clinical Cutoff Values for Total AL Score',
#     caption = 'Clinical cutoff is 90 and \n percentile-determined cutoff is 87.5.'
#   )+
#   annotate("text", x = 81.5, y = 17, label = "Percentile") +
#   annotate("text", x = 94.5, y = 17, label = "Clinical")

```


### RAND Health Survey, SF-36 (RHS)

The RAND Health Survey SF-36 (RHS) is designed to measure health concepts, such as limitations, well-being, and general health. 

For the present study, 12 out of the 36 items from the RHS were collected in order to calculate the **General health**, **Role limitations due to physical health**, and **Role limitations due to emotional problems** subscales.
    + **General health** reflects ... <MARIA> INSERT INFO
    + **Role limitations due to physical health** reflects ...
    + **Role limitations due to emotional problems** reflects...

Item numbers in this data set may not match original item numbers from the RHS-SF36. See the following table for corresponding item numbers from the original RHS_SF36:

MAKE HTML TABLE WITH OG VARIABLE NUMBERS (OR CREATE TEMPLATE FOR SOMEONE TO FILL OUT)

REVERSE SCORED

PERCENTAGE VARS

HIGHER SCORES INDICATE...

MISSING DATA RULE

FOLLOW MAIN CODEBOOK SURVEY DATA DESCRIPTION AND FLOW FOR REST OF SECTIONS




### ... ETC
(bio measures from bio file and AL indicators, and total AL)

**explain data file**

**explain total AL as own table/section OR as total score from other health measures?**
