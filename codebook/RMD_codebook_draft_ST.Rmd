---
title: "Turning Points Codebook"
#  author: 
#    - name: "Maria L. Schweer-Collins, PhD (corresponding author)"
#      email: "mschweer@uoregon.edu"
# #     affiliations:
# #       - name: 'University of Oregon'
# #         city: 'Eugene'
# #         state: 'OR'
#    - name: "Shaina Trevino, PhD"
# #     email: "strevino@uoregon.edu"
#    - name: "Jonathan A. Pedroza, PhD"
# #     email: "cpppedroza@gmail.com"
#    - name: "Min Zhang"
# #     email: "mzhang8@uoregon.edu"
date: ""
output: 
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
    self_contained: yes
    number_sections: no
    #html#toc_title: Contents
    #number_sections: true
    #html#number_depth: 3
    #qmd#colorlinks: true
    #keep_tex: yes
    #pdf#latex_engine: pdflatex
    #error#includes: 
      #error#in_header: styles.css
#pdf#geometry: landscape
bibliography: tpw_references.bib
editor_options: 
  markdown: 
    wrap: 72
---
<!-- TOC highlight color -->
<style>
.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    background-color: #246B69;
}


<!-- To have nice indentation in toc float -->
.tocify-header {
  text-indent: initial;
}

.tocify-subheader > .tocify-item {
  text-indent: initial;
  padding-left: 2em;
}

</style>
TODO: double check codebook_fun.r composite_total_avg_fun

```{r setup, include = FALSE}
library(tidyverse)
library(here)
library(gt)
library(ggplot2)
library(scales)
library(ggpubr)


knitr::opts_chunk$set(warning = FALSE,
                      message = FALSE,
                      echo = FALSE)

theme_set(theme_light())

#import included survey items
# data <- read_csv(here("do_not_push", "tpw_data_77included.csv"))

#import df of calculated survey items
#complete_rnd2 <- read_csv(here("do_not_push", "round_two_measures_data_calc.csv"))

# import telephone survey data 
complete <- read_csv(here("do_not_push","tpw_archive_calc.csv"))

# import survey data header for parsing question text
# Maria to update filename
qualtrics <- read_csv(here("do_not_push", "tpw_raw_qualtrics_5-30-23.csv"))

source(here("functions", "codebook_fun.R"))
```

```{r plot-style, echo=FALSE}
# Color palettes 
 Two_color = c("#246B69", "#604C41")

# Histogram style 
# hist_style <- geom_histogram(bins=20, color = "white", fill = "#246B69", alpha = 0.7)


bar_style <- geom_bar(color = "white", fill = "#246B69", alpha = 0.7)

THEME <-     theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(fill = "transparent"),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black",size = .8),
          axis.text = element_text(size = 10), axis.title = element_text(size = 10),
          legend.text = element_text(size = 10),legend.key = element_rect(fill = "White", colour = "transparent"),plot.title = element_text(size= 13),
    )
```

```{r cutoff-plot-function}
#re-work JP cutoff function due to error "cant use `{{` in non-quoting function
cutoff_plot2 <- function(data,
                        x,
                        cutoff = 0,
                        cutoff_color = '#324B4A',
                        cutoff_other = NULL,
                        cutoff_other_color = '#95B1AF',
                        cutoff_other2 = NULL,
                        cutoff_other2_color = '#546085',
                        bins = 20) {

  library(magrittr)
  library(dplyr)
  library(ggplot2)

  x <- enquo(x)

  if (is.null(cutoff_other)) {
    data %>%
      ggplot(aes(!!x)) +
      geom_histogram(bins = bins,
                     color = 'white',
                     fill = '#246B69',
                     alpha = .7) +
      geom_vline(xintercept = cutoff,
                 color = cutoff_color,
                 linetype = 2,
                 linewidth = 1.25)+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(fill = "transparent"),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black",size = .8),
          axis.text = element_text(size = 10), axis.title = element_text(size = 10),
          legend.text = element_text(size = 10),
          legend.key = element_rect(fill = "White",
                                    colour = "transparent"),
          plot.title = element_text(size= 20),
          #scale_x_discrete(guide = guide_axis(n.dodge=3))
    )
  } else if (is.null(cutoff_other2)) {
    data %>%
      ggplot(aes(!!x)) +
      geom_histogram(bins = bins,
                     color = 'white',
                     fill = '#246B69',
                     alpha = .7) +
      geom_vline(xintercept = cutoff,
                 color = cutoff_color,
                 linetype = 2,
                 linewidth = 1.25) +
      geom_vline(xintercept = cutoff_other,
                 color = cutoff_other_color,
                 linetype = 3,
                 linewidth = 1.25)+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(fill = "transparent"),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black",size = .8),
          axis.text = element_text(size = 10), axis.title = element_text(size = 10),
          legend.text = element_text(size = 10),
          legend.key = element_rect(fill = "White",
                                    colour = "transparent"),
          plot.title = element_text(size= 13),
          #scale_x_discrete(guide = guide_axis(n.dodge=3))
    )
  } else {
    data %>%
      ggplot(aes(!!x)) +
      geom_histogram(bins = bins,
                     color = 'white',
                     fill = 'black',
                     alpha = .7) +
      geom_vline(xintercept = cutoff,
                 color = cutoff_color,
                 linetype = 2,
                 linewidth = 1.25) +
      geom_vline(xintercept = cutoff_other,
                 color = cutoff_other_color,
                 linetype = 3,
                 linewidth = 1.25) +
      geom_vline(xintercept = cutoff_other2,
                 color = cutoff_other2_color,
                 linetype = 4,
                 linewidth = 1.25)+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(fill = "transparent"),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black",size = .8),
          axis.text = element_text(size = 10), axis.title = element_text(size = 10),
          legend.text = element_text(size = 10),
          legend.key = element_rect(fill = "White",
                                    colour = "transparent"),
          plot.title = element_text(size= 13),
          #scale_x_discrete(guide = guide_axis(n.dodge=3))
    )
  }
}

# gt-theme-general
apply_tbl_theme <- function(table) {
  table %>% 
  tab_style(style = list(cell_borders(sides = "all", color = "black", weight = px(1))),
            locations = cells_body(columns = everything())) %>% 
  tab_style(style = list(cell_borders(sides = "all", color = "black", weight = px(1)),
                         cell_fill(color = "#246B69", alpha = .7)),
            locations = cells_column_labels()) %>% 
  tab_options(column_labels.border.top.color = "black",
              column_labels.border.bottom.color = "black",
              table_body.border.bottom.color = "black",
              table.border.top.color = "white",
              heading.border.bottom.color = "black",
              table_body.hlines.color = "white")%>% 
  tab_options(table.align = "left")
}

#theme for value label tables
apply_labtab_theme <- function(table) {
  table %>% 
  cols_align(columns = everything(), align = "center") %>% 
  tab_style(style = list(cell_borders(sides = "all", color = "black", weight = px(1))),
            locations = cells_body(columns = everything())) %>% 
  tab_style(style = list(cell_borders(sides = "all", color = "black", weight = px(1)),
                         cell_fill(color = "#246B69", alpha = .7)),
            locations = cells_column_labels()) %>% 
  tab_options(column_labels.border.top.color = "black",
              column_labels.border.bottom.color = "black",
              table_body.border.bottom.color = "black",
              table.border.top.color = "white",
              heading.border.bottom.color = "black",
              table_body.hlines.color = "white") %>% 
  tab_options(table.align = "left")
}
  
```
# Overview

<MARIA>INSERT BRIEF INFO ON STUDY, SAMPLE, AND AIMS

*Additional info to possibly include: global missing data info, links to
supplemental materials, any disclaimers/info we think data users need to
know to use these data accurately*

### Data and Study Author Contact

If you have questions about the data or study, please contact the Principal Investigator, Maria Schweer-Collins through email and please use the subject "NACJD Turning Points Data Query" in the subject line. You can contact Maria through email at mariasc@iastate.edu.

### Credit Author Statement

**Schweer-Collins** conceptualization; software; validation; data curation (specifically checking code for data cleaning and codebook creation, managed data archival) project administration; supervision; funding acquisition; **Trevino** software; validation; data curation (specifically developing codebook, functions, and protocols, data cleaning, codebook creation; data archival); supervision; **Pedroza** software; data curation (specifically making functions used in codebook, data retrieval from Qualtrics; cleaning; codebook creation, visualization); **Zhang** software; validation; data curation (specifically making functions used in codebook, primary responsibility for data retrieval from Qualtrics; data cleaning, codebook creation, visualization)

### Study Acronymns

-   **TP**: this acrononym is used to refer to the name of this study, the **T**urning **P**oints Study for Women. References in this codebook and in subsequent publications regarding the Turning Points study may or may not include data only from this assessment or data that also draw on the prior 13 waves of data, as we use this study name to refer to the entire longitudinal study.

-   **TC**: In this study, we refer to original participants as **TCs**, which means 'Target Child.' This acronymn has been continued because the original participants were minors at the start of this longitudinal study. Please note that we have continued to use this acronym to distinguish our original sample from other participants (e.g., partners of original participants, the offspring of original participants). The data represented in this codebook were collected only from original participants, not from partners, caregivers, or offspring. 

-   **NIJ**: NIJ is the acronym for the National Institute of Justice. NIJ funded this study and therefore the organization is referred to throughout our documentation and forthcoming publications and presentations.


### Data Documentation Structure
<SHAINA>INSERT BRIEF DESCRIPTION OF DATA/CODEBOOK LAYOUT/FILE STRUCTURE
(can complete once we have more sections and overall structure)

### Missing Data

-   Truly missing = `NA` (blank in file or -99): The question should
    have been asked of the respondent, but for a reason other than those
    listed below, no answer was given or recorded.

    This -99 is also given in the case of a computed subscale or total
    score or other summary when the percentage of missing data is
    outside what is allowable for missing data rules

-   Not Applicable = -55: The subject was never asked a question for
    some reason (conditional question)

-   Don't Know = -66: The subject was unable to answer a question,
    either because he or she had no opinion or because the required
    information was not available (could not recall).

-   Refusal/No Answer = -77: The subject explicitly refused to answer a
    question or did not answer it when he or she should have.

-   No Match = -88: This situation arises when data are drawn from
    different sources (for example, a survey questionnaire and an
    administrative database), and information from one source cannot be
    located.

-   Processing Error = -44: For some reason, there is no answer to the
    question, although the subject provided one. This can result from
    interviewer error, incorrect coding, machine failure, or other
    problems

### Missing Data Rule

For summary or subscale scores that are computed with individual items, any of the above reasons are included in computing the percent of missing data. The following missing data rules are below and follow procedures used throughout the history of this longitudinal study. In some cases, measure specific guidelines for handling missing data were used when those guidelines were more stringent. Exceptions are called out within individual measure documentation.
Note that 

-   For scales with [10 or more items]{.underline}, a composite score
    (average/total) is computed for each participant that have less than
    [20%]{.underline} of the items from that measure missing

-   For scales with [7 to 9 items]{.underline}, a composite score
    (average/total) is computed for each participant that have less than
    [30%]{.underline} of the items from that measure missing

-   For scales with [3 to 6 items]{.underline}, a composite score
    (average/total) is computed for each participant that have less than
    [33%]{.underline} of the items from that measure missing

-   For scales with [only 2 items]{.underline}, composite scores
    (average/total) are calculated on a [case by case basis]{.underline}



# Mental Health/Psychological Measures

## Brief Symptom Inventory (BSI)

### BSI Description

The Brief Symptom Inventory (BSI) is designed to reflect psychological symptom patterns of psychiatric and medical patients. The BSI instrument is especially appropriate in clinical situations where debilitation results in reduced attention and endurance, in research with limited interview schedules, and in outpatient clinics where testing procedures demand brevity. The BSI instrument is also frequently used in measuring patient progress during treatment or in the assessment of treatment outcome.

*   For the present study, 19 items from the BSI were collected in order to calculate the **Somatization**, **Anxiety**, and **Depression** raw subscales.

    + **Somatization** reflects distress arising from perceptions of bodily dysfunction.
    + **Anxiety** reflects general signs such as nervousness and tension are included in the Anxiety dimension, as are panic attacks and feelings of terror.
    + **Depression** reflects symptoms of dysphoric mood and affect are represented as are lack of motivation and loss of interest in life.
    
  * Item numbers in this data set may not match original item numbers from
the BSI. Please reference this guide to see match with original BSI (original BSI item number in *italics*): 01 = *01*, 02 = *02*, 03 = *07*, 04 = *09*, 05 = *12*, 06 = *16*, 07 = *17*, 08 = *18*, 09 = *19*, 10 = *23*, 11 = *29*, 12 = *30*, 13 = *33*, 14 = *35*, 15 = *37*, 16 = *38*, 17 = *45*, 18 = *49*, 19 = *50* 

  * No items need to be reverse scored. 

  * **Higher** scores indicate **more** severe
psychological symptoms.

  * The missing data rule was not applied. The only missing data in this measure reflects responses not collected on `bsi4` due to our protocols for participants who were incarcerated at the time of the assessment. According to the BSI manual, up to one item can be missing from each subscale to obtain valid subscale scores.

Reference:
[@derogatis1983brief](https://www.cambridge.org/core/journals/psychological-medicine/article/abs/brief-symptom-inventory-an-introductory-report/307F805810B165ED58581E355F24329F);

### BSI Variables

#### Value Labels

All BSI variables have the same response options.

```{r BSI-label-table, results = 'asis'}

bsi_label_df <- data.frame(
  value = c("0", "1", "2", "3", "4"),
  label = c("Not at all",
            "A little bit",
            "Moderately",
            "Quite a bit",
            "Very much")
) %>% 
  t() %>% 
  as.data.frame()

bsi_label_df <- setNames(bsi_label_df[-1, ], unlist(bsi_label_df[1, ]))


#create table
bsi_label_table <- bsi_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(bsi_label_table)


```

#### Survey Items

BSI survey items are presented in the following table:

**Question stem: During the past week, how much were you bothered by...**

```{r BSI-var-prep}
# Pull question wording from Qualtrics data
bsi_word <- qualtrics %>% 
  select(starts_with("BSI")) %>% 
  slice(1)

#create table with variable name, description, and notes
bsi_word_long <- bsi_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = str_replace(description, "During the past week,", ""),
         description = str_replace(description, regex("how much were you bothered by", ignore_case = TRUE), ""),
         var_name = str_to_lower(var_name), 
          notes = case_when(var_name == "bsi4" ~ "This was not asked for participants who were incarcerated at the time of the assessment",
                           TRUE ~ as.character(""))) %>% 
  slice(1:19)

```

```{r BSI-var-table, results ='asis'}
# Create the gt table object and apply generic theme
my_gt_table <- gt(bsi_word_long)

# Table-specific formatting (col width, names)
my_gt_table <- my_gt_table %>% 
  cols_label(var_name = "Variable", 
            description = "Description",
            notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(description ~ px(300),
             var_name ~ px(100)
             ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(my_gt_table)

#WHEN RENDERING WITH PDF USE: 
#my_gt_table
```

#### Scale and Subscales

Information on the subscale variables are below.
Variables were constructed by averaging the included items. 

```{r bsi alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 

bsi_alpha_som <-
  complete %>%
  select(bsi2,bsi3,
         bsi10, bsi11, bsi12, bsi13,
         bsi15) %>%
  psych::alpha(check.keys = TRUE)

bsi_alpha_anx <-
  complete %>%
  select(bsi1, bsi5, bsi9, bsi16, bsi17, bsi18) %>%
  psych::alpha(check.keys = TRUE)

bsi_alpha_dep <- complete %>%
  select(bsi4, bsi6, bsi7, bsi8, bsi14, bsi19) %>%
  filter(across(everything(), ~. >= 0)) %>%
  psych::alpha(check.keys = TRUE)

```

```{r BSI-scale-table, results = 'asis'}
# Create the table as a data frame
bsi_scale_df <- data.frame(
  var_name = c("bsi_soma", "bsi_anx", "bsi_dep"),
  scale = c("Somatization (7)", "Anxiety (6)", "Depression (6)"),
  scale_construction = c("`bsi2`, `bsi3`, `bsi10`, `bsi11`, `bsi12`, `bsi13`, `bsi15`",
                           "`bsi1`, `bsi5`, `bsi9`, `bsi16`, `bsi17`, `bsi18`",
                           "`bsi4`, `bsi6`, `bsi7`, `bsi8`, `bsi14`, `bsi19`"),
  scale_range = c("0-4", "0-4", "0-4"),
  alpha = c(round(bsi_alpha_som$total$raw_alpha, 3), 
            round(bsi_alpha_anx$total$raw_alpha, 3), 
            round(bsi_alpha_dep$total$raw_alpha, 3))
)

# Create the gt table object
bsi_scale_table <- gt(bsi_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Scale (# of items)", 
            scale_construction = "Scale Construction",
            scale_range = "Range*",
            alpha = "Alpha") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  #cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme() 

# Print the table
print(bsi_scale_table)

```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item and subscale raw score:

```{r bsi-mean-items}
# Create subset of BSI items
data_subset <- complete %>%
  select(bsi1:bsi19, bsi_soma, bsi_anx, bsi_dep)

# Calculate the summary statistics for each variable
## mean is showing 2 decimals per authors
summary_data <- lapply(data_subset, function(x) {
  x <- replace(x, (x < -40 & x!= -55 & x!= -88), NA)  # Your original recoding
  x <- replace(x, (x == "-44" | x== "-77" | x== "-99"), NA)  # Additional recoding
  # Exclude negative values and specific negative values from calculations
  x_no_negatives <- replace(x, (x < 0 | x == -44 | x == -77 | x == -99), NA)
  mean_val <- ifelse(all(is.na(x_no_negatives)), NA, sprintf("%.2f", round(mean(x_no_negatives, na.rm = TRUE), 2)))
  sd_val <- ifelse(all(is.na(x_no_negatives)), NA, round(sd(x_no_negatives, na.rm = TRUE), 2))
  range_val <- ifelse(all(is.na(x_no_negatives)), NA, paste(min(x_no_negatives, na.rm = TRUE), max(x_no_negatives, na.rm = TRUE), sep = "-"))
  miss_val <- round(mean(is.na(x)) * 100, 2)  # Calculate missing value percentage using original x
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})


# Convert summary_data to a data frame
summary_data <- as.data.frame(summary_data)

# Set items as first row
summary_data <- rbind(names(summary_data), summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
tbl <- summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
tbl

```

#### Distributions

Distributions are presented below for each subscale:

```{r bsi-distributions, class.source='fold', echo = FALSE}

p_bsi_soma <- complete %>%
  composite_hist(x = bsi_soma) 

p_bsi_anx <- complete %>%
  composite_hist(x = bsi_anx) 

p_bsi_dep <- complete %>%
  composite_hist(x = bsi_dep) 

ggarrange(p_bsi_soma + rremove("ylab"), 
          p_bsi_anx, p_bsi_dep + rremove("ylab")) %>%
  annotate_figure(top = text_grob( "Distribution for BSI Subscales \n(x-axis and y-axis are in different scales)"))
```


## Center for Epidemiologic Studies Depression Scale (CES-D)

### CES-D Description

The Center for Epidemiological Studies â€“ Depression Scale (CES-D) is a self-report measure with 20 items comprising six scales reflecting major dimensions of depression: depressed mood, feelings of guilt and worthlessness, feelings of helplessness and hopelessness, psychomotor retardation, loss of appetite, and sleep disturbance.

  * All 20 items from the CES-D were collected and a depression subscale was calculated: **depressive symptoms**. 
  
  * Four items (`c4`, `c8`, `c12`, and `c16`) should be reverse scored which is noted in the variable table below and the reverse scored variables are provided (`c4_r`, `c8_r`, `c12_r`, and `c16_r`). 

  * **Higher** scores indicate the presence of **greater** depression symptoms.

  * Four additional variables (`c21`-`c24`) were included in this section to assess suicidality. Variables `c22` and `c23` are only applicable if
participants responded "Yes" to `c21`.

  * The missing data rule was not applied since all participants had less than 20% missing data. Missing data for each variable is presented in the descriptive statistics table below.

Reference:
[@radloff1977ces](https://journals.sagepub.com/doi/abs/10.1177/014662167700100306);


-   Additional References:

    -   Cutoff Information:
        [@henry2018determining](https://www.sciencedirect.com/science/article/pii/S0165032717319274?casa_token=Aan1lg2Z8mUAAAAA:aun9j7DwQRQLhRqhbBJQfpPQG4fDv4yjN1WGHvzv-Hh9Pu58f7IhyGyPTDJmeAUZWonwmO7tfi4)
      

    -   Items for Potential Subscales:
        [@canady2009measurement](https://connect.springerpub.com/content/sgrjnm/17/2/91.abstract)

### CES-D Variables

#### Value Labels

All CES-D survey items (`c1`-`c20`) have the same response options.

```{r CESD-label-table, results = 'asis'}

cesd_label_df <- data.frame(
  value = c("0", "1", "2", "3"),
  label = c("Rarely or none of the time",
            "Some or a little of the time",
            "Occasionally or a moderate amount of time",
            "Most or all of the time")
) %>% 
  t() %>% 
  as.data.frame()

cesd_label_df <- setNames(cesd_label_df[-1, ], unlist(cesd_label_df[1, ]))


#create table
cesd_label_table <- cesd_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(cesd_label_table)


```

Additional variables on suicidality (`c21`-`c24`) share the same response options.

```{r CESD-label-table2, results = 'asis'}

cesd2_label_df <- data.frame(
  value = c("0", "1"),
  label = c("No",
            "Yes")
) %>% 
  t() %>% 
  as.data.frame()

cesd2_label_df <- setNames(cesd2_label_df[-1, ], unlist(cesd2_label_df[1, ]))


#create table
cesd2_label_table <- cesd2_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme() 

# Print the table
print(cesd2_label_table)


```

#### Survey Items

All CES-D survey items are presented in the following table:

**Question stem: During the past week...**

```{r CESD-var-prep}
# Pull question wording from qualtrics data
cesd_word <- qualtrics %>% 
  select(C1:C24) %>% 
  slice(1)

#create table with variable name, description, and notes
cesd_word_long <- cesd_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name), 
         #description = case_when(var_name == "c21" ~ "In the past 6 months, have you ever thought about killing yourself?"),
         notes = case_when(var_name == "c4" ~ "This item should be reverse scored. `c4_r` is reverse scored",
                           var_name == "c8" ~ "This item should be reverse scored. `c8_r` is reverse scored",
                           var_name == "c12" ~ "This item should be reverse scored. `c12_r` is reverse scored",
                           var_name == "c16" ~ "This item should be reverse scored. `c16_r` is reverse scored",
                           
                           var_name %in% c("c22", "c23") ~ "Skipped if answered No for `c21`. \nThis was not asked for participants who were incarcerated at the time of the assessment",
                           var_name %in% c("c21","c24") ~ "This was not asked for participants who were incarcerated at the time of the assessment",
                           TRUE ~ as.character(""))) %>%
  mutate(description = if_else(var_name == "c21", "In the past 6 months, have you ever thought about killing yourself?", description))
  

```

```{r CESD-var-table, results ='asis'}
# Create the gt table object and apply generic theme
cesd_gt_table <- gt(cesd_word_long)

# Table-specific formatting (col width, names)
cesd_gt_table <- cesd_gt_table %>% 
  cols_label(var_name = "Variable", 
            description = "Description",
            notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(250),
             var_name ~ px(100)) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(cesd_gt_table)

```

#### Scale and Subscales

Information on the depression subscale is shown below. The depression symptoms subscale was constructed by summing corresponding items.

```{r cesd-alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 

cesd_alpha <-
  complete %>%
  select(c1:c3,c4_r,c5:c7,c8_r,c9:c11,c12_r,c13:c15,c16_r,c17:c20) %>%
  filter(across(everything(), ~. >= 0)) %>%
  psych::alpha(check.keys = TRUE)


cesd_alpha_table <- tibble(
  Scale = c('CESD - Depressive Symptoms'),
  Alpha = c(round(cesd_alpha$total$raw_alpha, 3)
  )
)
```

```{r CESD-scale-table, results = 'asis'}
# Create the table as a data frame

cesd_scale_df <- data.frame(
  var_name = c("cesd_dep_symp"),
  scale = c("Depression Symptoms (20)"),
  scale_construction = c("`c1`, `c2`, `c3`, `c4_r`, `c5`, `c6`, `c7`, `c8_r`, `c9`, `c10`, `c11`, `c12_r`, `c13`, `c14`, `c15`, `c16_r`, `c17`, `c18`, `c19`, `c20`"),
  scale_range = c("0-60"),
  alpha = c(round(cesd_alpha$total$raw_alpha, 3))
)

# Create the gt table object
cesd_scale_table <- gt(cesd_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Scale (# of items)", 
            scale_construction = "Scale Construction",
            scale_range = "Range*",
            alpha = "Alpha") %>% 
  tab_footnote(footnote = "*Range of possible values; `_r` Reverse scored variable") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme()

# Print the table
print(cesd_scale_table)

```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item and subscale score:

```{r cesd-mean-items}
# Create subset of CESD items
data_subset_cesd <- complete %>%
  select(c1:c24, cesd_dep_symp)

# Calculate the summary statistics for each variable
summary_df_cesd <- lapply(data_subset_cesd, function(x) {
  x <- replace(x, (x < -40 & x!= -55 & x!= -88), NA)  # Your original recoding
  x <- replace(x, (x == "-44" | x== "-77" | x== "-99"), NA)  # Additional recoding
  # Exclude negative values and specific negative values from calculations
  x_no_negatives <- replace(x, (x < 0 | x == -44 | x == -77 | x == -99), NA)
  mean_val <- ifelse(all(is.na(x_no_negatives)), NA, sprintf("%.2f", round(mean(x_no_negatives, na.rm = TRUE), 2)))
  sd_val <- ifelse(all(is.na(x_no_negatives)), NA, round(sd(x_no_negatives, na.rm = TRUE), 2))
  range_val <- ifelse(all(is.na(x_no_negatives)), NA, paste(min(x_no_negatives, na.rm = TRUE), max(x_no_negatives, na.rm = TRUE), sep = "-"))
  miss_val <- round(mean(is.na(x)) * 100, 2)  # Calculate missing value percentage using original x
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
summary_df_cesd <- as.data.frame(summary_df_cesd) %>% 
  rbind(names(summary_df_cesd)) %>% 
  t() %>% 
  as.data.frame() %>% 
  select(`5`, everything())

# Create the gt table
cesd_tbl <- summary_df_cesd %>%
  gt() %>%
  cols_label(`5` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(`5` ~ px(170)) %>%
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
cesd_tbl

```

#### Distributions

Distributions are presented below for depression symptoms subscale:

```{r cesd-distributions, class.source='fold', echo = FALSE}
p_cesd_dep_symp <- complete %>%
  composite_hist(
    cesd_dep_symp
    ) +
  labs(
    title = 'Depression Symptoms'
    )

ggarrange(p_cesd_dep_symp) %>%
  annotate_figure(top = text_grob( "Distribution for CESD Depression Symtpoms"))

```


## Coronavirus Impacts Questionnaire (CIQ)

### CIQ Description

The CIQ is self-report survey used to assess the financial, resource,
and psychological impacts of the COVID-19 pandemic.

  * For the present study, only 3 items from the CIQ were collected in order to construct the psychological impacts scale. We made this decision because data collection launched in the COVID-19 pandemic, whereas prior waves occurred before the onset of the COVID-19 pandemic.

  * `ciq1` need to be reverse scored. 

  * **Higher**scores indicate **greater** psychological impacts of COVID-19.

  * The missing data rule was not applied since there is no missing data
among CIQ variables.

Reference: [@conway2020social](https://psyarxiv.com/z2x9a/)

### CIQ Variables

#### Value Labels

All CIQ variables have the same response options.

```{r ciq-label-table, results = 'asis'}

ciq_label_df <- data.frame(
  value = seq(1:7),
  label = c("Not true of me at all",
            "2",
            "3",
            "4",
            "5",
            "6",
            "Very true of me")) %>% 
  t() %>% 
  as.data.frame()

ciq_label_df <- setNames(ciq_label_df[-1, ], unlist(ciq_label_df[1, ]))


#create table
ciq_label_table <- ciq_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(ciq_label_table)


```

#### Survey Items

All CIQ survey items are presented in the following table:

```{r ciq-var-prep}
# Pull question wording from qualtrics data
# ciq is from BSI question 20-22
# TODO: Check range of possible values 
ciq_word <- qualtrics %>% 
  select(starts_with("BSI")) %>% 
  slice(1)

#create table with variable name, description, and notes
ciq_word_long <- ciq_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name),
         notes = case_when(var_name == "bsi22" ~ "This item should be reverse scored. `ciq3_r` is reverse scored",
                           TRUE ~ as.character("")
                           )) %>% 
  mutate(description = if_else(var_name == "bsi20", "I have become depressed because of the Coronavirus (COVID-19).", description)) %>%
  mutate(var_name = case_when(var_name == "bsi20" ~ "ciq1",
                              var_name == "bsi21" ~ "ciq2",
                              var_name == "bsi22" ~ "ciq3",
                              TRUE ~ var_name)) %>% 
  slice(20:22)

```

```{r ciq-var-table, results ='asis'}
# Create the gt table object and apply generic theme
ciq_gt_table <- gt(ciq_word_long)

# Table-specific formatting (col width, names)
ciq_gt_table <- ciq_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
   tab_options(table.width = pct(100))%>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(ciq_gt_table)

#WHEN RENDERING WITH PDF USE: 
#ciq_gt_table
```

#### Scale and Subscales

Information on the psychological impacts subscale and associated variables are below.
The subscale was constructed by averaging the included items.

```{r ciq alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 
ciq_alpha <-
  complete %>%
  select(ciq1,ciq2,ciq3_r) %>%
  psych::alpha(check.keys = TRUE)

```

```{r ciq-scale-table, results = 'asis'}
# Create the table as a data frame
ciq_scale_df <- data.frame(
  var_name = c("ciq_psych_total"),
  scale = c("Total Score (3)"),
  scale_construction = c("`ciq1`, `ciq2`, `ciq3_r`"),
  scale_range = c("1-7"),
  alpha = c(round(ciq_alpha$total$raw_alpha, 3))
)

# Create the gt table object
ciq_scale_table <- gt(ciq_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
             scale = "Scale (# of items)", 
             scale_construction = "Scale Construction",
             scale_range = "Range*",
             alpha = "Alpha") %>% 
  tab_footnote(footnote = "*Range of possible values; `_r` Reverse scored variable") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  cols_width(var_name ~ pct(25),
             scale ~ pct(25),
             scale_construction ~ pct(25)
             ) %>% 
   tab_options(table.width = pct(100))%>%
  apply_tbl_theme() 

# Print the table
print(ciq_scale_table)

```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item and the psychological impacts subscale:

```{r ciq-mean-items}
# subset items
ciq_data_subset <- complete %>%
  select(ciq1:ciq2, ciq3, ciq_psych_total)

# Calculate the summary statistics for each variable
ciq_summary_data <- lapply(ciq_data_subset, function(x) {
  x <- replace(x, x < -40, NA)
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
ciq_summary_data <- as.data.frame(ciq_summary_data)

# Set items as first row
ciq_summary_data <- rbind(names(ciq_summary_data), ciq_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
ciq_tbl <- ciq_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
ciq_tbl

```

#### Distributions

The distribution for the total score is presented below:

```{r csi-distributions, class.source='fold', echo = FALSE}
complete %>%
  composite_hist(
    x = ciq_psych_total,
    bins = 10
    ) +
  labs(title = 'Distribution for CIQ Psychological Subscale')
```

# Substance Use Measures

## The Drug Abuse Screening Test (DAST)

### DAST Description

<MIN/SHAINA>TODO: ROW DATA INCORRECTLY CLEANED, WILL NEED RE_CLEAN!

<SHAINA> TODO: CHECK AFTER DATA IS CLEANED

The DAST is a self-report instrument used to assess problems related to
substance use.

For the present study, 22 items from the DAST were collected and a total
score was constructed. No subscales were created for this measure as
there was a lack of evidence supporting a subscale structure.

Two items (`d4` and `d5`) should to be reverse scored which is noted in
the variable table below and the reverse scored variables are provided
(`d4_r` and `d5_r`). Higher scores indicate more problems related to
substance use.

<TODO:  MIN this is done! I've updated language
Participants who were incarcerated at the time of the interview were not adminstered this survey.

<SHAINA> TODO: CONFIRM THIS IS CORRECT AND IF SHOULD BE APPLIED IN
TABLES BELOW - specify -77 The missing data rule was applied.
Calculations were completed only with participants that had less than
20% missing data (this includes `-77` responses)

This survey was not administered for participants who were incarcerated at the time of the assessment. 

Reference:
[@gavin1989diagnostic](https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1360-0443.1989.tb03463.x);[DOI](https://doi.org/10.1111/j.1360-0443.1989.tb03463.x)

### DAST Variables

#### Value Labels

All The Drug Abuse Screening Test variables have the same response
options.

```{r DAST-label-table, results = 'asis'}

dast_label_df <- data.frame(
  value = c(1,0),
  label = c("Yes",
            "No")) %>% 
  t() %>% 
  as.data.frame()

dast_label_df <- setNames(dast_label_df[-1, ], unlist(dast_label_df[1, ]))


#create table
dast_label_table <- dast_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ px(180)) %>% 
  apply_labtab_theme()

# Print the table
print(dast_label_table)


```

<MARIA> TODO: CONFIRM THIS TABLE SHOULD BE INCLUDED AND WHAT VARIABLES
THEY APPLY TO Re-coded total value label `dast_total_r`

```{r DAST-label-table-total, results = 'asis'}
dast_label_total <- data.frame(
  value = seq(0,4),
  label = c("None",
            "Low",
            "Intermediate (likely meets DSM criteria)",
            "Substantial",
            "Severe")) %>% 
  t() %>% 
  as.data.frame()

dast_label_total <- setNames(dast_label_total[-1, ], unlist(dast_label_total[1, ]))


#create table
dast_label_table_total <- dast_label_total %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(c(1:5) ~ px(151)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(dast_label_table_total)


```

#### Survey Items

All DAST survey items are presented in the following table:

*Question Stem* This questionnaire deals with certain drug use and social behavior patterns. Please answer each of the items truthfully by stating Yes or No to me, thinking about the past 6 months.

```{r DAST-var-prep}
# Pull question wording from qualtrics data
dast_word <- qualtrics %>% 
  select(starts_with("D")) %>% 
  rename(dast_screen = D00) %>%
  slice(1)

#create table with variable name, description, and notes
dast_word_long <- dast_word %>% 
  select(-D2A) %>%
  rename(d2 = D2B) %>%
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = case_when(var_name == "d2" ~ "Have you misused prescription drugs in the last 6 months?",
                                 TRUE ~ description),
         var_name = str_to_lower(var_name),
         notes = case_when(var_name == "d4" ~ "This item should be reverse scored. `d4_r` is reverse scored",
                           var_name == "d5" ~ "This item should be reverse scored. `d4_r` is reverse scored",
                           TRUE ~ as.character("")
                           )
         ) %>% 
  mutate(description = if_else(var_name == "dast_screen", "Is TC currently pregnant?", description)) %>%
  slice(4:25)

```

```{r dast-var-table, results ='asis'}
# Create the gt table object and apply generic theme
dast_gt_table <- gt(dast_word_long)

# Table-specific formatting (col width, names)
dast_gt_table <- dast_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
  tab_options(table.width = pct(100))%>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())
 

# Print the table
print(dast_gt_table)

#WHEN RENDERING WITH PDF USE: 
#dast_gt_table
```

#### Scale and Subscales

Information on the total score is below. The total score was constructed
by summing all items.

```{r dast alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#turn eval to TRUE MARIA TO DO
#Calculate internal reliability 
# dast_alpha <-
#   complete %>%
#   select(d1a:d3, d6:d5_r) %>%
#   mutate(d2 = coalesce(d2a, d2b)) %>% 
#   select(-d2a, -d2b) %>% 
#   drop_na(d2) %>% 
#   psych::alpha(check.keys = TRUE)

```

<MIN> DATA CLEANING TODO: need check the total

```{r DAST-scale-table, results = 'asis'}
# Create the table as a data frame
# dast_scale_df <- data.frame(
#   var_name = c("dast_total"),
#   scale = c("Total Score (20)"),
#   scale_construction = c(" `d1a`, `d2`, `d3`, `d4_r`, `d5_r`, `d6`, `d7`, `d8`, `d9`, `d10`, `d11`, `d12`, `d13`, `d14`, `d15`, `d16`, `d17`, `d18`, `d19`, `d20`"),
#   scale_range = c("0-20"),
#   alpha = c(round(dast_alpha$total$raw_alpha, 3))
# )
# 
# # Create the gt table object
# dast_scale_table <- gt(dast_scale_df) %>%
#   cols_align(columns = c("scale_range"), align = "center") %>% 
#   cols_label(var_name = "Variable Name",
#              scale = "Scale (# of items)", 
#              scale_construction = "Scale Construction",
#              scale_range = "Range*",
#              alpha = "Alpha") %>% 
#   tab_footnote(footnote = "*Range of possible values; `_r` Reverse scored variable") %>% 
#   tab_options(table.border.bottom.style = "hidden") %>% 
#   cols_width(scale ~ px(150),
#              scale_construction ~ pct(50)) %>% 
#   tab_options(table.width = pct(100))%>%
#   apply_tbl_theme() 
# 
# # Print the table
# print(dast_scale_table)

```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item and the total
score.

For binary items:

```{r dast-binary-desc}
# Create subset of DAST items
dast_data_subset_binary <- complete %>%
  select(dast1:dast20)

# Calculate the dichotomous summary statistics for each variable
dast_summary_data_binary <- lapply(dast_data_subset_binary, function(x) {
  x <- replace(x, x < -40, NA)
  per_no <- paste0(round(sum(x == 0, na.rm = TRUE) / length(x) *100, 1), "%")
  per_yes <- paste0(round(sum(x == 1, na.rm = TRUE) / length(x) *100, 1), "%")
  num_no <- sum(x == 0, na.rm = TRUE)
  num_yes <-sum(x == 1, na.rm = TRUE)
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(per_no = per_no, per_yes = per_yes, num_no = num_no, num_yes = num_yes, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
dast_summary_data_binary <- as.data.frame(dast_summary_data_binary)

# Set items as first row
dast_summary_data_binary <- rbind(names(dast_summary_data_binary), dast_summary_data_binary) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
dast_tbl_binary <- dast_summary_data_binary %>%
  gt() %>%
  cols_label(`1` = "Variable",
             num_no = "N",
             per_no = "%",
             num_yes = "N",
             per_yes = "%",
             Missing = "% Missing") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("per_no", "per_yes", "num_no", "num_yes", "Missing"), align = "center") %>% 
  tab_spanner(label = "No", columns = c(num_no, per_no)) %>% 
  tab_spanner(label = "Yes", columns = c(num_yes, per_yes)) %>% 
  tab_style(style = list(cell_fill(color = "#9BB6D1")),
            locations = cells_column_spanners()) %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = colorspace::lighten("#9BB6D1", .4))),
            locations = cells_column_labels(columns = c(num_yes, num_no, per_yes, per_no))) 

# Render the table
dast_tbl_binary


```

For the total score:

```{r dast-cont-desc}
# Create subset of DAST items
dast_data_subset <- complete %>%
  select(dast_total)

# Calculate the dichotomous summary statistics for each variable
dast_summary_data <- lapply(dast_data_subset, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
dast_summary_data <- as.data.frame(dast_summary_data) 

# Set items as first row
dast_summary_data <- rbind(names(dast_summary_data),dast_summary_data) %>% 
  t() %>% 
  as.data.frame() %>%
  mutate(Mean = if_else(Mean == "NaN", "NA", Mean)) %>%
  mutate(Range = if_else(Range == "Inf--Inf", "NA", Range))

 



# Create the gt table
dast_tbl <- dast_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ px(115)) %>%
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
dast_tbl

```

#### Distributions

The distribution for the total score is presented below:

<#TODO: Maria, should I use reversed total score for this distributions?>
```{r}
complete %>%
  filter(dast_total >= 0) %>%  # Filter out missing data
  composite_hist(dast_total) +
  labs(
    title = 'DAST Total Score Distribution'
    )
```


## Conflict Tactics Scales (CTS)

### CTS Description

The CTS is a self-report measure used to assess tactics used when there
is conflict in a relationship.

For the present study, all 20 items from the CTS short form were
collected, and all scales (Negotiation, Physical Assault, and
Psychological Aggression) and supplemental scales (Assault and Sexual
Coercion) were calculated.

Authors describe that internal reliability is not appropriate for the
CTS measure. CTS should not have a calculated total/average composite
score. Instead, CTS has three different ways of scoring (Prevalence,
Severity, Mutuality).

No items need to be reverse scored. <MARIA> TODO: How to word
directionality with current values/labels. (e.g., Higher scores indicate

This survey was not administered for participants who were incarcerated at the time of the assessment.
...

<SHAINA> TODO: CONFIRM & CHECK CALC CODE The missing data rule was
applied. Calculations were completed only with participants that had
less than 20% missing data (this includes `-77` responses)

Reference:
[@straus2004short](https://connect.springerpub.com/content/sgrvv/19/5/507.abstract);
[DOI](10.1891/vivi.19.5.507.63686)

### CTS Variables

#### Value Labels

All CTS variables have the same response options.

```{r CTS-label-table, results = 'asis'}

CTS_label_df <- data.frame(
  value = c( "1", "2", "3", "4", "5", "6", "7", "8"),
  label = c("This has never happened",
            "Once in the past year",
            "Twice in the past year",
            "3-5 times in the past year",
            "6-10 times in the past year",
            "11-20 times in the past year",
            "More than 20 times in the past year", 
            "Not in the past year, but it did happen before"
            )
) %>% 
  t() %>% 
  as.data.frame()

CTS_label_df <- setNames(CTS_label_df[-1, ], unlist(CTS_label_df[1, ]))


#create table
CTS_label_table <- CTS_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ px(100)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(CTS_label_table)


```

#### Survey Items

All CTS survey items are presented in the following table:
This survey was not adminstered for participants who were incarcerated at the time of the assessment. 

```{r CTS-var-prep}
# Pull question wording from Qualtrics data
CTS_word <- qualtrics %>% 
  select(starts_with("CT"), -CT0, -CT000) %>% 
  slice(1)

#create table with variable name, description, and notes
CTS_word_long <- CTS_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         
         var_name = str_to_lower(var_name), 
         notes = as.character("")) %>% 
  mutate(notes = if_else(var_name == "cts screen", "If TC answered No for this question the rest of survey will be skipped", notes),
    description = if_else(var_name == "ct0", "Have you lived with any other children, under the age of 17, since the time of your last interview? Only think about children who you or your partner was responsible for parenting. Please do not include any children listed in the other sections or children that you have reported before.", 
                               if_else(var_name == "ct000", "How many new children are you parenting since your last interview on (last interview date)?",
                                       if_else(var_name ==  "cts screen", "Have you been in a (romantic) relationship in the past year?",
                                               if_else(var_name == "cts parent screen", "Have you parented a child (under 18) in the past year?", description))))
  ) %>%
  slice(1:26)

```

This survey was not adminstered for participants who were incarcerated at the time of the assessment. 

Please indicate how many times you did each of these things in the past year, and how many times you partner did them in the past year. 

```{r CTS-var-table, results ='asis'}
# Create the gt table object and apply generic theme
my_gt_table <- gt(CTS_word_long)

# Table-specific formatting (col width, names)
my_gt_table <- my_gt_table %>% 
  cols_label(var_name = "Variable", 
            description = "Description",
            notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
  tab_options(table.width = pct(100))%>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(my_gt_table)

#WHEN RENDERING WITH PDF USE: 
#my_gt_table
```

#### Scale and Subscales

Information on total score and subscale variables are below. Prevalence
scales are calculated ... <MARIA> INSERT INFO ON COMPOSITE SCORE
CREATION. Severity scores are calculated ... <MARIA> INSERT INFO ON
COMPOSITE SCORE CREATION. Mutuatlity scores are created by ... <MARIA>
INSERT INFO ON COMPOSITE SCORE CREATION

<SHAINA/MIN> TODO: NEED fill Range once we understand how composite
scores were created

```{r CTS-scale-table, results = 'asis'}
# Create the table as a data frame
CTS_scale_df <- data.frame(
  var_name = c("cts_psy_agg_ind_sev", "cts_injury_ind_sev", "cts_assault_ind_sev",   "cts_sex_ind_sev",       #TC   severity 
                "cts_psy_agg_part_sev","cts_injury_part_sev", "cts_assault_part_sev","cts_sex_part_sev",      #Partner severity 

                "cts_psy_agg_ind_prev", "cts_injury_ind_prev", "cts_assault_ind_prev", "cts_sex_ind_prev", 
                "cts_psy_agg_part_prev", "cts_injury_part_prev", "cts_assault_part_prev", "cts_sex_part_prev",
               
                "cts_psy_agg_mutual", "cts_injury_mutual", "cts_assault_mutual", "cts_sex_mutual",
               
                "cts_negotiate_ind",    "cts_negotiate_part"),

  scale = c("TC Psychological Aggression (2)", "TC Physical Injury (2)", "TC Assault (2)", "TC Sexual Cohesion (2)",
            "Partner Psychological Aggression (2)", "Partner Physical Injury (2)", "Partner Assault (2)", "Partner Sexual Cohesion (2)",

            "TC Psychological Aggression (2)", "TC Physical Injury (2)", "TC Assault (2)", "TC Sexual Cohesion (2)",
            "Partner Psychological Aggression (2)", "Partner Physical Injury (2)", "Partner Assault (2)", "Partner Sexual Cohesion (2)",
            
            "Psychological Aggression (4)", "Physical Injury (4)", "Assaul (4)t", "Sexual Cohesion (4)",
            
            "TC Negotiation (2)", "Partner Negotiation (2)"
            ),
  score_method = c("Severity", "Severity", "Severity", "Severity",
                   "Severity", "Severity", "Severity", "Severity",
                   "Prevalence", "Prevalence", "Prevalence", "Prevalence", 
                   "Prevalence", "Prevalence", "Prevalence", "Prevalence", 
                   "Mutuality", "Mutuality", "Mutuality", "Mutuality",
                   "", ""
                   ),

  scale_construction = c("`cts3`, `cts13`", "`cts5`, `cts15`", "`cts9`, `cts11`", "`cts17`, `cts19`", 
                         "`cts4`, `cts14`", "`cts6`, `cts16`", "`cts10`, `cts12`", "`cts18`, `cts20`", 
                         
                         "`cts3`, `cts13`", "`cts5`, `cts15`", "`cts9`, `cts11`", "`cts17`, `cts19`", 
                         "`cts4`, `cts14`", "`cts6`, `cts16`", "`cts10`, `cts12`", "`cts18`, `cts20`",
                         
                         "`cts3`, `cts13`, `cts4`, `cts14`","`cts5`, `cts15`, `cts6`, `cts16`",
                         "`cts9`, `cts11`, `cts10`, `cts12`", "`cts17`, `cts19`, `cts18`, `cts20`",
                         
                         "`cts1`, `cts7`", "`cts2`, `cts8`"
                         
                         ),
  scale_range = c("", "", "", "", "", "", "", "", "", "",
                  "", "", "", "", "", "", "", "", "", "", 
                  "", "")
  )


# Create the gt table object
CTS_scale_table <- gt(CTS_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Scale (# of items)", 
            score_method = "Score Method",
            scale_construction = "Scale Construction",
            scale_range = "Range*") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  #cols_width(scale ~ px(200)) %>% 
  apply_tbl_theme() 

# Print the table
print(CTS_scale_table)

```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item and subscale
score:

```{r CTS-mean-items}
# Create subset of CTS items
cts_data_subset <- complete %>%
  select(cts1:cts20, starts_with("cts"))

# Calculate the summary statistics for each variable
cts_summary_data <- lapply(cts_data_subset, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert cts2_summary_data to a data frame
cts_summary_data <- as.data.frame(cts_summary_data)

# Set items as first row
cts_summary_data <- rbind(names(cts_summary_data), cts_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
cts_tbl <- cts_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(`1` ~ pct(27)) %>%
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
    fmt_missing(
        columns = c("Mean","SD","Range", "Missing")
        # missing_text = "missing"
  )%>%
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

   
# Render the table
cts_tbl

```

#### Distributions

Distributions are presented below for each subscale
<Maria> I'd like your input on how to abbriviate the x axix and title.
< Min> I only want abbreviations for the continuous scores, not categorial

##### Severity distributions

```{r CTS-Severity-TC-distributions, class.source='fold', echo = FALSE}
# Psychological Aggression 
p_cts_psy_agg_ind_sev <- complete %>%
  mutate(
    cts_psy_agg_ind_sev = case_when(
      cts_psy_agg_ind_sev == 0 ~ 'No Psychological Aggression',  #TODO: <Maria> Can I short this to No Psy. Aggre. etc... 
      cts_psy_agg_ind_sev == 1 ~ 'Minor Psychological Aggression',
      cts_psy_agg_ind_sev == 2 ~ 'Severe Psychological Aggression'
    ),
    cts_psy_agg_ind_sev = as.factor(cts_psy_agg_ind_sev),
    cts_psy_agg_ind_sev = relevel(cts_psy_agg_ind_sev, 'No Psychological Aggression')
  ) %>%
  ggplot(
    aes(
      cts_psy_agg_ind_sev
    )
  ) +
  bar_style +
  scale_x_discrete(labels = label_wrap(10),guide = guide_axis(n.dodge=3)) +
  labs(title = 'Individual (TC) Psychological Aggression Severity',
       y = "Number of Participants") + 
  THEME


# Psychical Injury 
p_cts_injury_ind_sev <- complete %>%
  mutate(
    cts_injury_ind_sev = case_when(
      cts_injury_ind_sev == 0 ~ 'No Injury',
      cts_injury_ind_sev == 1 ~ 'Minor Injury',
      cts_injury_ind_sev == 2 ~ 'Severe Injury'
    ),
    cts_injury_ind_sev = as.factor(cts_injury_ind_sev),
    cts_injury_ind_sev = relevel(cts_injury_ind_sev, 'No Injury')
  ) %>%
  ggplot(
    aes(
      cts_injury_ind_sev
    )
  ) +
  bar_style +
  scale_x_discrete(labels = label_wrap(10)) +
  labs(title = 'Individual (TC) Physical Injury Severity',
       y = "Number of Participants") + 
  THEME

# Assault 
p_cts_assault_ind_sev <- complete %>%
  mutate(
    cts_assault_ind_sev = case_when(
      cts_assault_ind_sev == 0 ~ 'No Assault',
      cts_assault_ind_sev == 1 ~ 'Minor Assault',
      cts_assault_ind_sev == 2 ~ 'Severe Assault'
    ),
    cts_assault_ind_sev = as.factor(cts_assault_ind_sev),
    cts_assault_ind_sev = relevel(cts_assault_ind_sev, 'No Assault')
  ) %>%
  ggplot(
    aes(
      cts_assault_ind_sev
    )
  ) +
  bar_style +
  scale_x_discrete(labels = label_wrap(10)) +
  labs(title = 'Individual (TC) Assault Severity',
       y = 'Number of Participants') +
  THEME

# Sexual Cohesion
p_cts_sex_ind_sev <- complete %>%
  mutate(
    cts_sex_ind_sev = case_when(
      cts_sex_ind_sev == 0 ~ 'No Sexual Cohesion',
      cts_sex_ind_sev == 1 ~ 'Minor Sexual Cohesion',
      cts_sex_ind_sev == 2 ~ 'Severe Sexual Cohesion'
    ),
    cts_sex_ind_sev = as.factor(cts_sex_ind_sev),
    cts_sex_ind_sev = relevel(cts_sex_ind_sev, 'No Sexual Cohesion')
  ) %>%
  ggplot(
    aes(
      cts_sex_ind_sev
    )
  ) +
  bar_style +
  scale_x_discrete(labels = label_wrap(10)) +
  labs(title = 'Individual (TC) Sexual Cohesion Severity',
       y = "Number of Participants") + 
  THEME

#TODO: <Min FIX the x axis overlap>
ggarrange(p_cts_psy_agg_ind_sev, p_cts_injury_ind_sev + rremove("ylab"), 
          p_cts_assault_ind_sev, p_cts_sex_ind_sev + rremove("ylab")) %>%
  annotate_figure(top = text_grob( "Distribution for CTS Individual (TC) Serverity \n(x-axis and y-axis are in different scales)"))
```



```{r CTS-Severity-Partner-distributions, class.source='fold', echo = FALSE}
# Psychological Aggression 
p_cts_psy_agg_part_sev <- complete %>%
  mutate(
    cts_psy_agg_part_sev = case_when(
      cts_psy_agg_part_sev == 0 ~ 'No Psychological Aggression',
      cts_psy_agg_part_sev == 1 ~ 'Minor Psychological Aggression',
      cts_psy_agg_part_sev == 2 ~ 'Severe Psychological Aggression'
    ),
    cts_psy_agg_part_sev = as.factor(cts_psy_agg_part_sev),
    cts_psy_agg_part_sev = relevel(cts_psy_agg_part_sev, 'No Psychological Aggression')
    ) %>%
  ggplot(
    aes(
      cts_psy_agg_part_sev
    )
  ) +
  bar_style +
   scale_x_discrete(labels = label_wrap(10)) +
  labs(title = 'Partner Psychological Aggression Severity',
       y = "Number of Participants") + 
  THEME +
  theme(axis.text.x = element_text(angle = -45))

# Physical Injury
p_cts_injury_part_sev <- complete %>%
  mutate(
    cts_injury_part_sev = case_when(
      cts_injury_part_sev == 0 ~ 'No Injury',
      cts_injury_part_sev == 1 ~ 'Minor Injury',
      cts_injury_part_sev == 2 ~ 'Severe Injury'
    ),
    cts_injury_part_sev = as.factor(cts_injury_part_sev),
    cts_injury_part_sev = relevel(cts_injury_part_sev, 'No Injury')
  ) %>%
  ggplot(
    aes(
      cts_injury_part_sev
    )
  ) +
  bar_style +
  scale_x_discrete(labels = label_wrap(10)) +
  labs(title = 'Partner Physical Injury Severity',
       y = "Number of Participants") + 
  THEME


# Assault
p_cts_assault_part_sev <- complete %>%
  mutate(
    cts_assault_part_sev = case_when(
      cts_assault_part_sev == 0 ~ 'No Assault',
      cts_assault_part_sev == 1 ~ 'Minor Assault',
      cts_assault_part_sev == 2 ~ 'Severe Assault'
    ),
    cts_assault_part_sev = as.factor(cts_assault_part_sev),
    cts_assault_part_sev = relevel(cts_assault_part_sev, 'No Assault')
  ) %>%
  ggplot(
    aes(
      cts_assault_part_sev
    )
  ) +
  bar_style +
    scale_x_discrete(labels = label_wrap(10)) +
  labs(title = 'Partner Assault Severity',
       y = "Number of Participants") + 
  THEME

# Sexual Cohesion
p_cts_sex_part_sev <- complete %>%
  mutate(
    cts_sex_part_sev = case_when(
      cts_sex_part_sev == 0 ~ 'No Sexual Cohesion',
      cts_sex_part_sev == 1 ~ 'Minor Sexual Cohesion',
      cts_sex_part_sev == 2 ~ 'Severe Sexual Cohesion'
    ),
    cts_sex_part_sev = as.factor(cts_sex_part_sev),
    cts_sex_part_sev = relevel(cts_sex_part_sev, 'No Sexual Cohesion')
  ) %>%
  ggplot(
    aes(
      cts_sex_part_sev
    )
  ) +
  bar_style +
  scale_x_discrete(labels = label_wrap(10)) +
  labs(title = 'Partner Sexual Cohesion Severity',
       y = "Number of Participants") + 
  THEME

# TODO: Min fix x axis overlap 
ggarrange(p_cts_psy_agg_part_sev, p_cts_injury_part_sev + rremove("ylab"), 
          p_cts_assault_part_sev, p_cts_sex_part_sev + rremove("ylab")) %>%
  annotate_figure(top = text_grob( "Distribution for CTS Partner Serverity \n(x-axis and y-axis are in different scales)"))
```

##### Prevalence distributions

<MIN> TODO NA was removed when generating following Prevalence plot
MZ note: I think NA was removed when colculate the prevalence score. 

```{r CTS-Prevalence-distributions, class.source='fold', echo = FALSE}
# Psychological Aggression 
p_cts_psy_agg_pre <- complete %>%
  pivot_longer(
    cols = c(cts_psy_agg_ind_prev, cts_psy_agg_part_prev),
    names_to = 'ind_part',
    values_to = 'prevalence'
  ) %>%
  mutate(
    ind_part = case_when(
      ind_part == 'cts_psy_agg_ind_prev' ~ 'Individual (TC)',
      ind_part == 'cts_psy_agg_part_prev' ~ 'Partner'
    )
  ) %>%
  group_by(ind_part) %>%
  mutate(
    sum_prev = sum(prevalence, na.rm = T)
  ) %>%
  ungroup() %>%
  ggplot(
    aes(
      ind_part, sum_prev
    )
  ) +
  geom_col(
    aes(fill = ind_part),
    position = 'dodge'
  ) +
  labs(title = 'Psychological Aggression Prevalence') +
  scale_fill_manual(values = Two_color) +
  THEME

# Physical Injury
p_cts_inj_pre <- complete %>%
  pivot_longer(
    cols = c(cts_injury_ind_prev, cts_injury_part_prev),
    names_to = 'ind_part',
    values_to = 'prevalence'
  ) %>%
  mutate(
    ind_part = case_when(
      ind_part == 'cts_injury_ind_prev' ~ 'Individual (TC)',
      ind_part == 'cts_injury_part_prev' ~ 'Partner'
    )
  ) %>%
  group_by(ind_part) %>%
  mutate(
    sum_prev = sum(prevalence, na.rm = T)
  ) %>%
  ungroup() %>%
  ggplot(
    aes(
      ind_part, sum_prev
    )
  ) +
  geom_col(
    aes(fill = ind_part),
    position = 'dodge'
  ) +
  labs(title = 'Physical Injury Prevalence') +
  scale_fill_manual(values = Two_color) +
  THEME

# Assault
p_cts_ass_pre <- complete %>%
  pivot_longer(
    cols = c(cts_assault_ind_prev, cts_assault_part_prev),
    names_to = 'ind_part',
    values_to = 'prevalence'
  ) %>%
  mutate(
    ind_part = case_when(
      ind_part == 'cts_assault_ind_prev' ~ 'Individual (TC)',
      ind_part == 'cts_assault_part_prev' ~ 'Partner'
    )
  ) %>%
  group_by(ind_part) %>%
  mutate(
    sum_prev = sum(prevalence, na.rm = T)
  ) %>%
  ungroup() %>%
  ggplot(
    aes(
      ind_part, sum_prev
    )
  ) +
  geom_col(
    aes(fill = ind_part),
    position = 'dodge'
  ) +
  labs(title = 'Assault Prevalence') +
  scale_fill_manual(values = Two_color) +
  THEME

# Sexual Cohesion
p_cts_sex_pre <- complete %>%
  pivot_longer(
    cols = c(cts_sex_ind_prev, cts_sex_part_prev),
    names_to = 'ind_part',
    values_to = 'prevalence'
  ) %>%
  mutate(
    ind_part = case_when(
      ind_part == 'cts_sex_ind_prev' ~ 'Individual (TC)',
      ind_part == 'cts_sex_part_prev' ~ 'Partner'
    )
  ) %>%
  group_by(ind_part) %>%
  mutate(
    sum_prev = sum(prevalence, na.rm = T)
  ) %>%
  ungroup() %>%
  ggplot(
    aes(
      ind_part, sum_prev
    )
  ) +
  geom_col(
    aes(fill = ind_part),
    position = 'dodge'
  ) +
  labs(title = 'Sexual Cohesion Prevalence') +
  scale_fill_manual(values = Two_color) +
  THEME

ggarrange(p_cts_psy_agg_pre + rremove("legend"), p_cts_inj_pre + rremove("ylab"), 
          p_cts_ass_pre + rremove("legend"), p_cts_sex_pre + rremove("ylab")) %>%
  annotate_figure(top = text_grob( "Distribution for CTS Prevalence \n(x-axis and y-axis are in different scales)"))
```



##### Mutuality distributions

```{r CTS-Mutuality-distributions, class.source='fold', echo = FALSE}

# Psychological Aggression 
p_cts_psy_mut <- complete %>%
  mutate(
    cts_psy_agg_mutual = case_when(
      cts_psy_agg_mutual == 0 ~ 'Neither',
      cts_psy_agg_mutual == 1 ~ 'Male',
      cts_psy_agg_mutual == 2 ~ 'Female',
      cts_psy_agg_mutual == 3 ~ 'Both'
    ),
    cts_psy_agg_mutual = as.factor(cts_psy_agg_mutual),
    cts_psy_agg_mutual = relevel(cts_psy_agg_mutual, 'Male')
  ) %>%
  ggplot(
    aes(
      cts_psy_agg_mutual
    )
  ) +
  bar_style +
  labs(title = 'Mutual Psychological Aggression',
       y = "Number of Participants") +
  THEME



# Physical Injury
p_cts_ing_mut <- 
  complete %>%
  mutate(
    cts_injury_mutual = case_when(
      cts_injury_mutual == 0 ~ 'Neither',
      cts_injury_mutual == 1 ~ 'Male',
      cts_injury_mutual == 2 ~ 'Female',
      cts_injury_mutual == 3 ~ 'Both'
    ),
    cts_injury_mutual = as.factor(cts_injury_mutual),
    cts_injury_mutual = relevel(cts_injury_mutual, 'Female')
  ) %>%
  ggplot(
    aes(
      cts_injury_mutual
    )
  ) +
  bar_style +
  labs(title = 'Mutual Physical Injury',
       y = "Number of Participants") +
  THEME


# Assault
p_cts_ass_mut <- complete %>%
  mutate(
    cts_assault_mutual = case_when(
      cts_assault_mutual == 0 ~ 'Neither',
      cts_assault_mutual == 1 ~ 'Male',
      cts_assault_mutual == 2 ~ 'Female',
      cts_assault_mutual == 3 ~ 'Both'
    ),
    cts_assault_mutual = as.factor(cts_assault_mutual),
    cts_assault_mutual = relevel(cts_assault_mutual, 'Male')
  ) %>%
  ggplot(
    aes(
      cts_assault_mutual
    )
  ) +
  bar_style +
  labs(title = 'Mutual Assault',
       y = "Number of Participants") +
  THEME

# Sexual Cohesion
p_cts_sex_mut <- complete %>%
  mutate(
    cts_sex_mutual = case_when(
      cts_sex_mutual == 0 ~ 'Neither',
      cts_sex_mutual == 1 ~ 'Male',
      cts_sex_mutual == 2 ~ 'Female',
      cts_sex_mutual == 3 ~ 'Both'
    ),
    cts_sex_mutual = as.factor(cts_sex_mutual),
    cts_sex_mutual = relevel(cts_sex_mutual, 'Male')
  ) %>%
  ggplot(
    aes(
      cts_sex_mutual
    )
  ) +
  bar_style +
  labs(title = 'Mutual Sexual Cohesion',
       y = "Number of Participants") +
  THEME

ggarrange(p_cts_psy_mut, p_cts_ing_mut + rremove("ylab"), 
          p_cts_ass_mut, p_cts_sex_mut + rremove("ylab")) %>%
  annotate_figure(top = text_grob( "Distribution for CTS Mutual Subscale \n(x-axis and y-axis are in different scales)"))
```


##### Negotiation distributions

```{r CTS-Negotiation-distributions, class.source='fold', echo = FALSE}
p_cts_neg <- complete %>% 
  composite_hist(
    cts_negotiate_ind,
    bins = 10
  ) +
  labs(title = 'Individual (TC) Negotiation Subscale',
       #subtitle = 'Individual (TC)'
       )

p_cts_part <- complete %>% 
  composite_hist(
    cts_negotiate_part,
    bins = 10
  ) +
  labs(title = 'Partner Negotiation Subscale',
      # subtitle = 'Partner'
       )

ggarrange(p_cts_neg, p_cts_part + rremove("ylab")
          ) %>%
  annotate_figure(top = text_grob( "Distribution for CTS Negotiation Subscale \n(x-axis and y-axis are in different scales)"))
```




## Brief Child Abuse Potential Inventory (BCAP)

### BCAP Description

The BCAP is a self-report inventory used to assess parental child abuse
risk.

For the present study, <SHAINA> CONFIRM 34 items from the BCAP were
collected and <SHAINA/MARIA> CONFIRM all 9 subscales were computed:
Happiness, Feelings of Persecution, Loneliness, Family Conflict,
Rigidity, Distress, Financial Insecurity, Lie, and Random Responding.

Four items (`bcap1`, `bcap2`, `bcap23`, and `bcap29`) should be reverse scored which
is noted in the variable table below and the reverse scored variables
are provided (`bcap1_r`, `bcap2_r`, `bcap23_r`, and `bcap29_r`). Higher scores on
the BCAP indicates increased risk.

<SHAINA> CONFIRM\> The missing data rule was applied. Calculations were
completed only with participants that had less than 20% missing data
(this includes `-77` responses).

Reference:
[@ondersma2005brief](https://www.tandfonline.com/doi/abs/10.1207/s15374424jccp3402_9?casa_token=ZIJ3j8CLmK0AAAAA:_ztEWiTg5FO0Y3Jb_fL-zTuyqSmH623f0Q91STiqNR3jYvQyPzUiTqLSW3E5_U4iAucWcpqvbHAUug);
[DOI](https://doi.org/10.1207/s15374424jccp3402_9)

### BCAP Variables

#### Value Labels

All BCAP variables have the same response options.

```{r BCAP-label-table, results = 'asis'}

bcap_label_df <- data.frame(
  value = c("0", "1"),
  label = c("Disagree",
            "Agree")
) %>% 
  t() %>% 
  as.data.frame()

bcap_label_df <- setNames(bcap_label_df[-1, ], unlist(bcap_label_df[1, ]))


#create table
bcap_label_table <- bcap_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ px(180)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(bcap_label_table)


```

#### Survey Items

All BCAP survey items are presented in the following table:

```{r bcap-var-prep}
# Pull question wording from qualtrics data
bcap_word <- qualtrics %>% 
  select(starts_with("q")) %>% 
  slice(1)

#create table with variable name, description, and notes
# how can we change this is bcap is the new variable?
bcap_word_long <- bcap_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name), 
         notes = case_when(var_name == "q1" ~ "This item should be reverse scored. `bcap1_r` is reverse scored",
                           var_name == "q2" ~ "This item should be reverse scored. `bcap2_r` is reverse scored",
                           var_name == "q23" ~ "This item should be reverse scored. `bcap23_r` is reverse scored",
                           var_name == "q29" ~ "This item should be reverse scored. `bcap29_r` is reverse scored",
                           
                           var_name %in% c("c22", "c23") ~ "Skipped if `c21` = No",
                           TRUE ~ as.character(""))) %>%
  slice(1:34)


```

```{r bcap-var-table, results ='asis'}
# Create the gt table object and apply generic theme
bcap_gt_table <- gt(bcap_word_long)

# Table-specific formatting (col width, names)
bcap_gt_table <- bcap_gt_table %>% 
  cols_label(var_name = "Variable", 
            description = "Description",
            notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(250),
             var_name ~ px(100)) %>%
  tab_options(table.width = pct(100))%>%
  #tab_options(table.width = pct(100))%>%
  #cols_width(var_name ~ px(100)) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(bcap_gt_table)

#WHEN RENDERING WITH PDF USE: 
#bcap_gt_table
```

#### Scale and Subscales

Information on the total score and subscale variables are below.
<SHAINA/MARIA> INSERT Variables were constructed by ...

```{r bcap alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 
# Total
bcap_alpha <- 
  complete %>% 
  select(
    bcap1_r,
    bcap2_r,
    bcap3:bcap22,
    bcap23_r,
    bcap24:bcap28,
    bcap29_r,
    bcap30:bcap34
  ) %>% 
  psych::alpha(check.keys = TRUE)

bcap_risk_alpha <-
  complete %>%
  select(
    bcap1_r,
    bcap3,
    bcap5:bcap8,
    bcap10:bcap14,
    bcap16:bcap17,
    bcap19:bcap20,
    bcap22,
    bcap23_r,
    bcap24:bcap25,
    bcap27,
    bcap29_r,
    bcap30:bcap33
    ) %>%
  psych::alpha(check.keys = TRUE)

bcap_happy_alpha <- 
  complete %>% 
  select(bcap1_r, bcap23_r, bcap29_r) %>% 
  psych::alpha(check.keys = TRUE)

bcap_feel_pers_alpha <- 
  complete %>% 
  select(bcap3, bcap25, bcap33) %>% 
  psych::alpha(check.keys = TRUE)

bcap_lonely_alpha <- 
  complete %>% 
  select(bcap5, bcap12, bcap22, bcap31) %>% 
  psych::alpha(check.keys = TRUE)

bcap_fam_conf_alpha <- 
  complete %>% 
  select(bcap6, bcap13, bcap17) %>% 
  psych::alpha(check.keys = TRUE)

bcap_rigid_alpha <-
  complete %>% 
  select(bcap7, bcap14, bcap20, bcap32) %>% 
  psych::alpha(check.keys = TRUE)

bcap_distress_alpha <- 
  complete %>% 
  select(bcap8, bcap11, bcap16, bcap19, bcap27) %>% 
  psych::alpha(check.keys = TRUE)

bcap_poverty_alpha <- 
  complete %>% 
  select(bcap10, bcap30) %>% 
  psych::alpha(check.keys = TRUE)

bcap_lie_alpha <-
  complete %>% 
  select(bcap4, bcap9, bcap15, bcap21, bcap26, bcap34) %>% 
  psych::alpha(check.keys = TRUE)

bcap_random_alpha <-
  complete %>% 
  select(bcap2_r, bcap19, bcap28) %>% 
  psych::alpha(check.keys = TRUE)
```

```{r bcap-scale-table, results = 'asis'}
# Create the table as a data frame
bcap_scale_df <- data.frame(
  var_name = c("bcap_total", "bcap_risk", "bcap_happy", "bcap_feel_pers", "bcap_lonely", "bcap_fam_conf", "bcap_rigid","bcap_distress", "bcap_poverty", "bcap_lie", "bcap_random"),
  scale = c("BCAP complete Scale (34)", "BCAP Risk Scale (26)", "Happiness (3)", "Feelings of persecution", "Loneliness (4)", "Family conflict (3)", "Rigidity (4)", "Distress (5)", "Financial Insecurity (2)", "Lie (6)", "Random responding (3)"),
  scale_construction = c("`bcap1_r`,`bcap2_r`, `bcap3`, `bcap4`, `bcap5`, `bcap6`, `bcap7`, `bcap8`, `bcap9`, `bcap10`, `bcap11`, `bcap12`, `bcap13`, `bcap14`, `bcap15`, `bcap16`, `bcap17`, `bcap18`, `bcap19`, `bcap20`, `bcap21`, `bcap22`, `bcap23_r`, `bcap24`, `bcap25`, `bcap26`, `bcap27`, `bcap28`, `bcap29_r`, `bcap30`, `bcap31`, `bcap32`, `bcap33`, `bcap34`", 
                         "`bcap1_r`, `bcap3`, `bcap4`, `bcap5`, `bcap6`, `bcap7`, `bcap8`, `bcap10`, `bcap11`, `bcap12`, `bcap13`, `bcap14`, `bcap16`, `bcap17`, `bcap19`, `bcap20`, `bcap22`, `bcap23_r`, `bcap24`, `bcap25`, `bcap27`, `bcap29_r`, `bcap30`, `bcap31`, `bcap32`, `bcap33`", 
                         "`bcap1_r`, `bcap23_r`, `bcap29_r`", 
                         "`bcap3`, `bcap25`, `bcap33`", 
                         "`bcap5`, `bcap12`, `bcap22`, `bcap31`", 
                         "`bcap6`, `bcap13`, `bcap17`", 
                         "`bcap7`, `bcap14`, `bcap20`, `bcap32`", 
                         "`bcap8`, `bcap11`, `bcap16`, `bcap19`, `bcap27`", 
                         "`bcap10`, `bcap30`", 
                         "`bcap4`, `bcap9`, `bcap15`, `bcap21`, `bcap26`, `bcap34`,", 
                         "`bcap2`, `bcap18`, `bcap28`"),
  scale_range = c("0-24","","","","","","","","","", ""), #TODO fill in range 
   alpha = c(round(bcap_alpha$total$raw_alpha, 3),
              round(bcap_risk_alpha$total$raw_alpha, 3),
              round(bcap_happy_alpha$total$raw_alpha, 3),
              round(bcap_feel_pers_alpha$total$raw_alpha, 3),
              round(bcap_lonely_alpha$total$raw_alpha, 3),
              round(bcap_fam_conf_alpha$total$raw_alpha, 3), 
              round(bcap_rigid_alpha$total$raw_alpha, 3), 
              round(bcap_distress_alpha$total$raw_alpha, 3),
              round(bcap_poverty_alpha$total$raw_alpha, 3), 
              round(bcap_lie_alpha$total$raw_alpha, 3),
              round(bcap_random_alpha$total$raw_alpha, 3))
)

# Create the gt table object
bcap_scale_table <- gt(bcap_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Scale (# of items)", 
            scale_construction = "Scale Construction",
            scale_range = "Range*",
            alpha = "Alpha") %>% 
  tab_footnote(footnote = "*Range of possible values; `_r` Reverse scored variable") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  #cols_width(scale_construction ~ px(135)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_tbl_theme() 

# Print the table
print(bcap_scale_table)

```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item, total, and
subscale score.

For binary items:

```{r bcap-binary-desc}

# Create subset of BCAP items
bcap_data_subset_binary <- complete %>%
  select(bcap1_r,
         bcap2_r,
         bcap3:bcap22,
         bcap23_r,
         bcap24:bcap28,
         bcap29_r,
         bcap30:bcap34)

# Calculate the dichotomous summary statistics for each variable
bcap_summary_data_binary <- lapply(bcap_data_subset_binary, function(x) {
  per_no <- paste0(round(sum(x == 0, na.rm = TRUE) / length(x) *100, 1), "%")
  per_yes <- paste0(round(sum(x == 1, na.rm = TRUE) / length(x) *100, 1), "%")
  num_no <- sum(x == 0, na.rm = TRUE)
  num_yes <-sum(x == 1, na.rm = TRUE)
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(per_no = per_no, per_yes = per_yes, num_no = num_no, num_yes = num_yes, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
bcap_summary_data_binary <- as.data.frame(bcap_summary_data_binary)

# Set items as first row
bcap_summary_data_binary <- rbind(names(bcap_summary_data_binary), bcap_summary_data_binary) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
bcap_tbl_binary <- bcap_summary_data_binary %>%
  gt() %>%
  cols_label(`1` = "Variable",
             num_no = "N",
             per_no = "%",
             num_yes = "N",
             per_yes = "%",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ px(115),
             num_no ~ px(100),
             num_yes ~ px(100)) %>%
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("per_no", "per_yes", "num_no", "num_yes", "Missing"), align = "center") %>% 
  tab_spanner(label = "Disagree", columns = c(num_no, per_no)) %>% 
  tab_spanner(label = "Agree", columns = c(num_yes, per_yes)) %>% 
  tab_style(style = list(cell_fill(color = "#9BB6D1")),
            locations = cells_column_spanners()) %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = colorspace::lighten("#9BB6D1", .4))),
            locations = cells_column_labels(columns = c(num_yes, num_no, per_yes, per_no))) 

# Render the table
bcap_tbl_binary
```

For continuous total and subscale scores:

```{r bcap-mean-items}
# Create subset of bcap items
bcap_data_subset <- complete %>%
  select(
    bcap_risk, bcap_happy, bcap_feel_pers, bcap_lonely, bcap_fam_conf, bcap_rigid, bcap_distress, bcap_poverty, bcap_lie, bcap_random)

# Calculate the summary statistics for each variable
bcap_summary_data <- lapply(bcap_data_subset, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
bcap_summary_data <- as.data.frame(bcap_summary_data)

# Set items as first row
bcap_summary_data <- rbind(names(bcap_summary_data), bcap_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
bcap_tbl <- bcap_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(1 ~ px(165),2:5 ~ px(115)) %>%
    tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
bcap_tbl

```

#### Distributions

Distributions are presented below for the total score and each subscale:

```{r bcap-distributions, class.source='fold', echo = FALSE}
#Risk 
p_bcap_risk <- complete %>%
  composite_hist(
    x = bcap_risk
  ) +
  labs(
    title = 'Risk'
  )

# Happiness 
p_bcap_happy <- complete %>% 
  composite_hist(
    x = bcap_happy,
    bins = 5
  ) +
  labs(
    title = 'Happiness'
  )

# Feelings
p_bcap_pers <- complete %>% 
  composite_hist(
    x = bcap_feel_pers,
    bins = 5
  ) +
  labs(
    title = 'Feelings of Persecution'
  )

# Loneliness
p_bacp_lonely <- complete %>% 
  composite_hist(
    x = bcap_lonely,
    bins = 5
  ) +
  labs(
    title = 'Loneliness'
  )

# Family Conflict
p_bcap_fam_c<-complete %>% 
  composite_hist(
    x = bcap_fam_conf,
    bins = 5
  ) +
  labs(
    title = 'Family Conflict'
  )

# Rigidity
p_bcap_rig <- complete %>% 
  composite_hist(
    x = bcap_rigid,
    bins = 5
  ) +
  labs(
    title = 'Rigidity'
  )

# Distress
p_bcap_dis <- complete %>% 
  composite_hist(
    x = bcap_distress,
    bins = 5
  ) +
  labs(
    title = 'Distress'
  )

# Poverty
p_bcap_prov <- complete %>% 
  composite_hist(
    x = bcap_poverty,
    bins = 5
  ) +
  labs(
    title = 'Poverty'
  )

# Lying
p_bcap_lie <- complete %>% 
  composite_hist(
    x = bcap_lie,
    bins = 5
  ) +
  labs(
    title = 'Lying'
  )
    
# Random Responding 
p_bcap_rand <- complete %>% 
  composite_hist(
    x = bcap_random,
    bins = 5
  ) +
  labs(
    title = 'Random Responding'
  ) 

ggarrange(p_bcap_risk, p_bcap_happy + rremove("ylab"),
          p_bcap_pers+ rremove("ylab"), p_bacp_lonely+ rremove("ylab"),
          p_bcap_fam_c, p_bcap_rig+ rremove("ylab"),
          p_bcap_dis+ rremove("ylab"), p_bcap_dis+ rremove("ylab"),
          p_bcap_prov, p_bcap_lie+ rremove("ylab"),
          p_bcap_rand+ rremove("ylab")
          ) %>%
  annotate_figure(top = text_grob( "Distribution for bcap Subscale \n(x-axis and y-axis are in different scales)"))
```

## Dyadic Adjustment Scale (DAS)

### DAS Description

The DAS is a self-report measure used to assess dyadic adjustment
(e.g., interpersonal tensions, dyadic satisfaction, dyadic functioning).

  * For the present study, all 32 items from the DAS were collected, and
the total score and all subscales are included: Consensus, Affective
Expression, Satisfaction, and Cohesion.

  * **Higher** scores indicate **more** positive dyadic (couple) adjustment.

  * The missing data rule was Applied. Calculations were
completed only with participants that had less than 20% missing data
(this includes `-77` responses)

This survey was not administered for participants who were incarcerated at the time of the assessment. 

References:
[@spanier1976measuring](https://www.jstor.org/stable/350547);[DOI](https://doi.org/10.2307/350547);
[@ondersma2005brief](https://www.tandfonline.com/doi/abs/10.1207/s15374424jccp3402_9?casa_token=ZIJ3j8CLmK0AAAAA:_ztEWiTg5FO0Y3Jb_fL-zTuyqSmH623f0Q91STiqNR3jYvQyPzUiTqLSW3E5_U4iAucWcpqvbHAUug)

### DAS Variables

#### Value Labels

The DAS has multiple response options, value labels for each variable
can be found in the survey items table below.

#### Survey Items

All DAS survey items are presented in the following table:

```{r dyadc-var-prep}
# Pull question wording from qualtrics data
dyadc_word <- qualtrics %>% 
  select(starts_with("E")) %>%
  slice(1) %>%
  select(-(1:2)) %>%
  rename_with(~sub("^E", "das", .), starts_with("E"))

#create table with variable name, description, and notes
dyadc_word_long <- dyadc_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name), 
         Value = case_when(row_number() <= 15  ~ "0 = Always Disagree 
                                                 \n1 = Almost Always Disagree
                                                 \n2 = Frequently Disagree
                                                 \n3 = Occasionally Disagree
                                                 \n4 = Almost Always Agree
                                                 \n5 = Always Agree",
                           row_number() %in% c(16, 17, 20:22) ~ "0 = All the time 
                                                 \n1 = Most of the time
                                                 \n2 = More often than not
                                                 \n3 = Occasionally
                                                 \n4 = Rarely
                                                 \n5 = Never",
                           row_number() %in% c(18,19) ~ "0 = Never
                                                 \n1 = Rarely
                                                \n2 = Occasionally
                                                 \n3 = More often than not
                                                 \n4 = Most of the time
                                                 \n5 = All the time ",
                           between(row_number(), 23, 24 ) ~ "0 = Never
                                                 \n1 = Rarely
                                                 \n2 = Occasionally
                                                 \n3 = Almost every day
                                                 \n4 = Every day",
                           between(row_number(), 25,28) ~ "0 = Never
                                                 \n1 = Less than once a month
                                                 \n2 = Once or twice a month
                                                 \n3 = Once or twice a week
                                                 \n4 = Once a day
                                                 \n5 = More often",
                           row_number() %in% c(29,30) ~ "0 = Yes
                                                 \n1 = No",
                           row_number() %in% c(31) ~ "0 = Extremely Unhappy
                                                 \n1 = Fairly Unhappy
                                                 \n2 = A Little Unhappy
                                                 \n3 = Happy
                                                 \n4 = Very Happy
                                                 \n5 = Extremely Happy
                                                 \n6 = Perfect",
                           row_number() >= 32 ~ "0 =	My relationship can never succeed, and there is no more that I can do to keep the relationship going.
                                                 \n1 =	It would be nice if it succeeded, but I refuse to do any more than I am doing now to keep the relationship going.
                                                 \n2 =	It would be nice if my relationship succeeded, but I canâ€™t do much more than Iâ€™m doing now to help it succeed.
                                                 \n3 =	I want very much for my relationship to succeed, and will do my fair share to see that it does.
                                                 \n4 =	I want very much for my relationship to succeed, and will do all I can to see that it does.
                                                 \n5 =	I want desperately for my relationship to succeed, and would go to almost any length to see that it does."
                           ))%>% 
   mutate(description = if_else(var_name == "das31", " Please indicate the number that best describes the degree of happiness in your relationship.",
                               if_else(var_name == "das32", "Which of the following statements best describes how you feel about the future of your relationship? Please indicate only one answer", description))) %>%
  slice(1:32)


```

Some questions in this survey were not asked for participants who were incarcerated at the time of the assessment.

```{r dyadc-var-table, results ='asis'}
# Create the gt table object and apply generic theme
dyadc_gt_table <- gt(dyadc_word_long)

# Table-specific formatting (col width, names)
dyadc_gt_table <- dyadc_gt_table %>% 
  apply_tbl_theme() %>% 
  tab_row_group(label = "Please indicate if items below were problems in your relationships in the past few weeks.", 
                rows = 29:32,
                id = "set4") %>%
  tab_row_group(label = "Thinking about the past 6 months,how often do youâ€¦", 
                rows = 25:28,
                id = "set3") %>%
  tab_row_group(label = "In the past 6 months, how often. . .", 
                rows = 23:24,
                id = "set2") %>%
  tab_row_group(label = "Thinking about the past 6 months, how often do you. . . ", 
                rows = 1:22,
                id = "set1")%>%
  cols_label(var_name = "Variable", 
            description = "Description",
            #notes = "Notes"
            ) %>% 
  tab_style(style = list(cell_fill(color = "#9BB6D1", alpha = 0.2),
                         cell_borders(sides = c("left", "right", "top", "bottom"))),
            locations = cells_row_groups(groups = c("set1", "set2", "set3", "set4"))) %>%
  cols_width(#notes ~ px(150),
             var_name ~ px(100),
             Value ~ px(225)) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(dyadc_gt_table)

#WHEN RENDERING WITH PDF USE: 
#dyadc_gt_table


```

#### Scale and Subscales

Information on total score and subscale variables are below.
See cleaning syntax and annotations for guidance on how variables were constructed. 

```{r dyadc alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 
dyadc_alpha <-
  complete %>% 
  select(
    das1:das32
  ) %>% 
  psych::alpha(check.keys = TRUE)

dyadc_con_alpha <-
  complete %>% 
  select(
    das1, das2, das3, das5, das7, das8,das9,das10,das11,das12,das13,das14,das15
  ) %>% 
  psych::alpha(check.keys = TRUE)

dyadc_aff_exp_alpha <-
  complete %>% 
  select(
    das4, das6, das29, das30
  ) %>% 
  psych::alpha(check.keys = TRUE)

dyadc_satis_alpha <-
  complete %>% 
  select(
    das16:das23,
    das31,
    das32
  ) %>% 
  psych::alpha(check.keys = TRUE)

dyadc_cohes_alpha <-
  complete %>% 
  select(
    das24:das28
  ) %>% 
  psych::alpha(check.keys = TRUE)
```

```{r dyadc-scale-table, results = 'asis'}
# Create the table as a data frame
dyadc_scale_df <- data.frame(
  var_name = c("dyadc_total", "dyadc_con", "dyadc_aff_exp", "dyadc_satis", "dyadc_cohes"),
  scale = c("DYADC Total score (32) ", "Consensus (13)", "Affective Expression (4)", "Satisfaction (10)", "Cohesion (5)"),
  scale_construction = c("`das1`, `das2`, `das3`, `das4`, `das5`, `das6`, `das7`, `das8`, `das9`, `das10`, `das11`, `das12`, `das13`, `das14`, `das15`, `das16`, `das17`, `das18_r`, `das19_r`, `das20`, `das21`, `das22`, `das23`, `das24`, `das25`, `das26`, `das27`, `das28`, `das29`, `das30`, `das31`, `das32`", 
                         "`das1`, `das2`, `das3`, `das5`, `das7`, `das8`, `das9`, `das10`, `das11`, `das12`, `das13`, `das14`, `das15`", 
                         "`das4`, `das6`, `das29`, `das30`", 
                         "`das16`, `das17`, `das18_r`, `das19_r`, `das20`, `das21`, `das22`, `das23`, `das31`, `das32`", "`das24`, `das25`, `das26`, `das27`, `das28`"),
  scale_range = c("0-151","0-65","0-12","0-50","0-24"), 
   alpha = c(round(dyadc_alpha$total$raw_alpha, 3),
              round(dyadc_con_alpha$total$raw_alpha, 3),
              round(dyadc_aff_exp_alpha$total$raw_alpha, 3),
              round(dyadc_satis_alpha$total$raw_alpha, 3),
              round(dyadc_cohes_alpha$total$raw_alpha, 3))
  )

# Create the gt table object
dyadc_scale_table <- gt(dyadc_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Scale (# of items)", 
            scale_construction = "Scale Construction",
            scale_range = "Range*",
            alpha = "Alpha") %>% 
  tab_footnote(footnote = "*Range of possible values; `_r` Reverse scored variable") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  #cols_width(scale ~ px(135)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_tbl_theme() 

# Print the table
print(dyadc_scale_table)

```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item, total, and
subscale score.

For continuous items:

```{r dyadc-mean-items}
# Create subset of dyadc items
dyadc_data_subset <- complete %>%
  select(das1:das28, das31:das32, dyadc_total,
         dyadc_con, dyadc_aff_exp,
         dyadc_satis, dyadc_cohes)  


# Calculate the summary statistics for each variable
dyadc_summary_data <- lapply(dyadc_data_subset, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
dyadc_summary_data <- as.data.frame(dyadc_summary_data)

# Set items as first row
dyadc_summary_data <- rbind(names(dyadc_summary_data), dyadc_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
dyadc_tbl <- dyadc_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(1 ~ px(165),2:5 ~ px(115)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  tab_options(table.width = pct(100))%>%
  apply_tbl_theme()

# Render the table
dyadc_tbl

```

For binary items:

```{r dyadc-binary-desc}

# Create subset of BCAP items
dyadc_data_subset_binary <- complete %>%
  select(das29, das30)

# Calculate the dichotomous summary statistics for each variable
dyadc_summary_data_binary <- lapply(dyadc_data_subset_binary, function(x) {
  per_no <- paste0(round(sum(x == 0, na.rm = TRUE) / length(x) *100, 1), "%")
  per_yes <- paste0(round(sum(x == 1, na.rm = TRUE) / length(x) *100, 1), "%")
  num_no <- sum(x == 0, na.rm = TRUE)
  num_yes <-sum(x == 1, na.rm = TRUE)
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(per_no = per_no, per_yes = per_yes, num_no = num_no, num_yes = num_yes, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
dyadc_summary_data_binary <- as.data.frame(dyadc_summary_data_binary)

# Set items as first row
dyadc_summary_data_binary <- rbind(names(dyadc_summary_data_binary), dyadc_summary_data_binary) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
dyadc_tbl_binary <- dyadc_summary_data_binary %>%
  gt() %>%
  cols_label(`1` = "Variable",
             num_no = "N",
             per_no = "%",
             num_yes = "N",
             per_yes = "%",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ px(115),
             num_no ~ px(100),
             num_yes ~ px(100)) %>%
  cols_align(columns = c("per_no", "per_yes", "num_no", "num_yes", "Missing"), align = "center") %>% 
  tab_spanner(label = "No", columns = c(num_no, per_no)) %>% 
  tab_spanner(label = "Yes", columns = c(num_yes, per_yes)) %>% 
  tab_style(style = list(cell_fill(color = "#9BB6D1")),
            locations = cells_column_spanners()) %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = colorspace::lighten("#9BB6D1", .4))),
            locations = cells_column_labels(columns = c(num_yes, num_no, per_yes, per_no))) %>%
  tab_options(table.width = pct(100))

# Render the table
dyadc_tbl_binary
```

#### Distributions

Distributions are presented below for the total score and each subscale:

```{r dyadc-distributions, class.source='fold', echo = FALSE}
p_dyadc_total <- complete %>%
  composite_hist(
    x = dyadc_total
  ) +
  labs(
    title = 'DYADC Total Score'
  )

p_dyadc_con <- complete %>%
  composite_hist(
    x = dyadc_con
  ) +
  labs(
    title = 'Consensus'
  )

p_dyadc_aff_e <- complete %>%
  composite_hist(
    x = dyadc_aff_exp,
    bins = 10
  ) +
  labs(
    title = 'Affectional Expression'
  )

p_dyadc_satis <- complete %>%
  composite_hist(
    x = dyadc_satis
  ) +
  labs(
    title = 'Satisfaction'
  )

p_dyadc_choes <- complete %>%
  composite_hist(
    x = dyadc_cohes
  ) +
  labs(
    title = 'Cohesion'
  )

ggarrange(p_dyadc_total, p_dyadc_con + rremove("ylab"),
          p_dyadc_aff_e+ rremove("ylab"), p_dyadc_satis,
          p_dyadc_choes + rremove("ylab")
          ) %>%
  annotate_figure(top = text_grob( "Distribution for DYADC Total and Subscale \n(x-axis and y-axis are in different scales)"))
```


## Attachment Relationships Questionnaire (ARQ)

### ARQ Description

The ARQ is a self-report measure used to categorize attachment styles in
adulthood. <MARIA> CONFIRM THIS IS CORRECT

For the present study, all 5 items from the ARQ were collected in order
to construct four attachment styles (secure, fearful, preoccupied, and
dismissing).

No items need to be reverse scored. Participants self-select one
attachment style that best describes them in the first question `rq1`,
then rate their agreement with each attachment style for `rqa` - `rqd`.
Higher ratings indicate more agreement with the statement.

The missing data rule is applied. Calculations were completed for
participants with 20% or less missing data (this includes -77 responses)

Reference:
[@bartholomew1991attachment](https://psycnet.apa.org/record/1991-33075-001);[DOI](https://doi.org/10.1037/0022-3514.61.2.226)
# add this references MARIA https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8470855/
### ARQ Variables

#### Value Labels

Response options for `rq1`

```{r ARQ-label-table, results = 'asis'}

arq_label_df <- data.frame(
  value = c("A", "B", "C", "D"),
  label = c("It is easy for me to become emotionally close to others. I am comfortable dependingon them and having them depend on me. I don't worry about being alone or havingothers not accept me.",
            "I am uncomfortable getting close to others. I want emotionally close relationships, but Ifind it difficult to trust others completely, or to depend on them. I worry that I will be hurt ifI allow myself to become too close to others.",
            "I want to be completely emotionally intimate with others, but I often find that others arereluctant to get as close as I would like. I am uncomfortable being without close relationships, but I sometimes worry that others don't value me as much as I value them.",
            "I am comfortable without close emotional relationships. It is very important to me tofeel independent and self-sufficient, and I prefer not to depend on others or have othersdepend on me.")
) %>% 
  t() %>% 
  as.data.frame()


arq_label_df <- setNames(arq_label_df[-1, ], unlist(arq_label_df[1, ]))


#create table
arq_label_table <- arq_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ pct(100)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(arq_label_table)


```

Response option for `arqa`, `arqb`, `arqc`, `arqd`.

```{r ARQ-label-table-2, results = 'asis'}

arq_label_df2 <- data.frame(
  value = c("1", "2", "3", "4", "5", "6", "7"),
  label = c("Disagree Strongly",
            "",
            "",
            "Neutral/Mixed",
            "",
            "",
            "Agree Strongly")
) %>% 
  t() %>% 
  as.data.frame()


arq_label_df2 <- setNames(arq_label_df2[-1, ], unlist(arq_label_df2[1, ]))


#create table
arq_label_table2 <- arq_label_df2 %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ px(180)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(arq_label_table2)


```

#### Survey Items

All ARQ survey items are presented in the following table

```{r ARQ-var-prep}
# Pull question wording from qualtrics data
arq_word <- qualtrics %>% 
  select(RQ1,RQA, RQB, RQC, RQD) %>% 
  rename_with(~ str_replace(., "^RQ", "arq"), starts_with("RQ")) %>%
  slice(1)

#create table with variable name, description, and notes
arq_word_long <- arq_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name), 
         notes = as.character("")) %>% 
  mutate(description = if_else(var_name == "arq1", "Please tell me which one style best describes you or is the closest to the way you are.", description))

```

```{r arq-var-table, results ='asis'}
# Create the gt table object and apply generic theme
arq_gt_table <- gt(arq_word_long)

# Table-specific formatting (col width, names)
arq_gt_table <- arq_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(arq_gt_table)

#WHEN RENDERING WITH PDF USE: 
#my_gt_table
```

#### Scale and Subscales
## MIN why is this included in the codebook?

Information on constructed attachment groups is presented below. The
highest rating for attachment style was used to classify participants
into one of four attachment groups (secure, dismissing, preoccupied,
fearful). Model of the self (i.e., attachment anxiety) was calculated by
summing secure and dismissing ratings then subtracting the sum of
preoccupied and fearful items. Model of the other (i.e., attachment
avoidance) was constructed by summing secure and preoccupied items and
subtracting the sum of dismissing and fearful items. Higher scores on
attachment models indicate more positive attachment models. <MARIA>
CONFIRM THIS IS CORRECT


```{r arq-subscales}
# no internal consistency should be calculated
# DATA CLEANING CODE - create arq categories
vars_to_check <- c("arqa", "arqb", "arqc", "arqd")

arq_subscale <- complete %>% 
  mutate(max_var = apply(.[vars_to_check], 1, function(row) vars_to_check[which.max(row)])) %>% 
  mutate(arq_group = case_when(max_var == "arqa" ~ "Secure",
                               max_var == "arqb" ~ "Fearful",
                               max_var == "arqc" ~ "Preoccupied",
                               max_var == "arqd" ~ "Dismissive",
                               TRUE ~ NA_character_),
         arq_model_self = rowSums(data.frame(arqa, arqd), na.rm = TRUE) - rowSums(data.frame(arqc, arqb), na.rm = TRUE),
    arq_model_other = rowSums(data.frame(arqa, arqc), na.rm = TRUE) - rowSums(data.frame(arqd, arqb), na.rm = TRUE)) %>%
  mutate_at(vars(arq_model_self, arq_model_other), ~ if_else(is.na(arq_group), NA_real_, .)) %>% 
  select(-max_var) 

#missing ratings: 50, 116, and 123

```

```{r ARQ-scale-table, results = 'asis'}
# Create the table as a data frame
# Maria to update these names
arq_scale_df <- data.frame(
  var_name = c("arq_group", "arq_model_self", "arq_model_other"),
  scale = c("Attachment Group", "Model of Self", "Model of Other"),
  scale_construction = c("Highest rating among `arqa`, `arqb`, `arqc`, `arqd`", "(`arqa` + `arqd`) - (`arqc` + `arqb`)", "(`arqa` + `arqc`) - (`arqd` + `arqb`)"))

# Create the gt table object
arq_scale_table <- gt(arq_scale_df) %>% 
  cols_label(var_name = "Variable Name",
            scale = "Scale Name", 
            scale_construction = "Scale Construction") %>% 
  tab_options(table.width = pct(100))%>%
  #tab_options(table.border.bottom.style = "hidden") %>% 
  apply_tbl_theme() 

# Print the table
print(arq_scale_table)
```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item and
total/subscale score

```{r ARQ-mean-items}
# Create subset of ARQ items
# Maria to do, this should not inlcude rq1 and arq_group, but all other subscales should also be included 
arq_data_subset <- complete %>%
  select(arq1,arqa,	arqb, arqc, arqd)

# Calculate the summary statistics for each variable
arq_summary_data <- lapply(arq_data_subset, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
arq_summary_data <- as.data.frame(arq_summary_data)

# Set items as first row
arq_summary_data <- rbind(names(arq_summary_data), arq_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
arq_tbl <- arq_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ px(115)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  tab_options(table.width = pct(100))%>%
  apply_tbl_theme()

# Render the table
arq_tbl

```

#### Distributions

Distributions are presented for the two subscales only 
*TODO:
JP's graphs are count on x axis*

```{r ARQ-distributions, class.source='fold', echo = FALSE}
p_arq1 <- complete %>%
  select(arq1) %>%
  mutate(
    across(
      .cols = arq1,
      .fns = ~case_when(
        .x == "A" ~ 1,
        .x == "B" ~ 2,
        .x == "C" ~ 3,
        .x == "D" ~ 4,
        TRUE ~ NA_real_
      )
    )
    ) %>%
  composite_hist(x = arq1, bins = 4) +
  scale_x_continuous(breaks=c(1,2,3,4),
    #breaks=c("1","2","3","4"),
        labels=c("A","B", "C", "D")) +
  labs(title = 'arq1') 

p_arqa <- complete %>%
  composite_hist(x = arqa, bins = 10) +
  labs(title = 'arqa')

p_arqb <- complete %>%
  composite_hist(x = arqb, bins = 10) +
  labs(title = 'arqb')

p_arqc<-complete %>%
  composite_hist(x = arqc, bins = 10) +
  labs(title = 'arqc')

p_arqd<-complete %>%
  composite_hist(x = arqd, bins = 10) +
  labs(title = 'arqd')

ggarrange(p_arq1, p_arqa + rremove("ylab"),
          p_arqb+ rremove("ylab"), p_arqc,
          p_arqd + rremove("ylab")
          ) %>%
  annotate_figure(top = text_grob( "Distribution for ARQ \n(x-axis and y-axis are in different scales)"))
```



## Posttraumatic Risk Seeking Scale (PRSS)

### PRSS Description

The PRSS is a 5-item questionnaire designed to measure *insert text*

For the present study, 5 items from the PRSS were collected in order to
*TODO: insert text here*

No items need to be reverse scored. *TODO: need change text here Higher
scores indicate more severe mental health symptoms.*

The missing data rule was applied. Calculations were completed for
participants with 33% or less missing data (this includes -77 responses)

Reference:
[@kerig2019linking](https://onlinelibrary.wiley.com/doi/abs/10.1111/cpsp.12280);
[DOI](https://doi.org/10.1111/cpsp.12280)

### PRSS Variables

#### Value Labels

All PRSS variables have the same response options.

```{r PRSS-label-table, results = 'asis'}

prss_label_df <- data.frame(
  value = c("0", "1", "2", "3", "4"),
  label = c("None of the time",
            "A little of the time",
            "Some of the time",
            "Much of the time",
            "Most of the time")) %>% 
  t() %>% 
  as.data.frame()

prss_label_df <- setNames(prss_label_df[-1, ], unlist(prss_label_df[1, ]))


#create table
prss_label_table <- prss_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ px(150)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(prss_label_table)


```

#### Survey Items

PRSS survey items are presented in the following table:

```{r prss-var-prep}
# Pull question wording from Qualtrics data
prss_word <- qualtrics %>% 
  select(starts_with("ps")) %>% 
  rename_with(~ paste0("prss", as.numeric(str_replace(., "^PS", "")) - 8), starts_with("PS")) %>%
  slice(1)

#create table with variable name, description, and notes
prss_word_long <- prss_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name), 
         notes = as.character(""))%>%
  slice(9:13)

```

```{r prss-var-table, results ='asis'}
# Create the gt table object and apply generic theme
# this sould be ps9-ps13
prss_gt_table <- gt(prss_word_long)

# Table-specific formatting (col width, names)
prss_gt_table <- prss_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(prss_gt_table)

#WHEN RENDERING WITH PDF USE: 
#my_gt_table
```

#### Scale and Subscales

Information on the total score and subscale variables are below.
Variables were constructed by summing included items.

```{r prss alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 
prss_alpha <-
  complete %>%
  select(prss1:prss5) %>%  
  psych::alpha(check.keys = TRUE)
```

```{r PRSS-scale-table, results = 'asis'}
# Create subset of prss items
prss_data_subset <- complete %>%
  select(prss1:prss5, prss_total)


# Create the table as a data frame
prss_scale_df <- data.frame(
  var_name = c("prss_total"),
  scale = c("PRSS Total score (5) "),
  scale_construction = c("`prss1`, `prss2`, `prss3`, `prss4`, `prss5`"),
  scale_range = c("0-16"), #TODO maria double check range 
   alpha = c(round(prss_alpha$total$raw_alpha, 3))
  )

# Create the gt table object
prss_scale_df <- gt(prss_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Scale (# of items)", 
            scale_construction = "Scale Construction",
            scale_range = "Range*",
            alpha = "Alpha") %>% 
  tab_footnote(footnote = "*Range of possible values; `_r` Reverse scored variable") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  #cols_width(scale ~ px(135)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_tbl_theme() 

# Print the table
print(prss_scale_df)


```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item, total, and
subscale score:

```{r prss-mean-items}

# Calculate the summary statistics for each variable
prss_summary_data <- lapply(prss_data_subset, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
prss_summary_data <- as.data.frame(prss_summary_data)

# Set items as first row
prss_summary_data <- rbind(names(prss_summary_data), prss_summary_data) %>% 
  t() %>% 
  as.data.frame() 

# Create the gt table
prss_tbl <- prss_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ px(115)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  tab_options(table.width = pct(100))%>%
  apply_tbl_theme()

# Render the table
prss_tbl

```

#### Distributions

Distributions are presented below for the total score and each subscale:

```{r PRSS-distributions, class.source='fold', echo = FALSE}
complete %>%
  composite_hist(
    x = prss_total
  ) +
  labs(title = "Distribution of Total Scores for the PRSS")


```


## Stigma & Shame Questionnaire (SSQ)

### SSQ Description

The SSQ is a 8-item questionnaire designed to measure *insert*.

For the present study, 8 items from the SSQ were collected in order to
#TODO: insert text here

No items need to be reverse scored. *TODO: need change text here Higher
scores indicate more severe mental health symptoms.*

The missing data rule was applied. Calculations were completed for
participants with 33% or less missing data (this includes -77 responses)

Reference:
[@feiring2005persistence](https://journals.sagepub.com/doi/abs/10.1177/1077559505276686);
[DOI](https://doi.org/10.1177/1077559505276686)

### SSQ Variables

#### Value Labels

All SSQ variables have the same response options.

```{r SSQ-label-table, results = 'asis'}

ssq_label_df <- data.frame(
  value = c("0", "1", "2", "3", "4"),
  label = c("None of the time",
            "A little of the time",
            "Some of the time",
            "Much of the time",
            "Most of the time")) %>% 
  t() %>% 
  as.data.frame()

ssq_label_df <- setNames(ssq_label_df[-1, ], unlist(ssq_label_df[1, ]))


#create table
ssq_label_table <- ssq_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ px(180)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(ssq_label_table)


```

#### Survey Items

SSQ survey items are presented in the following table:

```{r ssq-var-prep}
# Pull question wording from qualtrics data
ssq_word <- qualtrics %>% 
  select(starts_with("ps")) %>% 
  slice(1)

#create table with variable name, description, and notes
ssq_word_long <- ssq_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name), 
         notes = as.character("")) %>% 
  slice(1:8)


```

```{r ssq-var-table, results ='asis'}
# Create the gt table object and apply generic theme
ssq_gt_table <- gt(ssq_word_long)

# Table-specific formatting (col width, names)
ssq_gt_table <- ssq_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(ssq_gt_table)


```


#### Scale and Subscales

Information on the total score and subscale variables are below.
Variables were constructed by summing included items.

```{r ssq alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 

ssq_alpha <- complete %>% 
  select(
    ssq1:ssq8
  ) %>% 
  psych::alpha(check.keys = TRUE)
```

```{r SSQ-scale-table, results = 'asis'}
# Create subset of ssq items
ssq_data_subset <-
  complete %>%
  select(ssq1:ssq_total) # Min does not include cutoff

# Create the table as a data frame
ssq_scale_df <- data.frame(
  var_name = c("ssq_total"),
  scale = c("SSQ Total score (8)"),
  scale_construction = c("`ssq1`, `ssq2`, `ssq3`, `ssq4`,`ssq5`, `ssq6`, `ssq7`, `ssq8`"),
  scale_range = c("0-32"), # possible range
  alpha = c(round(ssq_alpha$total$raw_alpha, 3))
)


# Create the gt table object
ssq_scale_df <- gt(ssq_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
             scale = "Scale (# of items)", 
             scale_construction = "Scale Construction",
             scale_range = "Range*",
             alpha = "Alpha") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  cols_width(scale ~ px(135)) %>% 
  apply_tbl_theme() 

# Print the table
print(ssq_scale_df)


```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item and the total score:

```{r ssq-mean-items}
# Calculate the summary statistics for each variable
ssq_summary_data <- lapply(ssq_data_subset, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
ssq_summary_data <- as.data.frame(ssq_summary_data)

# Set items as first row
ssq_summary_data <- rbind(names(ssq_summary_data), ssq_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
ssq_tbl <- ssq_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  #cols_width(everything() ~ px(115)) %>%
  
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
ssq_tbl

```

#### Distributions

Distributions are presented below for the total score and each subscale:

```{r ssq-distributions, class.source='fold', echo = FALSE}

ssq_data_subset %>%
  filter(ssq_total >= 0) %>%
  composite_hist(x = ssq_total) +
  labs(title = "Distribution of Total Scores for the Stigma & Shame Questionnaire")

```



## Elliott Delinquency Scale (EDS) Friends/Peers report

### EDS Description

The EDS is a 39-item questionnaire designed to measure *insert*.

For the present study, 39 items from the EDS were collected in order to
#TODO: insert text here

All 39 items need to be reverse scored. *TODO: need change text here
Higher scores indicate more severe mental health symptoms.*

The missing data rule was applied. Calculations were completed for
participants with 33% or less missing data (this includes -77 responses)

This survey was not administered for participants who were incarcerated at the time of the assessment.

## edit this this is the number matching with original scale 
01 = 01, 02 = 03, 03 = 04, 04 = 05, 05 = 06, 06 = 07, 07 = 08, 08 = 09, 09 = 10, 10 = 11, 11 = 12, 12 = 13, 13 = N/A, 14 = 14, 15 = 15, 16 = 16, 17 = 17, 18 = 19, 19 = 20, 20 = 22, 21 = 24, 22 = 25, 23 = N/A, 24 = 26, 25 = 27, 26 = 28, 27 = 29, 28 = 30, 29 = 32, 30 = 34, 31 = 35, 32 = 37, 33 = 38, 34 = 40, 35 = 41, 36 = 42, 37 = 43, 38 = 44, 39 = 45

Reference:
[@feiring2005persistence](https://journals.sagepub.com/doi/abs/10.1177/1077559505276686);
[DOI](https://doi.org/10.1177/1077559505276686)

### EDS Variables

#### Value Labels

All EDS variables have the same response options.

```{r EDS-label-table, results = 'asis'}

eds_label_df <- data.frame(
  value = c("4", "3", "2", "1", "0", "0 "),
  label = c("All",
            "Most",
            "Some",
            "Very Few",
            "None",
            "Does not apply")) %>% 
  t() %>% 
  as.data.frame()

eds_label_df <- setNames(eds_label_df[-1, ], unlist(eds_label_df[1, ]))


#create table
eds_label_table <- eds_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ px(150)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(eds_label_table)


```

#### Survey Items

EDS survey items are presented in the following table:

```{r eds-var-prep}
# Pull question wording from qualtrics data
eds_word <- qualtrics %>% 
  select(starts_with("elf")) %>% 
  slice(1)

#create table with variable name, description, and notes
eds_word_long <- eds_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name),
          notes = ("")
          # notes = paste0("This item should be reverse scored. `", var_name, "_c` is reverse scored")
           ) %>% 
  slice(1:39)
# TODO: need double check reverse code variable name, it's inconsistant with other measure's reverse score name 

```

```{r eds-var-table, results ='asis'}
# Create the gt table object and apply generic theme
eds_gt_table <- gt(eds_word_long)

# Table-specific formatting (col width, names)
eds_gt_table <- eds_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
  tab_options(table.width = pct(100))%>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())


# Print the table
print(eds_gt_table)


```

#### Scale and Subscales

Information on the total score and subscale variables are below.
Variables were c onstructed by summing included items.


#Calculate internal reliability

```{r eds alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
eds <-
  complete %>%
  select(
    matches(
      "^elf"
    )
  )
#Calculate internal reliability 
eds_alpha <- complete %>% 
  select(elf1:elf39) %>%
  drop_na() %>%  # TODO: Shaina: I don't know why does including NA doesn't work for the alpha function. 
    psych::alpha(check.keys = TRUE)

```

TODO: all revers coded column is 0, need to double check, I used
non-revers coded score for now

```{r EDS-scale-table, results = 'asis'}


# Create the table as a data frame
eds_scale_df <- data.frame(
  var_name = c("eds_total"),
  scale = c("EDS Total score (39)"),
  scale_construction = c("`elf1`, `elf2`, `elf3`, `elf4`, `elf5`, `elf6`, `elf7`, 
  `elf8`, `elf9`, `elf10`, `elf11`, `elf12`, `elf13`, `elf14`, `elf15`, `elf16`, 
  `elf17`, `elf18`, `elf19`, `elf20`, `elf21`, `elf22`, `elf23`, `elf24`, `elf25`, 
  `elf26`, `elf27`, `elf28`, `elf29`, `elf30`, `elf31`, `elf32`, `elf33`, `elf34`, 
                         `elf35`, `elf36`, `elf37`, `elf38`, `elf39`"),
  scale_range = c("39-159"), #TODO fill in range 
  alpha = c(round(eds_alpha$total$raw_alpha, 3))
)

# Create the gt table object
eds_scale_df <- gt(eds_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
             scale = "Scale (# of items)", 
             scale_construction = "Scale Construction",
             scale_range = "Range*",
             alpha = "Alpha") %>% 
  tab_footnote(footnote = "*Range of possible values; `_r` Reverse scored variable") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  cols_width(scale ~ px(135)) %>% 
  apply_tbl_theme() 

# Print the table
print(eds_scale_df)


```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item, total, and
subscale score:

```{r eds-mean-items}
# Calculate the summary statistics for each variable
eds_summary_data <- lapply(eds, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
eds_summary_data <- as.data.frame(eds_summary_data)

# Set items as first row
eds_summary_data <- rbind(names(eds_summary_data), eds_summary_data) %>% 
  t() %>% 
  as.data.frame()


# Create the gt table
eds_tbl <- eds_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
 #cols_width(everything() ~ px(115)) %>%
    tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
eds_tbl

```

#### Distributions

Distributions are presented below for the total score and each subscale:

```{r eds-distributions, class.source='fold', echo = FALSE}

eds %>%
  composite_hist(
    x = elf_total
  ) +
  labs(title = "Distribution of Total Scores for the Stigma & Shame Questionnaire")

```



## Elliott Delinquency Scale Self Report (ELL)

### ELL Description

The Ell is a 39-item questionnaire designed to measure *insert*.

For the present study, 39 items from the ELL were collected in order to
#TODO: insert text here

No items need to be reverse scored. *TODO: need change text here Higher
scores indicate more severe mental health symptoms.*

The missing data rule was applied. Calculations were completed for
participants with 33% or less missing data (this includes -77 responses)

Reference:
[@feiring2005persistence](https://journals.sagepub.com/doi/abs/10.1177/1077559505276686);
[DOI](https://doi.org/10.1177/1077559505276686)

### ELL Variables

#### Value Labels

Variable Scale (for variables that end with a) and for any item that has
been done 10 or more times.
TODO: Shaina: please review text above as I altered JP's text.

```{r ELL-label-table, results = 'asis'}
ell_label_df <- data.frame(
  value = c("1", "2", "3", "4", "5", "6"),
  label = c("Once a month",
            "Once every 2-3 weeks",
            "Once a week",
            "2-3 times a dday",
            "Once a day",
            "2-3 times a day")) %>% 
  t() %>% 
  as.data.frame()

ell_label_df <- setNames(ell_label_df[-1, ], unlist(ell_label_df[1, ]))


#create table
ell_label_table <- ell_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ px(180)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(ell_label_table)


```

#### Survey Items

ELL survey items are presented in the following table. Variables are not ending with a are open ended. Vairable end with a only been ask for item that has been done 10 or more times. 

```{r ell-var-prep}
# Pull question wording from qualtrics data
ell_word <- qualtrics %>% 
  select(starts_with("ell"))%>%
  slice(1)

#create table with variable name, description, and notes
ell_word_long <- ell_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name), 
         notes = as.character("")) %>% 
  mutate(description = gsub("ASSESSOR NOTE.*","",description))# %>%
  # slice(1:78)

```

```{r ell-var-table, results ='asis'}
# Create the gt table object and apply generic theme
ell_gt_table <- gt(ell_word_long)

# Table-specific formatting (col width, names)
ell_gt_table <- ell_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels()) 

# Print the table
print(ell_gt_table)


```

#### Scale and Subscales

Information on the total score and subscale variables are below.
Variables were c onstructed by summing included items.

```{r ell df, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
ell <-
  complete %>%
  select(
    starts_with("ell"),
    -c(matches("aa$"))
  ) %>%
  # rename(
  #   ell35a  = x35a
  # ) %>%
  mutate(
    across(
      matches("a$"),
      ~case_when(
        .x == 7 ~ -77,
        .x == 8 ~ NA_real_,
        is.na(.x) ~ NA_real_,
        TRUE ~ .x
      )
    )
  )

ell_calc <-
  ell %>%
  select(
    matches("a$")
  ) %>%
  mutate(
    across(
      #.cols = -id,
      .fns = ~case_when(
        .x == -77 ~ NA_real_,
        TRUE ~ .x
      )
    ),
    across(
      .names = "{.col}a"
    ),
    across(
      c(
        matches("a$"),
        matches("aa$")
      ),
      ~case_when(
        .x == 1 ~ 0,
        .x == 2 ~ 1,
        .x == 3 ~ 2,
        .x == 4 ~ 3,
        .x == 5 ~ 4,
        .x == 6 ~ 5,
        .x == 7 ~ -77,
        .x == 8 ~ NA_real_,
        TRUE ~ NA_real_
      )
    ),
    across(
      c(
        matches("aa$")
      ),
      ~case_when(
        .x >= 4 ~ 4,
        TRUE ~ .x
      )
    )
  )

ell_count_calc <-
  ell %>%
  select(
   # id,
    matches("\\d$")
  ) %>%
  mutate(
    across(
     # -id,
      .cols = everything(),
      ~case_when(
        .x == 0 ~ 0,
        .x > 0 ~ 1,
        #.x < 0 ~ NA,
        #TRUE ~ .x
      )
    )
  )


```

```{r ell calculation, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
# ell_complete <-
#   ell_calc %>%
#   subscale_create(
#     total_only = TRUE,
#     scale1 = c(
#       "ell4a", "ell5a", "ell6a", "ell8a", "ell9a",
#       "ell10a", "ell11a", "ell14a", "ell16a", "ell20a",
#       "ell21a", "ell22a", "ell24a", "ell25a", "ell27a", "ell29a",
#       "ell31a", "ell32a", "ell33a", "ell38a", "ell39a"
#     ),
#     scale2 = c(
#       "ell4aa", "ell5aa", "ell6aa", "ell8aa", "ell9aa",
#       "ell10aa", "ell11aa", "ell14aa", "ell16aa", "ell20aa",
#       "ell21aa", "ell22aa", "ell24aa", "ell25aa", "ell27aa", "ell29aa",
#       "ell31aa", "ell32aa", "ell33aa", "ell38aa", "ell39aa"
#     )
#   ) %>%
#   rename(
#     ell_raw_total = total1,
#     ell_censor_total = total2
#   )
# 
# 
# ell_count_complete <-
#   ell_count_calc %>%
#   composite_total_avg_fun(
#     id = c(
#       'id', "ell1", "ell2", "ell3", "ell7",
#       "ell12", "ell13", "ell15", "ell17", "ell18",
#       "ell19", "ell23", "ell26", "ell28", "ell30",
#       "ell34", "ell35", "ell36", "ell37"
#     ),
#     max_value = 1,
#     n_items = 21
#   ) %>%
#   distinct(
#     across(
#       .cols = everything()
#     )
#   ) %>%
#   rename(
#     ell_count_total = sum_values,
#     ell_count_avg = mean_values
#   ) %>%
#   mutate(
#     across(
#       c(
#         ell_count_total,
#         ell_count_avg
#       ),
#       ~case_when(
#       #  id %in% ell_count_remove ~ NA_real_,
#         TRUE ~ .x
#       )
#     )
#   )
```

```{r ell alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 
#TODO: Shaina: JP doesn't include alpha in his script. Please review and delet if not needed


```

```{r ELL-scale-table, results = 'asis'}
# Create the table as a data frame
ell_scale_df <- data.frame(
  var_name = c("ell_raw_total"),
  scale = c("ELL score (Raw) (21)", "ELL Total (Censored) (21)", "ELL Total (Binary Count Data) (18)"),
  scale_construction = c(" `ell4a`, `ell5a`, `ell6a`, `ell8a`, `ell9a`,
      `ell10a`, `ell11a`, `ell14a`, `ell16a`, `ell20a`,
      `ell21a`, `ell22a`, `ell24a`, `ell25a`, `ell27a`, `ell29a`,
      `ell31a`, `ell32a`, `ell33a`, `ell38a`, `ell39a`", 
      " `ell4aa`, `ell5aa`,`ell6aa`, `ell8aa`, `ell9aa`,
      `ell10aa`, `ell11aa`, `ell14aa`, `ell16aa`, `ell20aa`,
      `ell21aa`, `ell22aa`, `ell24aa`, `ell25aa`, `ell27aa`, `ell29aa`,
      `ell31aa`, `ell32aa`, `ell33aa`, `ell38aa`, `ell39aa`",
      "`ell1`, `ell2`, `ell3`, `ell7`,
      `ell12`, `ell13`, `ell15`, `ell17`, `ell18`,
      `ell19`, `ell23`, `ell26`, `ell28`, `ell30`,
      `ell34`, `ell35`, `ell36`, `ell37`"),
  scale_range = c("","","") #TODO fill in range 
  #alpha = c(round(eds_alpha$total$raw_alpha, 3))
)

# Create the gt table object
ell_scale_df <- gt(ell_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
             scale = "Scale (# of items)", 
             scale_construction = "Scale Construction",
             scale_range = "Range*",
             # alpha = "Alpha"
             ) %>% 
  tab_footnote(footnote = "*Range of possible values; `_r` Reverse scored variable") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  cols_width(scale ~ px(135)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_tbl_theme() 

# Print the table
print(ell_scale_df)


```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item, total, and
subscale score:

```{r ell-mean-items}
# Calculate the summary statistics for each variable
# ell_summary_data <- lapply(ell, function(x) {
#   mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
#   sd_val <- round(sd(x, na.rm = TRUE), 2)
#   range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
#   miss_val <- round(mean(is.na(x)) * 100, 2)
#   c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
# })
# 
# # Convert summary_data to a data frame
# ell_summary_data <- as.data.frame(ell_summary_data)
# 
# # Set items as first row
# ell_summary_data <- rbind(names(ell_summary_data), ell_summary_data) %>% 
#   t() %>% 
#   as.data.frame()
# 
# # Create the gt table
# ell_tbl <- ell_summary_data %>%
#   gt() %>%
#   cols_label(`1` = "Variable",
#              Range = "Range*",
#              Missing = "% Missing") %>% 
#   #cols_width(everything() ~ px(115)) %>%
#   tab_options(table.width = pct(100))%>%
#   cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
#   tab_footnote("*Range of data values") %>% 
#   tab_options(table.border.bottom.style = "hidden") %>%
#   apply_tbl_theme()
# 
# # Render the table
# ell_tbl

```

#### Distributions

Distributions are presented below for the total score and each subscale:

```{r ell-distributions, class.source='fold', echo = FALSE}
# ell_complete %>%
#   composite_hist(
#     x = ell_raw_total
#   ) +
#   labs(title = 'Distribution of Total Scores for \nElliott Self Delinquency Scale (Raw)')

# ell_complete %>%
#   composite_hist(
#     x = ell_censor_total
#   ) +
#   labs(title = 'Distribution of Total Scores for \nElliott Self Delinquency Scale (Censored)')
# 
# ell_count_complete %>%
#   composite_hist(
#     x = ell_count_total
#   ) +
#   labs(title = "Distribution of Total Scores for \nElliott Self Delinquency Scale (Binary Count Data)")
```

    

## Mental Health Contimuun - SF (MHC-SF)

### MHC Description

The MHC is a 14-item questionnaire designed to measure *insert*.

For the present study, 14 items from the MHC were collected in order to
#TODO: insert text here

No items need to be reverse scored. *TODO: need change text here Higher
scores indicate more severe mental health symptoms.*

The missing data rule was applied. 
## MIN CHECK missing data

Reference: [@keyes2009brief]
[@lamers2011evaluating](https://onlinelibrary.wiley.com/doi/abs/10.1002/jclp.20741);
[DOI](https://doi.org/10.1002/jclp.20741)

### MHC Variables

#### Value Labels

All MHC variables have the same response options.

```{r MHC-label-table, results = 'asis'}

mhc_label_df <- data.frame(
  value = c("0", "1", "2", "3", "4", "5"),
  label = c("Never",
            "Once or Twice",
            "About Once A Week",
            "About 2 or 3 Times A Week",
            "Almost Every Day",
            "Every Day")) %>% 
  t() %>% 
  as.data.frame()

mhc_label_df <- setNames(mhc_label_df[-1, ], unlist(mhc_label_df[1, ]))


#create table
mhc_label_table <- mhc_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ px(180)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(mhc_label_table)


```

#### Survey Items

MHC survey items are presented in the following table:

```{r mhc-var-prep}
# Pull question wording from qualtrics data
mhc_word <- qualtrics %>% 
  select(starts_with("h"))%>%
  slice(1)

#create table with variable name, description, and notes
# MIN need to make sure updated table with prefix mhc
mhc_word_long <- mhc_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name), 
         notes = as.character("")) 
```

```{r elf-var-table, results ='asis'}
# Create the gt table object and apply generic theme
mhc_gt_table <- gt(mhc_word_long)

# Table-specific formatting (col width, names)
mhc_gt_table <- mhc_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(mhc_gt_table)


```

#### Scale and Subscales

Information on the total score and subscale variables are below.
Variables were c onstructed by summing included items.

```{r mhc df, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
mhc_complete <-
  complete %>%
  select(
  #  id,

    matches("^mhc"), 
    mhc_total,mhc_pa,mhc_swb, mhc_pwb
  )

```


```{r mhc alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 
mhc_alpha <-
  mhc_complete %>%
  select(mhc1:mhc3) %>%
  psych::alpha(check.keys = TRUE)


mhc_pa_alpha <-
  mhc_complete %>%
  select(mhc1:mhc3) %>%
  psych::alpha(check.keys = TRUE)

# MIN check this alpha is greater than 1?
mhc_swb_alpha <-
  mhc_complete %>%
  select(mhc4:mhc8) %>%
  psych::alpha(check.keys = TRUE)

mhc_pwb_alpha <-
  mhc_complete %>%
  select(mhc9:mhc14) %>%
  psych::alpha(check.keys = TRUE)
```

```{r MHC-scale-table, results = 'asis'}
# Create the table as a data frame
mhc_scale_df <- data.frame(
  var_name = c("mhc_raw_total", "mhc_pa_total", "mhc_swb_total", "mhc_pwb_total"),
  scale = c("MHC Total score (14)", "Positive Affect (3)", "Social Well-being (4)", "Psychological well-being (6)"),
  scale_construction = c(" `mhc1`, `mhc2`, `mhc3`, `mhc4`, `mhc5`, `mhc6`, `mhc7`, `mhc8`, `mhc9`, `mhc10`, `mhc11`, `mhc12`, `mhc13`, `mhc14`",
                         "`mhc1`, `mhc2`,`mhc3`", "`mhc4`, `mhc5`, `mhc6`, `mhc7`, `mhc8`", "`mhc9`, `mhc10`, `mhc11`, `mhc12`, `mhc13`, `mhc14`"
                         ),
  scale_range = c(""), #TODO fill in range 
  alpha = c(round(mhc_alpha$total$raw_alpha, 3),
            round(mhc_pa_alpha$total$raw_alpha, 3),
            round(mhc_swb_alpha$total$raw_alpha, 3),
            round(mhc_pwb_alpha$total$raw_alpha, 3))
)

# Create the gt table object
mhc_scale_df <- gt(mhc_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
             scale = "Scale (# of items)", 
             scale_construction = "Scale Construction",
             scale_range = "Range*",
             # alpha = "Alpha"
             ) %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  cols_width(scale ~ px(135)) %>% 
  apply_tbl_theme() 

# Print the table
print(mhc_scale_df)


```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item, total, and
subscale score:

```{r mhc-mean-items}
# Calculate the summary statistics for each variable
mhc_summary_data <- lapply(mhc_complete, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
mhc_summary_data <- as.data.frame(mhc_summary_data)

# Set items as first row
mhc_summary_data <- rbind(names(mhc_summary_data), mhc_summary_data) %>% 
  t() %>% 
  as.data.frame()
# MIN check the missing % doesn't seem right
# Create the gt table
mhc_tbl <- mhc_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ px(115)) %>%
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
mhc_tbl

```

#### Distributions

Distributions are presented below for the total score and each subscale:

```{r mhc-distributions, class.source='fold', echo = FALSE}

p_mhc_total <- mhc_complete %>%
  composite_hist(
    x = mhc_total
  ) +
  labs(title = 'Total Scores')

p_mhc_swb <- mhc_complete %>%
  composite_hist(
    x = mhc_pa
  ) +
  labs(title = 'Positive Affect Subscale')

p_mhc_swb <- mhc_complete %>%
  composite_hist(
    x = mhc_swb
  ) +
  labs(title = 'Social Well-being Subscale')

p_mhc_pwb <- mhc_complete %>%
  composite_hist(
    x = mhc_pwb
  ) +
  labs(title = 'Psychological Well-being Subscale')

ggarrange(p_mhc_total, p_mhc_swb + rremove("ylab"), 
          p_mhc_swb, p_mhc_pwb + rremove("ylab")
          ) %>%
  annotate_figure(top = text_grob( "Distribution for MHC-SF total and subscale \n(x-axis and y-axis are in different scales)"))
```


## Flourishing Index (FI)

### FI Description

The Flourishing Index is a 12-item questionnaire designed to measure five domains of flourishing. The scale contains 2 items for each domain, including happiness and life satisfaction, mental and physical health, meaning and purpose, character and virtue, and close social relationships. There are also two items that represent "secure flourish" indicating financial and material stability, noted by the measure authors to help individuals sustain flourishing across other domains captured through the measure. 

  * Although not computed in our datafile, subscales based on the five domains can be computed. See the measure reference for more scoring details. 
  
  * No items need to be reverse scored. 
  
  * **Higher** scores indicate greater flourishing.

  * The missing data rule was applied. Calculations were completed for participants with 20% or less missing data (this includes -77 responses)

Reference:
[@vanderweele2017promotion](https://www.pnas.org/doi/abs/10.1073/pnas.1702996114)

### Flourishing Index Variables

#### Value Labels

All Flourishing Index variables have the same response options.

```{r flo-label-table, results = 'asis'}

flo_label_df <- data.frame(
  value = c("0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
  label = c("Not Satisfied At All","","","", "","","","","","","Completely Satisfied"),
  label2 = c("Extremely unhappy","","","", "","","","","","","Extremely Happy"),
  label3 = c("Poor","","","", "","","","","","","Excellent"),
  label4 = c("Not at all worthwhile","","","", "","","","","","","Completely Worthwhile"),
  label5 = c("Strongly Disagree","","","", "","","","","","","Strongly Agree"),
  label6 = c("Not true of me","","","", "","","","","","","Completely true of me"),
  label7 = c("Worry all of the time","","","", "","","","","","","Do not ever worry")
  ) %>% 
  t() %>% 
  as.data.frame()

flo_label_df <- setNames(flo_label_df[-1, ], unlist(flo_label_df[1, ]))


#create table
flo_label_table <- flo_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ px(180)) %>%
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()


# Print the table
print(flo_label_table)


```
#### Survey Items

ALL Flourishing Index variables have the same response options.

```{r flo-var-prep}
# Pull question wording from qualtrics data
flo_word <- qualtrics %>% 
  select(I1:I12)%>%
  slice(1)

#create table with variable name, description, and notes
# MIN #TODO make sure that these have prefix "flo" instead of i
flo_word_long <- flo_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name), 
         notes = as.character("")) %>% 
  slice(1:12)
```

```{r flo-var-table, results ='asis'}
# Create the gt table object and apply generic theme
flo_gt_table <- gt(flo_word_long)

# Table-specific formatting (col width, names)
flo_gt_table <- flo_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(flo_gt_table)


```

#### Scale and Subscales

Information on the total score is below.
Variables were constructed by summing included items.
```{r  flo, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
flo_complete <- complete %>%
  select(flo1:flo12, flo_total)
```

```{r flo alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 
flo_alpha <- flo_complete %>% 
  select(flo1:flo12) %>% 
  psych::alpha(check.keys = TRUE)
```

```{r flo-scale-table, results = 'asis'}
# Create the table as a data frame
flo_scale_df <- data.frame(
  var_name = c("flo_total"),
  scale = c("FLO Total score (12)"),
  scale_construction = c(" `flo1`, `flo2`, `flo3`, `flo4`, `flo5`, `flo6`, `flo7`, `flo8`, `flo9`, `flo10`, `flo11`, `flo12`"),
  scale_range = c("0-120"), 
  alpha = c(round(flo_alpha$total$raw_alpha, 3))
)

# Create the gt table object
flo_scale_df <- gt(flo_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
             scale = "Scale (# of items)", 
             scale_construction = "Scale Construction",
             scale_range = "Range*",
             # alpha = "Alpha"
             ) %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  cols_width(scale ~ px(135)) %>% 
  apply_tbl_theme() 

# Print the table
print(flo_scale_df)


```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item and the total score:

```{r flo-mean-items}
# Calculate the summary statistics for each variable
flo_summary_data <- lapply(flo_complete, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
flo_summary_data <- as.data.frame(flo_summary_data)

# Set items as first row
flo_summary_data <- rbind(names(flo_summary_data), flo_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
flo_tbl <- flo_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
flo_tbl

```

#### Distributions


```{r flo-distributions, class.source='fold', echo = FALSE}
flo_complete %>%
  composite_hist(
    x = flo_total
  ) +
  labs(title = 'Distribution of Total Scores for Flourishing Index')
```



## International Trauma Questionnaire - ITQ

### ITQ Description

The ITQ is a 9-item questionnaire designed to measure *insert*.

For the present study, 9 items from the ITQ were collected in order to
#TODO: insert text here

No items need to be reverse scored. *TODO: need change text here Higher
scores indicate more severe mental health symptoms.*

The missing data rule was applied. Calculations were completed for
participants with 33% or less missing data (this includes -77 responses)

Reference:
[@cloitre2018international](https://onlinelibrary.wiley.com/doi/full/10.1111/acps.12956?casa_token=K4GIoIIYOkwAAAAA%3ABuaGU3cOQZwsFiM78FxHp_PHTQXDc72xABnVp8nlMCYRCHzf4c0oOMropyrzVjdClA3pFA-m01heootZ);
[DOI](https://doi.org/10.1111/acps.12956)

### ITQ Variables

#### Value Labels

All ITQ variables have the same response options.

```{r itq-label-table, results = 'asis'}
itq_label_df <- data.frame(
  value = c("0", "1", "2", "3", "4"),
  label = c("Not at All",
            "A Little Bit",
            "Moderately",
            "Quite a Bit",
            "Extremely")) %>% 
  t() %>% 
  as.data.frame()

itq_label_df <- setNames(itq_label_df[-1, ], unlist(itq_label_df[1, ]))


#create table
itq_label_table <- itq_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(itq_label_table)


```

#### Survey Items

All ITQ variables have the same response options.

```{r itq-var-prep}
# Pull question wording from qualtrics data
itq_word <- qualtrics %>% 
  select(starts_with("itq"))%>%
  slice(1)

#create table with variable name, description, and notes
itq_word_long <- itq_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name), 
         notes = as.character("")) %>% 
  slice(1:9)
```

```{r itq-var-table, results ='asis'}
# Create the gt table object and apply generic theme
itq_gt_table <- gt(itq_word_long)

# Table-specific formatting (col width, names)
itq_gt_table <- itq_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
  tab_options(table.width = pct(100))%>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(itq_gt_table)


```

#### Scale and Subscales

Information on the total score and subscale variables are below.
Variables were constructed by summing included items.

```{r itq df, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
itq_complete <- complete %>%
  select(
    starts_with("itq") 
    )
```

```{r itq alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 
itq_alpha <- itq_complete %>% 
  select(itq1:itq9) %>% 
  psych::alpha(check.keys = TRUE)
```



```{r itq-scale-table, results = 'asis'}
# Create the table as a data frame
# MARIA TO DO SHIFT
itq_scale_df <- data.frame(
  var_name = c("Re-experiencing Subscale (2)", " Avoidance Subscale (2)", 
               "Thread Subscale (2)", "Functioninal Impairment (3)", "PTSD Total (6)"),
  scale = c("itq_re_total", "itq_av_total", "itq_th_total", "itq_fi_total", ""),
  scale_construction = c("`itq1`, `itq2`", "`itq3`, `itq4`", "`itq5`,`itq6`", 
                         "`itq1`, `itq2`, `itq3`, `itq4`, `itq5`,`itq6`", ""), # Maria, after you figure this out, please double check the scale construction 
  scale_range = c("","","","", ""), #TODO fill in range 
  alpha = c("","","","", "")
)

# Create the gt table object
itq_scale_df <- gt(itq_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
             scale = "Scale (# of items)", 
             scale_construction = "Scale Construction",
             scale_range = "Range*",
             # alpha = "Alpha"
             ) %>% 
  tab_footnote(footnote = "*Range of possible values; `_r` Reverse scored variable") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  cols_width(scale ~ px(135)) %>% 
  apply_tbl_theme() 

# Print the table
print(itq_scale_df)


```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item, total, and
subscale score:

```{r itq-mean-items}
# Calculate the summary statistics for each variable
itq_summary_data <- lapply(itq_complete, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
itq_summary_data <- as.data.frame(itq_summary_data)

# Set items as first row
itq_summary_data <- rbind(names(itq_summary_data), itq_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
itq_tbl <- itq_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
itq_tbl

```

#### Distributions

Distributions are presented below for the total score and each subscale:

```{r itq-distributions, class.source='fold', echo = FALSE}
# Maria, I'm comment out this section, so I can render, after we have the computation figured out we can work on this section
# p_itq_ad_total <- itq_complete %>%
#   composite_hist(
#     x = itq_ad_total,
#     bins = 15
#   ) +
#   labs(title = "Affective Dysregulation Subscale")
# 
# p_itq_nsc_total <- itq_complete %>%
#   composite_hist(
#     x = itq_nsc_total,
#     bins = 15
#   ) +
#   labs(title = "Negative Self-Concept Subscale")
# 
# p_itq_dr_total <- itq_complete %>%
#   composite_hist(
#     x = itq_dr_total,
#     bins = 15
#   ) +
#   labs(title = "Relationships Subscale")
# 
# 
# p_itq_dso <- itq_complete %>%
#   composite_hist(
#     x = itq_dso,
#     bins = 15
#   ) +
#   labs(title = "DSO Subscale")
# 
# ggarrange(p_itq_ad_total, p_itq_nsc_total + rremove("ylab"),
#           p_itq_dr_total, p_itq_dso + rremove("ylab")
#           ) %>%
#   annotate_figure(top = text_grob( "Distribution for ITQ Subscale \n(x-axis and y-axis are in different scales)"))

```


## IBQ

### IBQ Description

The IBQis a 10-item questionnaire designed to measure *insert*.

For the present study, 10 items from the IBQ were collected in order to
#TODO: insert text here

No items need to be reverse scored. *TODO: need change text here Higher
scores indicate more severe mental health symptoms.*

The missing data rule was applied. Calculations were completed for
participants with 20% or less missing data (this includes -77 responses)

Reference:
<TODO: Maria, please add reference> 

### IBQ Variables

#### Value Labels

IBQ variables response options for ibp1 - ibq9.

```{r ibq-label-table, results = 'asis'}
ibq_label_df <- data.frame(
  value = c("0", "1"),
  label = c("No",
            "Yes")) %>% 
  t() %>% 
  as.data.frame()

ibq_label_df <- setNames(ibq_label_df[-1, ], unlist(ibq_label_df[1, ]))


#create table
ibq_label_table <- ibq_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(ibq_label_table)
```

<TODO: Maria, Please review this table>
```{r ibq-label-table2, results = 'asis'}
ibq_label_df2 <- data.frame(
  #value = c("0", "1"),
  label = c("School/University/College",
            "Juvenile Justice",
            "Legal System",
            "Police",
            "Medical or Mental Health Clinic",
            "Church",
            "Foster Care",
            "Child Welfare",
            "Other, please describe:",
            "Decline to Answer")) %>% 
  t() %>% 
  as.data.frame()


ibq_label_df2 <- setNames(ibq_label_df2[-1, ], unlist(ibq_label_df2[1, ]))


#create table
ibq_label_table2 <- ibq_label_df2 %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(ibq_label_table2)
```

#### Survey Items

All IBQ variables have the same response options.

```{r ibq-var-prep}
# Pull question wording from qualtrics data
ibq_word <- qualtrics %>% 
  select(starts_with("ibq"))%>%
  slice(1)

#create table with variable name, description, and notes
ibq_word_long <- ibq_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name), 
         notes = as.character("")) %>%
  mutate(description = if_else(var_name == "ibq10", "Please indicate all types of institutions involved.", description)) %>%
  slice(1:10)
```

```{r ibq-var-table, results ='asis'}
# Create the gt table object and apply generic theme
ibq_gt_table <- gt(ibq_word_long)

# Table-specific formatting (col width, names)
ibq_gt_table <- ibq_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
  tab_options(table.width = pct(100))%>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(ibq_gt_table)


```

#### Scale and Subscales

Information on the total score and subscale variables are below.
Variables were constructed by summing included items.

```{r ibq df, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
ibq_complete <- complete %>%
  select(
    starts_with("ibq") 
    )
```

```{r ibq alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#No internal reliability calculated for this measure per type of measure

```



```{r ibq-scale-table, results = 'asis'}
# Create the table as a data frame
ibq_scale_df <- data.frame(
  var_name = c("IBQ Total Score(7)"),
  scale = c("ibq_total"),
  scale_construction = c("`ibq1`, `ibq2`, `ibq3`, `ibq4`, `ibq5`,`ibq6`, `ibp7`"),
  scale_range = c("0-7") #TODO fill in range 
)

# Create the gt table object
ibq_scale_df <- gt(ibq_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
             scale = "Scale (# of items)", 
             scale_construction = "Scale Construction",
             scale_range = "Range*"
             ) %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  cols_width(scale ~ px(135)) %>% 
  apply_tbl_theme() 

# Print the table
print(ibq_scale_df)


```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item, total, and
subscale score:
<TODO: Maria: please review this table and see if there are anything you want me remove from this table>
```{r ibq-mean-items}
# Calculate the summary statistics for each variable
ibq_summary_data <- lapply(ibq_complete, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
ibq_summary_data <- as.data.frame(ibq_summary_data)

# Set items as first row
ibq_summary_data <- rbind(names(ibq_summary_data), ibq_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
ibq_tbl <- ibq_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
ibq_tbl

```

#### Distributions

Distributions are presented below for the total score and each subscale:

```{r ibq-distributions, class.source='fold', echo = FALSE}
ibq_complete %>%
  filter(ibq10 >= 0) %>%
  composite_hist(
    x = ibq10, 
    bins = 15
  ) +
  labs(title = "Distribution for IBQ Total Score")

```


# CINT-SOCIODEMS 
   <MARIA: you might want to switch this to full name to be consistent with other measure.> 

## <Maria, I wasn't sure what's the full name is>  (CINT-SOCIODEMS)

### CINT-SOCIODEMS Description

<MARIA> please insert a breif description for this measure 


  * No items need to be reverse scored. 

  * This is not a a standardized questionnaire, so missing data rule was not applied. And no sub scale was computed. 



Reference:
 <Maria, please add a reference if needed> 

### CINT-SOCIODEMS Variables

#### Value Labels and Survey Items 

All CINT-SOCIODEMS variables have multiple responses options, value labels for each variable can be found in the survey items table below. 

CINT-SOCIODEMS survey items are presented in the following table:


```{r CINT-SOCIODEMS-var-prep}
# Pull question wording from Qualtrics data
cint_sociodems_word <- qualtrics %>% 
  select(`CINTPregnancy Screen`: `CINT Income Support`, CINTIdentity, CINTIdentity_8_TEXT) %>%
  # Maria, we might want to add comment here to explain these two options 
  mutate(cint1_choice1 = CINT1) %>%
  rename(cint1_choice2 = CINT1) %>%
  relocate(cint1_choice1, .after = `CINT-0`) %>%
  slice(1)

#create table with variable name, description, and notes
cint_sociodems_word_long <- cint_sociodems_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = str_replace(description, "READ:", ""),
         description = str_replace(description, "DO NOT READ THE FOLLOWING TEXT ALOUD", ""),
         var_name = str_to_lower(var_name),
         value = case_when(row_number() %in% c(1,6,7,8,9) ~ "1 = Yes, 
                                             \n0 = No",
                           row_number() %in% c(2) ~ "1 = 1. 8th grade or less or working towards GED
                                            \n 2 = 2. Completed GED/Alternative H.S. diploma
                                            \n 3 = 3. Completed some high school, but did not graduate
                                            \n 4 = 4. Graduated high school
                                            \n 5 = 5. Taking/have taken community college classes or working toward Associates Degree
                                            \n 6 = 6. Completed/obtained an Associate's Degree
                                            \n 7 = 7. Taking/have taken vocational classes or working toward Vocational Training
                                            \n 8 = 8. Completed Vocational Training
                                            \n 9 = 9. Taking/have taken 4 yr college classes or working toward 4 year college degree
                                            \n 10 = 10. Completed 4 year college degree
                                            \n 11 = 11. Taking/have taken graduate classes or working toward post-college degree
                                            \n 12 = 12. Completed post-college degree
                                            \n -77 = Decline to Answer",
                           row_number() %in% c(3,4) ~ "1 = 1. Currently Working
                                            \n 2 = 2. Temporarily laid off
                                            \n 3 = 3. On Leave
                                            \n 4 = 4. Unemployed or looking for work
                                            \n 5 = 5. Retired
                                            \n 6 = 6. Disabled, permanently or temporarily
                                            \n 7 = 7. Student
                                            \n 8 = 8. Something else, please briefly describe
                                            \n -77 = Decline to Answer",
                           row_number() %in% c(10) ~ "1 = 1. Always or almost always
                                            \n 2 = 2. Often
                                            \n 3 = 3. About half the time
                                            \n 4 = 4. Occasionally
                                            \n 5 = 5. Never or almost never
                                            \n 6 = 8. N/A, no bills to pay
                                            \n -77 = Decline to Answer", 
                           row_number() %in% c(11) ~ "1 = 1. Always or almost always
                                            \n 2 = 2. Often
                                            \n 3 = 3. About half the time
                                            \n 4 = 4. Occasionally
                                            \n 5 = 5. Never or almost never
                                            \n -77 = Decline to Answer", 
                           row_number() %in% c(14) ~ "1 = Cisgender female or woman
                                            \n 2 = Cisgender male or man
                                            \n 3 = Female/Woman
                                            \n 4 = Male/Man
                                            \n 5 = Trans female/woman
                                            \n 6 = Trans male/man
                                            \n 7 = Non-binary
                                            \n 8 = Prefer to self-identify
                                            \n -77 = Decline to Answer")
         ) %>% 
# Edits Variable description and value
  mutate(description = if_else(var_name == "cint-0", "I have some questions about your school and work experiences. What is the highest level of education you have completed?", description)) %>%
  mutate(description = if_else(var_name == "cint1", "What is your current employment status? (Indicate all that apply)", description)) %>%
  mutate(description = if_else(var_name == "cint18", "During the past 6 months, how often have you had enough money to pay your bills/make your payments?", description)) %>%
  mutate(description = if_else(var_name == "cint-income", "What is your annual (gross) household income?", description)) %>%
  mutate(description = if_else(var_name == "cint income support", "How many people does that income support?", description)) %>%
  mutate(description = if_else(var_name == "cintpregnancy screen", "Has TC reported that she is currently pregnant?", description)) %>%
  mutate(value = if_else(var_name == "cint1_8_text", "Open Text Entry", value)) %>%
  mutate(value = if_else(var_name == "cint-income", "Open Text Entry", value)) %>%
  mutate(value = if_else(var_name == "cint income support", "Open Text Entry", value)) %>%
  mutate(value = if_else(var_name == "cintidentity_8_text", "Open Text Entry", value)) %>%
  rename(`Value` = value )
```

```{r cint_sociodems-var-table, results ='asis'}
# Create the gt table object and apply generic theme
cint_sociodems_gt_table <- gt(cint_sociodems_word_long)

# Table-specific formatting (col width, names)
cint_sociodems_gt_table <- cint_sociodems_gt_table %>% 
  cols_label(var_name = "Variable", 
            description = "Description"
            #notes = "Notes"
            ) %>% 
  apply_tbl_theme() %>% 
  cols_width(description ~ px(300),
             var_name ~ px(100)
             ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(cint_sociodems_gt_table)
```
### Summary Statistics

#### Descriptive Statistics

Only missing percentage are presented 
  
```{r cint_socio-missing}
# Create subset of BSI items
cint_socio_data_subset <- complete %>%
  select(cint_pregnancy_screen:cint_income_support, cint_identity)

# Calculate the summary statistics for each variable
## mean is showing 2 decimals per authors
cint_socio_summary_data <- lapply(cint_socio_data_subset, function(x) {
  x <- replace(x, x < -40, NA)
  # mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  # sd_val <- round(sd(x, na.rm = TRUE), 2)
  # range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
   miss_val <- round(mean(is.na(x)) * 100, 2)
  # c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
  c(Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
cint_socio_summary_data <- as.data.frame(cint_socio_summary_data)

# Set items as first row
cint_socio_summary_data <- rbind(names(cint_socio_summary_data), cint_socio_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
cint_socio_tbl <- cint_socio_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Missing = "% Missing") %>% 
  # cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Missing"), align = "left") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
cint_socio_tbl

```

# CINT-LADDER
<MARIA: you might want to switch this to full name to be consistent with other measure.> 
  
  
### CINT-LADDER Description
  
  <MARIA> please insert a breif description for this measure 


* No items need to be reverse scored. 

* This is not a a standardized questionnaire, so missing data rule was not applied. And no subscale was computed. 



Reference:
  <Maria, please add a reference if needed> 
  
### CINT-LADDER Variables
  
#### Value Labels and Survey Items 
  
  All CINT-LADDER variables use 1-10 as respose from losest of the ladder to highest of the ladder. 
  <Maria, you might want place a visual here> 

CINT-LADDER survey items are presented in the following table:

  
```{r CINT-LADDER-var-prep}
# Pull question wording from Qualtrics data
cint_ladder_word <- qualtrics %>% 
  select(`CINT-Ladder1`, `CINT-Ladder2`) %>%
  slice(1)

#create table with variable name, description, and notes
cint_ladder_word_long <- cint_ladder_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name)) %>%
  # Edits Variable description and value
  mutate(description = if_else(var_name == "cint-ladder1", "L1. Think of this ladder as representing where people stand in the United States. 
                               At the top of the ladder are the people who are the best off â€” those who have the most money, the most education, 
                               and the most respected jobs. At the bottom are the people who are the worst off â€“ who have the least money, least 
                               education, and the least respected jobs or no job. The higher up you are on this ladder, the closer you are to the 
                               people at the very top; the lower you are, the closer you are to the people at the very bottom. Where would you 
                               place yourself on the ladder? Please take a moment to pick a rung where you think you stand at this time in your life, 
                               relative to other people in the United States. \nNow count starting from the bottom of the ladder to the top. 
                               Which number of rung did you place yourself on?", description)) %>%
  mutate(description = if_else(var_name == "cint-ladder2", "L2. Think of this ladder as representing where people stand in their communities. 
                               People define community in different ways; please define it in whatever way is most meaningful to you. At the top 
                               of the ladder are the people who have the highest standing in their community. At the bottom are the people who 
                               have the lowest standing in their community. Where would you place yourself on this ladder. Please take a moment 
                               to pick a rung where you think you stand at this time in your life, relative to other people in your community. 
                               \n Now count starting from the bottom of the ladder to the top. Which number of rung did you place yourself on?", description))

 
```

```{r cint_ladder-var-table, results ='asis'}
# Create the gt table object and apply generic theme
cint_ladder_gt_table <- gt(cint_ladder_word_long)

# Table-specific formatting (col width, names)
cint_ladder_gt_table <- cint_ladder_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description"
             #notes = "Notes"
  ) %>% 
  apply_tbl_theme() %>% 
  cols_width(description ~ px(300),
             var_name ~ px(100)
  ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(cint_ladder_gt_table)
```


### Summary Statistics

#### Descriptive Statistics

Only missing percentage are presented 

```{r cint_ladder-missing}
# Create subset of BSI items
cint_ladder_data_subset <- complete %>%
  select(cint_pregnancy_screen:cint_income_support, cint_identity)

# Calculate the summary statistics for each variable
## mean is showing 2 decimals per authors
cint_ladder_summary_data <- lapply(cint_ladder_data_subset, function(x) {
  x <- replace(x, x < -40, NA)
  # mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  # sd_val <- round(sd(x, na.rm = TRUE), 2)
  # range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
   miss_val <- round(mean(is.na(x)) * 100, 2)
  # c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
  c(Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
cint_ladder_summary_data <- as.data.frame(cint_ladder_summary_data)

# Set items as first row
cint_ladder_summary_data <- rbind(names(cint_ladder_summary_data), cint_ladder_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
cint_ladder_tbl <- cint_ladder_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Missing = "% Missing") %>% 
  # cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Missing"), align = "left") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
cint_ladder_tbl

```

# CINT-Relation
<MARIA: you might want to switch this to full name to be consistent with other measure.> 
  
  
### CINT-Relation Description
  
  <MARIA> please insert a breif description for this measure 


* No items need to be reverse scored. 

* This is not a a standardized questionnaire, so missing data rule was not applied. And no subscale was computed. 



Reference:
  <Maria, please add a reference if needed> 
  
### CINT-Relation Variables
  
#### Value Labels and Survey Items 
  
  All CINT-Relation variables have multiple responses options, value labels for each variable can be found in the survey items table below. 

CINT-Relation survey items are presented in the following table:
  
  
```{r CINT-relation-var-prep}
# Pull question wording from Qualtrics data
cint_relation_word <- qualtrics %>% 
  select(`CINT20`: `CINT37`) %>%
  slice(1)

#create table with variable name, description, and notes
cint_relation_word_long <- cint_relation_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = str_replace(description, "READ:", ""),
         #description = str_replace(description, "Assessor Note: Assessor give them a few moments to decide.", "\n"),
         var_name = str_to_lower(var_name)) %>% 
  # Edits Variable description and value
  mutate(description = if_else(var_name == "cint20", " How many people in total have you been involved with romantically or 
                               sexually in the last 6 months (including current or any others)?", description)) %>%
  mutate(description = if_else(var_name == "cintq2", "Please think about the longest or most serious relationship 
                               over the past 6 months. How old was that partner?", description)) %>%
  mutate(description = if_else(var_name == "cintq3", "What was your relationship with that partner?", description)) %>% 
  mutate(description = if_else(var_name == "cint27", "On a scale of 1 to 10, with 1 being not at all well and 10 being 
                               very well, how well did you and your partner get along in the last 6 months 
                               (when seeing/dating your partner)?", description)) %>% 
  mutate(description = if_else(var_name == "cint27", "On a scale of 1 to 10, with 1 being not at all well and 10 being 
                               very well, how well did you and your partner get along in the last 6 months 
                               (when seeing/dating your partner)?", description)) %>% 
   mutate(description = if_else(var_name == "cint30", "How would you describe the way your partner drinks alcohol, 
                                on average, in the past 6 months?", description)) %>%    
    mutate(description = if_else(var_name == "cint30_7_text", "How would you describe the way your partner drinks 
                                 alcohol, on average, in the past 6 months? - 7. Other: (Specify) - Text?", description)) %>%     
    mutate(description = if_else(var_name == "cint31", "How would you describe the way your partner smokes pot, on average, 
                                 in the past 6 months?", description)) %>%     
    mutate(description = if_else(var_name == "cint31_7_text", "How would you describe the way your partner smokes pot, 
                                 on average, in the past 6 months? - 7. Other: (Specify) - Text", description)) %>%
    mutate(description = if_else(var_name == "cint31_7_text", "How would you describe the way your partner uses hard drugs, 
                                 on average, in the past 6 months? ", description)) %>%    
    mutate(description = if_else(var_name == "cint32_7_text", "How would you describe the way your partner uses hard drugs, 
                                 on average, in the past 6 months? - 7. Other: (Specify) - Text", description)) %>%    
    mutate(description = if_else(var_name == "cint33", "What is the highest level of school your partner has finished so far?", description)) %>%  
    mutate(description = if_else(var_name == "cint34", "On a scale of 1-10, with 1 being not at all supportive and 10 being very supportive, 
                                 how emotionally supportive is/was your partner of you in the last 6 months?", description)) %>%
    mutate(description = if_else(var_name == "cint35", "Now, I'd like to ask you about friends and other support in your life. 
                                 About how many close friends do you have?", description)) %>%
    mutate(description = if_else(var_name == "cint36", "Thinking about your life in the past 6 months, on average, how many days a week do 
                                 you currently get together socially with your friends outside of school or work?", description)) %>%
      mutate(description = if_else(var_name == "cint37", "Now, please think about all of your friends (all genders). Have any of your 
                                   friends been arrested in the last 6 months?", description)) %>%
    mutate(`Lable Value` = "")%>%
    mutate(`Lable Value` = if_else(var_name %in% c("cint28", "cint29", "cint37"), "1 = Yes
                                                                                   \n 0 = No
                                                                                   \n -66 = Don't Know
                                                                                   \n -77  = Decline to Answer", `Lable Value`)) %>%
    mutate(`Lable Value` = if_else(var_name %in% c( "cint20", "cintq2", "cint12", "cint30_7_text", "cint31_7_text", "cint32_7_text"), "Open Text Entry", `Lable Value`)) %>%
    mutate(`Lable Value` = if_else(var_name %in% c("cintq3"), "1 = 1. Married
                                                               \n 2 = 2. Living together
                                                               \n 3 = 3. Dating or seeing each other, but not living together. This includes casual dating.
                                                               \n 4 = 4. Married, but separated
                                                               \n -77 = 5. Decline to Answer", `Lable Value`)) %>%
      mutate(`Lable Value` = if_else(var_name %in% c("cint26"), "1 = 1 - Not at all close
                                                                 \n 2 = 2
                                                                 \n 3 = 3
                                                                 \n 4 = 4
                                                                 \n 5 = 5
                                                                 \n 6 = 6
                                                                 \n 7 = 7
                                                                 \n 8 = 8
                                                                 \n 9 = 9
                                                                 \n 10 = 10 - Extremely Close
                                                                 \n -77 = Decline to Answer", `Lable Value`)) %>%
      mutate(`Lable Value` = if_else(var_name %in% c("cint27"), "1 = 1 - Not at all well
                                                                 \n 2 = 2
                                                                 \n 3 = 3
                                                                 \n 4 = 4
                                                                 \n 5 = 5
                                                                 \n 6 = 6
                                                                 \n 7 = 7
                                                                 \n 8 = 8
                                                                 \n 9 = 9
                                                                 \n 10 = 10 - Very Well
                                                                 \n -77 = Decline to Answer", `Lable Value`)) %>%
      mutate(`Lable Value` = if_else(var_name %in% c("cint30"), "0 = 1. Never
                                                                 1 = 2. Drank alcohol only a few times during the year
                                                                 \n 2 = 3. Drinks regularly for a few weeks or more, then doesn't for a few weeks or more or drinks, then stops drinking (ex: became clean and sober)
                                                                 \n 3 = 4. Drinks about once a month
                                                                 \n 4 = 5. Drinks on weekends or mostly on weekends
                                                                 \n 5 = 6. Drinks daily or almost daily
                                                                 \n 6 = 7. Other: (Specify)
                                                                 \n -66 = 8. Don't know
                                                                 \n -77 = Decline to Answer", `Lable Value`)) %>%
      mutate(`Lable Value` = if_else(var_name %in% c("cint31"), "0 = 1. Never
                                                              \n 1 = 2. Smoked only a few times during the year
                                                              \n 2 = 3. Smokes regularly for a few weeks or more, then doesn't for a few weeks or more or used, then stopped (ex: became clean and sober)
                                                              \n 3 = 4. Smokes about once a month
                                                              \n 4 = 5. Smokes on weekends or mostly on weekends or a few times a week
                                                              \n 5 = 6. Smokes daily or almost daily
                                                              \n 6 = 7. Other: (Specify)
                                                              \n -66 = 8. Don't know
                                                              \n -77 = Decline to Answer" , `Lable Value`)) %>%
     mutate(`Lable Value` = if_else(var_name %in% c("cint32"), "0 = 1. Never
                                                              \n 1 = 2. Used hard drugs a limited number of times
                                                              \n 2 = 3. Uses drugs regularly for a few weeks or more, then don't for a few weeks or more, or used, then stopped (ex: became clean and sober)
                                                              \n 3 = 4. Uses drugs about once a month
                                                              \n 4 = 5. Uses hard drugs on weekends or mostly on weekends or a few times a week
                                                              \n 5 = 6. Uses hard drugs daily or almost daily
                                                              \n 6 = 7. Other: (Specify)
                                                              \n -66 = 8. Don't know
                                                              \n -77 = Decline to Answer", `Lable Value`)) %>%
     mutate(`Lable Value` = if_else(var_name %in% c("cint33"), "1 = 1. Any grade up to the 12th grade, but not having a High School Diploma/GED
                                                             \n 2 = 2. GED or Equivalency
                                                             \n 3 = 3. High School Diploma
                                                             \n 4 = 4. Attended Community College but no A.A.(Associates) degree
                                                             \n 5 = 5. Community College degree, (A.A.)
                                                             \n 6 = 6. Attended 4 year University or College, but no degree
                                                             \n 7 = 7. B.A., B.S., BSN degree
                                                             \n 8 = 8. Graduate degree (MA, MS, PhD)
                                                             \n 9 = 9. Other (Technical, Vocational school)
                                                             \n -66 = 10. Don't know
                                                             \n -77 = Decline to Answer" , `Lable Value`)) %>%
       mutate(`Lable Value` = if_else(var_name %in% c("cint34"), "1 = 1 (Not at all Supportive)
                                                                 \n 2 = 2
                                                                 \n 3 = 3
                                                                 \n 4 = 4
                                                                 \n 5 = 5
                                                                 \n 6 = 6
                                                                 \n 7 = 7
                                                                 \n 8 = 8
                                                                 \n 9 = 9
                                                                 \n 10 = 10 (Very Supportive)
                                                                 \n -77 = Decline to Answer" , `Lable Value`)) %>%
         mutate(`Lable Value` = if_else(var_name %in% c("cint35"), "0 = 1. None
                                                                 \n 1 = 2. One
                                                                 \n 2 = 3. Two or three
                                                                 \n 3 = 4. Four or more
                                                                 \n -77 = Decline to Answer" , `Lable Value`)) %>%
           mutate(`Lable Value` = if_else(var_name %in% c("cint36"), "0 = 1. Never
                                                                 \n 1 = 2. Less than once a week
                                                                 \n 2 = 3. One
                                                                 \n 3 = 4. Two or three
                                                                 \n 4 = 5. Four or five
                                                                 \n 5 = 6. Six or seven
                                                                 \n 6 = 7. N/A, current living situation/setting provides no opportunity for socialization ( if says she is in a locked setting)
                                                                 \n -77 = Decline to Answer" , `Lable Value`))
  
  
```

```{r cint_relation-var-table, results ='asis'}
# Create the gt table object and apply generic theme
cint_relation_gt_table <- gt(cint_relation_word_long)

# Table-specific formatting (col width, names)
cint_relation_gt_table <- cint_relation_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description"
             #notes = "Notes"
  ) %>% 
  apply_tbl_theme() %>% 
  cols_width(description ~ px(300),
             var_name ~ px(100)
  ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(cint_relation_gt_table)
```


### Summary Statistics

#### Descriptive Statistics

Only missing percentage are presented 

```{r cint_relation-missing}
# Create subset of BSI items
cint_relation_data_subset <- complete %>%
  select(cint_pregnancy_screen:cint_income_support, cint_identity)

# Calculate the summary statistics for each variable
## mean is showing 2 decimals per authors
cint_relation_summary_data <- lapply(cint_relation_data_subset, function(x) {
  x <- replace(x, x < -40, NA)
  # mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  # sd_val <- round(sd(x, na.rm = TRUE), 2)
  # range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
   miss_val <- round(mean(is.na(x)) * 100, 2)
  # c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
  c(Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
cint_relation_summary_data <- as.data.frame(cint_relation_summary_data)

# Set items as first row
cint_relation_summary_data <- rbind(names(cint_relation_summary_data), cint_relation_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
cint_relation_tbl <- cint_relation_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Missing = "% Missing") %>% 
  # cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Missing"), align = "left") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
cint_relation_tbl

```

# CINT-SUBSTANCE
<MARIA: you might want to switch this to full name to be consistent with other measure.> 
  
  
### CINT-S Description
  
  <MARIA> please insert a breif description for this measure 


* No items need to be reverse scored. 

* This is not a a standardized questionnaire, so missing data rule was not applied. And no subscale was computed. 

This survey was not administered for participants who were incarcerated at the time of the assessment.



Reference:
  <Maria, please add a reference if needed> 
  
### CINT-SUBSTANCE Variables
  
#### Value Labels and Survey Items 
  
  All CINT-SUBSTANCE variables have multiple responses options, value labels for each variable can be found in the survey items table below. 

CINT-SUBSTANCE survey items are presented in the following table:
  
  
```{r CINT-substance-var-prep}
# Pull question wording from Qualtrics data
cint_substance_word <- qualtrics %>% 
  select(`CINTPregnancy Screen`, `CINT39`: `CINT84`) %>%
  slice(1)

#create table with variable name, description, and notes
cint_substance_word_long <- cint_substance_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = str_replace(description, "READ:", ""),
         description = str_replace(description, "DO NOT READ THE FOLLOWING TEXT ALOUD", "\n"),
         var_name = str_to_lower(var_name)) %>%
  # Edits Variable description and value
  mutate(description = if_else(var_name == "cint40", "How many days have you smoked cigarettes in the past 6 months? _____ Days", description)) %>%
  mutate(description = if_else(var_name == "cint42", "On average, how many cigarettes did you smoke a day in the past 6 months? _______ Cigarettes", description)) %>%
  mutate(description = if_else(var_name == "cint44", "How many days did you drink beer, wine or hard liquor in the last six months? _________ Days", description)) %>% 
  mutate(description = if_else(var_name == "cint46", "When you drank alcohol, did you usually get drunk?", description)) %>% 
  mutate(description = if_else(var_name == "cint47", "How would you describe the way you drank alcohol over the past 6 months? - Selected Choice", description)) %>% 
    mutate(description = if_else(var_name == "cint47_6_text", "How would you describe the way you drank alcohol over the past 6 months? - 6. Other: Specify - Text", description)) %>%     
    mutate(description = if_else(var_name == "cint31", "How would you describe the way your partner smokes pot, on average, 
                                 in the past 6 months?", description)) %>%     
    mutate(description = if_else(var_name == "cint48", "Thinking about all types of alcohol, like beer, wine, or hard liquor, how many drinks have you usually 
                                 had at one time in the past 6 months? _______ Drinks in the past 6 months", description)) %>%
    mutate(description = if_else(var_name == "cint49", "About how much time would you usually take to drink that? ______ Mins", description)) %>%    
    mutate(description = if_else(var_name == "cint51", "What is the largest number of drinks you have had (the most drinks you have had), on at least 2 
                                 different days or occasions in the last 6 months? ______ Drinks", description)) %>%    
    mutate(description = if_else(var_name == "cint53", "How long does it usually take you to drink that amount? _________ Mins", description)) %>%  
    mutate(description = if_else(var_name == "cint59", "How many times have you smoked pot in the last 6 months? _______ Times", description)) %>%
    mutate(description = if_else(var_name == "cint61", "When you have smoked pot in the last 6 months, how high have you gotten?", description)) %>%
    mutate(description = if_else(var_name == "cint62", "How would you describe the way you smoked pot over the last 6 months? - Selected Choice", description)) %>%
  mutate(description = if_else(var_name == "cint62_6_text", "How would you describe the way you smoked pot over the last 6 months? - 6. Other - Text", description)) %>%  
  mutate(description = if_else(var_name == "cint78", "Have you used prescription drugs, such as antidepressants, steroids, mood stabilizers, antibiotics, 
                               birth control, muscle relaxers, or allergy medications, in the past 6 months?", description)) %>%
  mutate(description = if_else(var_name == "cint84", "With whom did you share needles? (Indicate all that apply)", description)) %>%
  mutate(`Value` = "") %>%
  mutate(`Value` = if_else(var_name %in% c("cintpregnancy screen", "cint39", "cint41", "cint43", "cint45", "cint50", "cint54",
                                           "cint56", "cint58", "cint60", "cint63", "cint64","cint65", "cint66", 
                                           "cint68", "cint70", "cint72", "cint74", "cint76", "cint78", "cint80", "cint82"), "1 = Yes
                                                                                   \n 0 = No
                                                                                   \n -66 = Don't Know
                                                                                   \n -77  = Decline to Answer", `Value`)) %>%
      mutate(`Value` = if_else(var_name %in% c( "cint40", "cint42", "cint44", "cint47_6_text", "cint48", "cint49", "cint51", "cint52", "cint53", 
                                                "cint55", "cint57", "cint59", "cint62_6_text", "cint67", "cint69", "cint71", "cint73", "cint75" , 
                                                "cint77", "cint79", "cint81", "cint83"), "Open Text Entry", `Value`)) %>%
      mutate(`Value` = if_else(var_name %in% c( "cint46"), "0 = 1. Not at all
        1 = 2. A little drunk
        2 = 3. Quite drunk
        3 = 4. Very drunk
      -77 = Decline to Answer", `Value`)) %>%
      mutate(`Value` = if_else(var_name %in% c( "cint47"), "1 = 1. Drank alcohol only a few times during the past 6 months (up to 5 times)
        2 = 2. Drink regularly for a few weeks or more, then don't for a few weeks or more or drank for a period and then stopped altogether
        3 = 3. Drink about once a month
        4 = 4. Drink on weekends or mostly weekends or a few times a week
        5 = 5. Drink daily or almost daily
        6 = 6. Other: Specify
        -77 = Decline to Answer", `Value`)) %>%
       mutate(`Value` = if_else(var_name %in% c( "cint61"), "1 = 1. A little high
                                                           \n 2 = 2. Quite high
                                                           \n 3 = 3. Very high
                                                           \n -77  = Decline to Answer", `Value`)) %>%
         mutate(`Value` = if_else(var_name %in% c( "cint62"), "1 = 1. Smoked only a few times during the past 6 months
                                                           \n 2 = 2. Smoked regularly for a few weeks or more, then didn't for a few weeks or more or smoked for some time and then stopped
                                                           \n 3 = 3. Smoked about once a month
                                                           \n 4 = 4. Smoked on weekends or mostly weekends or a few times a week
                                                           \n 5 = 5. Smoked daily or almost daily
                                                           \n 6 = 6. Other
                                                           \n -77  = Decline to Answer", `Value`)) %>%
        mutate(`Value` = if_else(var_name %in% c( "cint63"), "1 = Yes
                                                           \n 0 = No
                                                           \n -55 = 3. NA -- not in school and not employed in last 6 months
                                                           \n -66 = Don't Know
                                                           \n -77  = Decline to Answer", `Value`)) %>%
          mutate(`Value` = if_else(var_name %in% c( "cint84"), "1 = 1. Stranger
                                                          \n 2 = 2. Acquaintance
                                                          \n 3 = 3. Friend
                                                          \n 4 = 4. Family member
                                                          \n 5 = 5. Romantic partner
                                                          \n 6 = 6. Other
                                                          \n -77 = Decline to Answer", `Value`))


```

```{r cint_substance-var-table, results ='asis'}
# Create the gt table object and apply generic theme
cint_substance_gt_table <- gt(cint_substance_word_long)

# Table-specific formatting (col width, names)
cint_substance_gt_table <- cint_substance_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description"
             #notes = "Notes"
  ) %>% 
  apply_tbl_theme() %>% 
  cols_width(description ~ px(300),
             var_name ~ px(100)
  ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(cint_substance_gt_table)
```


# CINT-COVID
<MARIA: you might want to switch this to full name to be consistent with other measure.> 
  
  
### CINT-S Description
  
  <MARIA> please insert a breif description for this measure 


* No items need to be reverse scored. 

* This is not a a standardized questionnaire, so missing data rule was not applied. And no subscale was computed. 



Reference:
  <Maria, please add a reference if needed> 
  
### CINT-COVID Variables
  
#### Value Labels
  
  
All CINT-COVID variables have the same response options.

```{r cint-covid-label-table, results = 'asis'}
cint_covid_label_df <- data.frame(
  value = c("0", "1", "-77"),
  label = c("No",
            "Yes",
    "Decline to Answer")) %>% 
  t() %>% 
  as.data.frame()

cint_covid_label_df <- setNames(cint_covid_label_df[-1, ], unlist(cint_covid_label_df[1, ]))


#create table
cint_covid_label_table <- cint_covid_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(cint_covid_label_table)
```

#### Survey Items

ALL CINT-COVID variables have the same response options.
Leading question: Since the coronavirus disease pandemic began, what has changed for you or your family?  
Note: Variables ending with _self indicate changes for TC themselves and ending with _other indicate changes for other family member
  
```{r CINT-covid-var-prep}
# Pull question wording from Qualtrics data
cint_covid_word <- qualtrics %>% 
  select(`CINTPregnancy Screen`, `CINTC1`: `CINTC14`) %>%
  mutate(across(everything(), ~., .names = "{.col}_other")) %>%
  # reorder
  select(
    CINTC1, CINTC1_other,
    CINTC2, CINTC2_other,
    CINTC3, CINTC3_other,
    CINTC4, CINTC4_other,
    CINTC5, CINTC5_other,
    CINTC6, CINTC6_other,
    CINTC7, CINTC7_other,
    CINTC8, CINTC8_other,
    CINTC9, CINTC9_other,
    CINTC10, CINTC10_other,
    CINTC11, CINTC11_other,
    CINTC12, CINTC12_other,
    CINTC13, CINTC13_other,
    CINTC14, CINTC14_other
  ) %>%
  rename_with(~ifelse(grepl("_other$", .), ., paste0(., "_self")), everything()) %>%
  slice(1)



#create table with variable name, description, and notes
cint_covid_word_long <- cint_covid_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = str_replace(description, "READ:", ""),
         description = str_replace(description, "DO NOT READ THE FOLLOWING TEXT ALOUD", "\n"),
         var_name = str_to_lower(var_name)) 

```

```{r cint_covid-var-table, results ='asis'}
# Create the gt table object and apply generic theme
cint_covid_gt_table <- gt(cint_covid_word_long)

# Table-specific formatting (col width, names)
cint_covid_gt_table <- cint_covid_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description"
             #notes = "Notes"
  ) %>% 
  apply_tbl_theme() %>% 
  cols_width(#description ~ px(300),
             var_name ~ px(100)
  ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(cint_covid_gt_table)
```

### Summary Statistics

#### Descriptive Statistics

Only missing percentage are presented 

```{r cint_covid-missing}
# Create subset of BSI items
cint_covid_data_subset <- complete %>%
  select(cint_pregnancy_screen:cint_income_support, cint_identity)

# Calculate the summary statistics for each variable
## mean is showing 2 decimals per authors
cint_covid_summary_data <- lapply(cint_covid_data_subset, function(x) {
  x <- replace(x, x < -40, NA)
  # mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  # sd_val <- round(sd(x, na.rm = TRUE), 2)
  # range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
   miss_val <- round(mean(is.na(x)) * 100, 2)
  # c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
  c(Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
cint_covid_summary_data <- as.data.frame(cint_covid_summary_data)

# Set items as first row
cint_covid_summary_data <- rbind(names(cint_covid_summary_data), cint_covid_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
cint_covid_tbl <- cint_covid_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Missing = "% Missing") %>% 
  # cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Missing"), align = "left") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
cint_covid_tbl

```


# SEX
<MARIA: you might want to switch this to full name to be consistent with other measure.> 
  
  
### CINT-S Description
  
  <MARIA> please insert a breif description for this measure 


* No items need to be reverse scored. 

* This is not a a standardized questionnaire, so missing data rule was not applied. And no subscale was computed. 



Reference:
  <Maria, please add a reference if needed> 
  
### SEX Variables
  
#### Value Labels and Survey Items 
  
  All SEX variables have multiple responses options, value labels for each variable can be found in the survey items table below. 

SEX survey items are presented in the following table:
  
  
```{r sex-var-prep}
# Pull question wording from Qualtrics data
sex_word <- qualtrics %>% 
  select(`S-Pregnancy Screen`: `S48`) %>%
  slice(1)

#create table with variable name, description, and notes
sex_word_long <- sex_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>%
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
  description = str_replace(description, "READ:", ""),
  description = str_replace(description, "DO NOT READ THE FOLLOWING TEXT ALOUD", ""),
       var_name = str_to_lower(var_name)) %>%
  # Edits Variable description and value
  mutate(description = if_else(var_name == "s1a", "What is your partner's current gender identity? - Selected Choice", description)) %>%
  mutate(description = if_else(var_name == "s1a_8_text", "What is your partner's current gender identity? - Prefer to self-identify - Text", description)) %>%
  mutate(description = if_else(var_name == "s2", "When did you start seeing your current partner? __ __ / __ __ __ __ month/years", description)) %>%
  mutate(description = if_else(var_name == "s2a", "How long, not counting time when you were broken up, have you and your partner been together? __ __ years", description)) %>%
  mutate(description = if_else(var_name == "s2b", " __ __ months", description)) %>%
  mutate(description = if_else(var_name == "s2c", "__ __ days", description)) %>%
  mutate(description = if_else(var_name == "s5a", "How long, not counting time when you were broken up, have you and your partner been living together? __ __ years", description)) %>%
  mutate(description = if_else(var_name == "s5b", " __ __ months", description)) %>%
  mutate(description = if_else(var_name == "s5c", "__ __ days", description)) %>%
  mutate(description = if_else(var_name == "s10", "Do you feel that you are: - Selected Choice", description)) %>%
  mutate(description = if_else(var_name == "s10_4_text", "Do you feel that you are: - 4 - Other: Please describe - Text", description)) %>%   mutate(description = if_else(var_name == "s13", "Do you have anyone else, not including your closest friends, that you talk to when you have a question or concern regarding birth control or safe sex practices?", description)) %>%
  mutate(description = if_else(var_name == "s14_8_text", "Do you have anyone else, not including your closest friends, that you talk to when you have a question or concern regarding birth control or safe sex practices? s", description)) %>%
  mutate(description = if_else(var_name == "s14", "Is that person a friend, relative, partner, or someone else? - Selected Choice", description)) %>%
  mutate(description = if_else(var_name == "s14_8_text", "Is that person a friend, relative, partner, or someone else? - 7 - other (please describe:) - Text", description)) %>%

  mutate(description = if_else(var_name == "s18", "How comfortable do you feel discussing the use of birth control or contraceptives to prevent pregnancy with someone you might have sex with?", description)) %>%
  mutate(description = if_else(var_name == "s28", "Were there any times during the last 6 months that you thought you might be pregnant?", description)) %>%
  mutate(description = if_else(var_name == "s29", "What happened?", description)) %>%
  mutate(description = if_else(var_name == "s30", "How many times, in the last six months, have you had sexual relations? __ __ __ times", description)) %>%
  mutate(description = if_else(var_name == "s31", "With how many different people (in the last 6 months)? __ __ __ partners", description)) %>%
  mutate(description = if_else(var_name == "s38", "In the last 6 months, have you had sexual relations with someone who injects drugs?", description)) %>%
  mutate(description = if_else(var_name == "s41", "How many times in the last 6 months? __ __ __ times", description)) %>%
  mutate(description = if_else(var_name == "s43", "In the last 6 months, when you've had intercourse with a male partner, what percentage of the time did you or your partner USE a birth control method specifically to prevent pregnancy?", description)) %>%
   mutate(description = if_else(var_name == "s45", "In the last 6 months, have you had oral sex with your female partners?", description)) %>%
   mutate(description = if_else(var_name == "s46", "In the last 6 months, have you had oral sex without using a dental dam with your female partner(s)?", description)) %>%

  mutate(`Value` = "") %>%
  mutate(`Value` = if_else(var_name %in% c("s-pregnancy-screen",
                                           "s1",
                                           "s3",
                                           "s4",
                                           "s6",
                                           "s13",
                                           "s22",
                                           "s23",
                                           "s26",
                                           "s35",
                                           "s38",
                                           "s39",
                                           "s40",
                                           "s44",
                                           "s45"), "1 = Yes
                                                 \n 0 = No
                                                 \n -66 = Don't Know
                                                 \n -77  = Decline to Answer", `Value`)) %>%
  mutate(`Value` = if_else(var_name %in% c( "s1a_8_text", "s2", "s2a", "s2b", "s2c", "s5", "s5a", "s5b", "s5c", "s7",
                                            "s8", "s10_4_text", "s14_8_text", "s15", "s25_8_text","s27", "s30", "s31", "s41", "s42", "s47" , "s48"), "Open Text Entry", `Value`)) %>%
    mutate(`Value` = if_else(var_name %in% c( "s-pregnancy screen"), "0 = No
        1 = Yes", `Value`)) %>%
  mutate(`Value` = if_else(var_name %in% c( "s28"), "0 = 2. No
        1 = 1. Yes
        2 = 4. I became pregnant prior to this last 6 months and knew that I was pregnant prior to this 6 month period
      -77 = Decline to Answer", `Value`)) %>%
  mutate(`Value` = if_else(var_name %in% c( "s1a"), "1 = Cisgender female or woman
        2 = Cisgender male or man
        3 = Female/Woman
        4 = Male/Man
        5 = Non-binary
        6 = Prefer to self-identify
        7 = Trans female/woman
        8 = Trans male/man
        -77 = Decline to Answer", `Value`)) %>%
  mutate(`Value` = if_else(var_name %in% c( "s9"), "1 = very little
                                                           \n 2 = not much
                                                           \n 3 = some
                                                           \n 4 = quite a lot
                                                           \n 5 = a great deal
                                                           \n -77  = Decline to Answer", `Value`)) %>%
  mutate(`Value` = if_else(var_name %in% c( "s10"), "1 = 1 - heterosexual (attracted to the opposite sex)
                                                           \n 2 = 2 - gay or lesbian (attracted to the same sex)
                                                           \n 3 = 3 - bi-sexual (attracted to both males and females)
                                                           \n 4 = 4 - Other: Please describe
                                                           \n -77  = Decline to Answer", `Value`)) %>%  # Maria: We might want to remove the number before variable lable
  mutate(`Value` = if_else(var_name %in% c( "s11", "s16"), " 0 = Never
                                                           \n 1 = Rarely
                                                           \n 2 = Sometimes
                                                           \n 3 = Often
                                                           \n 4 = Very Often
                                                           \n -77  = Decline to Answer", `Value`)) %>%
  mutate(`Value` = if_else(var_name %in% c( "s12", "s17", "s18", "s19"), "1 = Very Uncomfortable
                                                          \n 2 = Somewhat Uncomfortable
                                                          \n 3 = Neutral
                                                          \n 4 = Somewhat Comfortable
                                                          \n 5 = Very Comfortable
                                                          \n -77 = Decline to Answer", `Value`)) %>%
    mutate(`Value` = if_else(var_name %in% c( "s14"), "1 = 5 - counselor, teacher, doctor
                                                          \n 2 = 1 - friend
                                                          \n 3 = 7 - other (please describe:)
                                                          \n 4 = 4 - other relative
                                                          \n 5 = 6 - parent/parent figure
                                                          \n 6 = 2 - romantic partner
                                                          \n 7 = 3 - sister or brother
                                                          \n -77 = Decline to Answer", `Value`)) %>%
    mutate(`Value` = if_else(var_name %in% c( "s20"), "0 = 4 - Not at all Confident
                                                          \n 1 = 3 - A little Confident
                                                          \n 2 = 2 - Somewhat Confident
                                                          \n 3 = 1 - Very Confident
                                                          \n -77 = Decline to Answer", `Value`)) %>%
    mutate(`Value` = if_else(var_name %in% c( "s21", "s33", "s36", "s37"), "0 = 5 - Never or almost never
                                                          \n 1 = 4 - Occasionally
                                                          \n 2 = 3 - About half the time
                                                          \n 3 = 2 - Often
                                                          \n 4 = 1 - Always or almost always
                                                          \n -77 = Decline to Answer", `Value`)) %>%
      mutate(`Value` = if_else(var_name %in% c( "s24"), "0 = I did not have an STD (negative diagnosis)
                                                          \n 1 = Yes, I had a Sexually Transmitted Disease -STD  (positive diagnosis)
                                                          \n 2 = I don't know yet; still waiting for the results
                                                          \n -77 = Decline to Answer", `Value`)) %>%
    mutate(`Value` = if_else(var_name %in% c( "s25"), "1 = a. Genital herpes
                                                          \n 2 = b. Genital warts
                                                          \n 3 = c. AIDS/HIV
                                                          \n 4 = d. Hepatitis B
                                                          \n 5 = e. Gonorrhea (clap)
                                                          \n 6 = f. Syphilis
                                                          \n 7 = g. Chlamydia
                                                          \n 8 = h. Other: Specify
                                                          \n 9 = i. Don't Remember
                                                          \n -77 = Decline to Answer", `Value`)) %>%
        mutate(`Value` = if_else(var_name %in% c( "s28"), "0 = 2. No
                                                          \n 1 = 1. Yes
                                                          \n 2 = 4. I became pregnant prior to this last 6 months and knew that I was pregnant prior to this 6 month period
                                                          \n -77 = 3. Decline to Answer", `Value`)) %>%
    mutate(`Value` = if_else(var_name %in% c( "s29"), "1 = 1 - Went to doctor, Positive diagnosis
                                                          \n 2 = 2 - Went to doctor, Negative diagnosis
                                                          \n 3 = 3 - Went to doctor, Don't know
                                                          \n 4 = 4 - Took a home test, positive
                                                          \n 5 = 5 - Took a home test, negative
                                                          \n 6 = 6 - Took a home test, don't know
                                                          \n 7 = 7 - Did nothing, negative (period started)
                                                          \n 8 = 8 - Did nothing, don't know
                                                          \n -77 = Decline to Answer", `Value`)) %>%
  mutate(`Value` = if_else(var_name %in% c( "s32"), "1 = 1.Male, same age or younger
                                                          \n 2 = 2.Male, 1-2 years older
                                                          \n 3 = 3.Male, more than 2 years older
                                                          \n 4 = 4.Female, same age or younger
                                                          \n 5 = 5.Female, 1-2 years older
                                                          \n 6 = 6. Female, more than 2 years older
                                                          \n 7 = 7. Non-binary and/or Other Gender, same age or younger
                                                          \n 8 = 8. 7. Non-binary and/or Other Gender, 1-2 years older
                                                          \n 9 = 9. 7. Non-binary and/or Other Gender, more than 2 years older
                                                          \n -77 = Decline to Answer", `Value`)) %>%
  mutate(`Value` = if_else(var_name %in% c( "s34"), "0 = 1 Never 0%
                                                          \n 1 = 2 Rarely 1 - 15%
                                                          \n 2 = 3 Occasionally 15 - 40%
                                                          \n 3 = 4 About half the time 40 - 60%
                                                          \n 4 = 5 Usually 60 - 85%
                                                          \n 5 = 6 Most of the time 85 -99%
                                                          \n 6 = 7 Every single time 100%
                                                          \n -77 = Decline to Answer", `Value`)) %>%
  mutate(`Value` = if_else(var_name %in% c( "s43"), "0 = 1 Never 0%
                                                          \n 1 = 2 Rarely 1 - 15%
                                                          \n 2 = 3 Occasionally 15 - 40%
                                                          \n 3 = 4 About half the time 40 - 60%
                                                          \n 4 = 5 Usually 60 - 85%
                                                          \n 5 = 6 Most of the time 85 -99%
                                                          \n 6 = 7 Every single time 100%
                                                          \n 7 = 10 Not using birth control because I am currently pregnant
                                                          \n -66 = Don't Know
                                                          \n -77 = Decline to Answer", `Value`)) %>%
  mutate(`Value` = if_else(var_name %in% c( "s46"), "1 = Yes, had oral sex without a dental dam
                                                          \n 0 = No, oral sex and always used dental dam (stop here, you are finished)
                                                          \n -77 = Decline to Answer", `Value`))

```

```{r sex-var-table, results ='asis'}
# Create the gt table object and apply generic theme
sex_gt_table <- gt(sex_word_long)

# Table-specific formatting (col width, names)
sex_gt_table <- sex_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description"
             #notes = "Notes"
  ) %>% 
  apply_tbl_theme() %>% 
  cols_width(description ~ px(300),
             var_name ~ px(100)
  ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(sex_gt_table)
```

### Summary Statistics

#### Descriptive Statistics

Only missing percentage are presented 

```{r sex-missing}
# Create subset of BSI items
sex_data_subset <- complete %>%
  select(s_pregnancy_screen:s48)

# Calculate the summary statistics for each variable
## mean is showing 2 decimals per authors
sex_summary_data <- lapply(sex_data_subset, function(x) {
  x <- replace(x, x < -40, NA)
  # mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  # sd_val <- round(sd(x, na.rm = TRUE), 2)
  # range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  # c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
  c(Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
sex_summary_data <- as.data.frame(sex_summary_data)

# Set items as first row
sex_summary_data <- rbind(names(sex_summary_data), sex_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
sex_tbl <- sex_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Missing = "% Missing") %>% 
  # cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Missing"), align = "left") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
sex_tbl

```


# SOCINF_SUBSTANCES
<MARIA: you might want to switch this to full name to be consistent with other measure.> 
  
  
### SOCINF_SUBSTANCES Description
  
  <MARIA> please insert a breif description for this measure 


* No items need to be reverse scored. 

* This is not a a standardized questionnaire, so missing data rule was not applied. And no subscale was computed. 

This survey was not administered for participants who were incarcerated at the time of the assessment. 

Reference:
  <Maria, please add a reference if needed> 
  
### SOCINF_SUBSTANCES Variables
  
#### Value Labels and Survey Items 
  
  All SOCINF_SUBSTANCES variables have multiple responses options, value labels for each variable can be found in the survey items table below. 

SOCINF_SUBSTANCES survey items are presented in the following table:
  
  
```{r socinf_sub-var-prep}
# Pull question wording from Qualtrics data
socinf_sub_word <- qualtrics %>% 
  select(starts_with("SOC"), -`SOCINF Screen`) %>%
  rename(socinf_relationship_screener = `SOCINF Screen 2`) %>%
  rename(socinf_preg_screener = `SOCINF Preg-Screener`) %>%
  rename(SOCD2D = SOCD2d...1461) %>%
  rename(SOCD2E = SOCD2d...1462) %>%
  slice(1)

#create table with variable name, description, and notes
socinf_sub_word_long <- socinf_sub_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = str_replace(description, "\\d+[a-zA-Z]\\. ", ""),
         var_name = str_to_lower(var_name)) %>%
  # Edits Variable description and value
  mutate(description = if_else(var_name == "socinf_preg_screener", "ASSESSOR RESPOND: Is TC currently pregnant?", description)) %>%
  mutate(description = if_else(var_name == "socinf_relationship_screener", "Assessor Respond: Has the TC previously reported being in a romantic 
                               relationship in the past 6 months?", description)) %>%
  mutate(description = if_else(var_name == "soc2a", "Thinking about your partnerâ€™s use of tobacco (smoking or chewing) in the past 6 months, 
                               how often did/does your partner smoke, or chew, around you?", description)) %>% 
   mutate(description = if_else(var_name == "soc4a", "How much does your partner approve of your smoking/chewing tobacco? ", description)) %>%     
  mutate(description = if_else(var_name == "soc4b", "How often does your partner tell you that you should cut down or quit?", description)) %>%
  mutate(description = if_else(var_name == "socb2a", "Thinking about your partnerâ€™s use of alcohol (beer, wine or hard liquor) in the past 
                               6 months how often did/does your partner drink alcohol around you?", description)) %>%    
  mutate(description = if_else(var_name == "socb4a", "How much does your partner approve of your drinking alcohol?", description)) %>%    
  mutate(description = if_else(var_name == "socb4c", "How often does your partner tell you that you should cut down or quit?", description)) %>%  
  mutate(description = if_else(var_name == "socc2a", "Thinking about your partner's use of cannabis in the past 6 months, 
                               how often did/does your partner use cannabis around you?", description)) %>%
  mutate(description = if_else(var_name == "socc4a", "How much does your partner approve of your using cannabis?", description)) %>%
  mutate(description = if_else(var_name == "socc4c", "How often does your partner tell you that you should cut down or quit?", description)) %>%
  mutate(description = if_else(var_name == "socd2a", "Thinking about your partner's use of drugs (other than cannabis) in 
                               the past 6 months, how often did/does your partner use drugs around you?", description)) %>%  
  mutate(description = if_else(var_name == "socd2c", "How often did/does your partner try to avoid having the two of you go places, 
                               like parties or friendâ€™s houses, where people will be using drugs?", description)) %>%
  mutate(description = if_else(var_name == "socd4a", "How much does your partner approve of your using drugs?", description)) %>%
  mutate(Value = "") %>%
  mutate(Value = if_else(var_name %in% c("socinf_preg_screener", "socinf_relationship_screener"), "1 = Yes\n 0 = No" , `Value`)) %>%
  mutate(Value = if_else(grepl("\\d$", var_name), "1 = Yes\n0 = No\n -66 = Don't Know\n-77  = Decline to Answer", Value))%>%
  mutate(Value = if_else(grepl("[a-zA-Z]$", var_name), "0 = Never
        \n1 = Hardly ever
        \n2 = Sometimes
        \n3 = Often
      \n-55 = N/A
      \n-77 = Decline to Answer", `Value`)) %>%
  # TODO: Maria, socb4c, socc4c, socd4c doesn't have NA option
    mutate(Value = if_else(grepl("4c$", var_name), "0 = Never
       \n1 = Hardly ever
       \n2 = Sometimes
       \n3 = Often
      \n-77 = Decline to Answer", `Value`)) 


```

```{r socinf_sub-var-table, results ='asis'}
# Create the gt table object and apply generic theme
socinf_sub_gt_table <- gt(socinf_sub_word_long)

# Table-specific formatting (col width, names)
socinf_sub_gt_table <- socinf_sub_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description"
             #notes = "Notes"
  ) %>% 
  apply_tbl_theme() %>% 
  cols_width(description ~ px(300),
             var_name ~ px(100)
  ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(socinf_sub_gt_table)
```

### Summary Statistics

#### Descriptive Statistics

Only missing percentage are presented 

```{r socinf_sub-missing}
# Create subset of BSI items
socinf_sub_data_subset <- complete %>%
  select(starts_with("soc"), -socinf_general_screener)

# Calculate the summary statistics for each variable
## mean is showing 2 decimals per authors
socinf_sub_summary_data <- lapply(socinf_sub_data_subset, function(x) {
  x <- replace(x, x < -40, NA)
  # mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  # sd_val <- round(sd(x, na.rm = TRUE), 2)
  # range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  # c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
  c(Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
socinf_sub_summary_data <- as.data.frame(socinf_sub_summary_data)

# Set items as first row
socinf_sub_summary_data <- rbind(names(socinf_sub_summary_data), socinf_sub_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
socinf_sub_tbl <- socinf_sub_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Missing = "% Missing") %>% 
  # cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Missing"), align = "left") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
socinf_sub_tbl

```


# SOCINF_General
<MARIA: you might want to switch this to full name to be consistent with other measure.> 
  
  
### SOCINF_General Description
  
  <MARIA> please insert a breif description for this measure 


* No items need to be reverse scored. 

* This is not a a standardized questionnaire, so missing data rule was not applied. And no subscale was computed. 

This survey was not administered for participants who were incarcerated at the time of the assessment. 

Reference:
  <Maria, please add a reference if needed> 
  
### SOCINF_General Variables
  
#### Value Labels and Survey Items 
  
  All SOCINF_General variables have multiple responses options, value labels for each variable can be found in the survey items table below. 

SOCINF_General survey items are presented in the following table:
  
Leading question: Thinking about your partner, how often is it true that they:
```{r socinf_gen-var-prep}
# Pull question wording from Qualtrics data
socinf_gen_word <- qualtrics %>% 
  select(`SOCINF Screen`, starts_with("SG")) %>%
  rename(socinf_general_screener = `SOCINF Screen`) %>%
  slice(1)

#create table with variable name, description, and notes
socinf_gen_word_long <- socinf_gen_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = str_replace(description, "\\d+[a-zA-Z]\\. ", ""),
         var_name = str_to_lower(var_name)) %>%
  # Edits Variable description and value
  mutate(description = if_else(var_name == "sg13", "In general, is your partner against using tobacco (smoke or chew)?", description)) %>%
  mutate(description = if_else(var_name == "socinf_general_screener", "ASSESSOR RESPOND: Has TC reported being in a (romantic) relationship in the past 6 months?", description)) %>%
 
  mutate(Value = "") %>%
  mutate(Value = if_else(var_name %in% c("socinf_preg_screener", "socinf_relationship_screener"), "1 = Yes\n 0 = No" , `Value`)) %>%
  mutate(Value = if_else(var_name %in% c("sg1", "sg2","sg3", "sg5"), "0 = Never or almost never true
        \n1 = Hardly ever true
        \n2 = Sometimes true
        \n3 = Often true
        \n4 = Always or almost always true
      \n-55 = N/A
      \n-77 = Decline to Answer", `Value`)) %>%
  mutate(Value = if_else(var_name %in% c("sg4", "sg6","sg7", "sg8", "sg9", "sg10", "sg11", "sg12"), "0 = Never or almost never true
        \n1 = Hardly ever true
        \n2 = Sometimes true
        \n3 = Often true
        \n4 = Always or almost always true
      \n-77 = Decline to Answer", `Value`)) %>%
  mutate(Value = if_else(var_name %in% c("sg13a", "sg13b","sg13c", "sg13d"), "0 = Not at all against
       \n1 = A little against
       \n2 = Somewhat against
       \n3 = Very much against
      \n-77 = Decline to Answer", `Value`)) 


```

```{r socinf_gen-var-table, results ='asis'}
# Create the gt table object and apply generic theme
socinf_gen_gt_table <- gt(socinf_gen_word_long)

# Table-specific formatting (col width, names)
socinf_gen_gt_table <- socinf_gen_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description"
             #notes = "Notes"
  ) %>% 
  apply_tbl_theme() %>% 
  cols_width(description ~ px(300),
             var_name ~ px(100)
  ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(socinf_gen_gt_table)
```

### Summary Statistics

#### Descriptive Statistics

Only missing percentage are presented 

```{r socinf_gen-missing}
# Create subset of BSI items
socinf_gen_data_subset <- complete %>%
  select(starts_with("sg"))

# Calculate the summary statistics for each variable
## mean is showing 2 decimals per authors
socinf_gen_summary_data <- lapply(socinf_gen_data_subset, function(x) {
  x <- replace(x, x < -40, NA)
  # mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  # sd_val <- round(sd(x, na.rm = TRUE), 2)
  # range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  # c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
  c(Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
socinf_gen_summary_data <- as.data.frame(socinf_gen_summary_data)

# Set items as first row
socinf_gen_summary_data <- rbind(names(socinf_gen_summary_data), socinf_gen_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
socinf_gen_tbl <- socinf_gen_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Missing = "% Missing") %>% 
  # cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Missing"), align = "left") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
socinf_gen_tbl

```



# CTS Parent Child 
<MARIA: you might want to switch this to full name to be consistent with other measure.> 
  
  
### CTS Parent Child  Description
  
  <MARIA> please insert a breif description for this measure 


* All items need to be reverse scored. 



Reference:
  <Maria, please add a reference if needed> 
  
### CTS Parent Child  Variables
  
#### Value Labels

Response options for `cts parent screen`

```{r cts_pc-label-table, results = 'asis'}

cts_pc_label_df <- data.frame(
  value = c("1", "2"),
  label = c("Yes",
            "No")
) %>% 
  t() %>% 
  as.data.frame()


cts_pc_label_df <- setNames(cts_pc_label_df[-1, ], unlist(cts_pc_label_df[1, ]))


#create table
cts_pc_label_table <- cts_pc_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ pct(100)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(cts_pc_label_table)


```

Response option for `cts_pc1` -  `cts_pc23`.


```{r cts_pc-label-table-2, results = 'asis'}

cts_pc_label_df2 <- data.frame(
  value = c("0", "1", "2", "3", "4", "5", "6", "7"),
  label = c("None - has never happened/None",
            "Once",
            "Twice",
            "3-5 times",
            "6-10 times",
            "11-20 times",
            "More than 20 times",
            "Not in the past year, but it happened before")
) %>% 
  t() %>% 
  as.data.frame()


cts_pc_label_df2 <- setNames(cts_pc_label_df2[-1, ], unlist(cts_pc_label_df2[1, ]))


#create table
cts_pc_label_table2 <- cts_pc_label_df2 %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ px(180)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(cts_pc_label_table2)


```
  
####
CTS Parent Child  survey items are presented in the following table:
  
Leading question: Thinking about your partner, how often is it true that they:
```{r cts_pc-var-prep}
# Pull question wording from Qualtrics data
cts_pc_word <- qualtrics %>% 
  select(`CTS PARENT SCREEN`:A23) %>%
  slice(1)

#create table with variable name, description, and notes
cts_pc_word_long <- cts_pc_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = str_replace(description, "\\d+[a-zA-Z]\\. ", ""),
         var_name = str_to_lower(var_name),
         notes = as.character("")) %>% 
  # Edits Variable description and value
  # Min: NAMING UPDATE Maria changed these values so if it won't render check here; also remove note once it renders; need these to be updated to cts_pc from "a"
  mutate(description = if_else(var_name == "a parent screen", "Have you parented a child (under 18) in the past year?", description)) %>%
  mutate(notes = if_else(var_name %in% c("a1", "a2", "a3", "a4", "a5", "a6",
                                         "a7",  "a8",  "a9",  "a10" , "a11",  "a12" , "a13",              
                                        "a14", "a15", "a16", "a17"  ,"a18" , "a19"  ,"a20",              
                                        "a21", "a22", "a23"), paste0("This item should be reverse scored. `", var_name, "_r` is reverse scored"), notes)) 

```

```{r cts_pc-var-table, results ='asis'}
# Create the gt table object and apply generic theme
cts_pc_gt_table <- gt(cts_pc_word_long)

# Table-specific formatting (col width, names)
cts_pc_gt_table <- cts_pc_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description"
             #notes = "Notes"
  ) %>% 
  apply_tbl_theme() %>% 
  cols_width(description ~ px(300),
             var_name ~ px(100)
  ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(cts_pc_gt_table)
```

### Summary Statistics

#### Descriptive Statistics

Only missing percentage are presented 

```{r cts_pc-missing}
# Create subset of BSI items
cts_pc_data_subset <- complete %>%
  select(cts_parent_screen:cts_pc23)

# Calculate the summary statistics for each variable
## mean is showing 2 decimals per authors
cts_pc_summary_data <- lapply(cts_pc_data_subset, function(x) {
  x <- replace(x, x < -40, NA)
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
cts_pc_summary_data <- as.data.frame(cts_pc_summary_data)

# Set items as first row
cts_pc_summary_data <- rbind(names(cts_pc_summary_data), cts_pc_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
cts_pc_tbl <- cts_pc_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Missing = "% Missing") %>% 
   cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Missing"), align = "left") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
cts_pc_tbl

```



# Pregnancy and Childbirth Trauma (PCT)

### PCT Description
  
  <MARIA> please insert a breif description for this measure 


* No items need to be reverse scored. 




Reference:
  <Maria, please add a reference if needed> 
  
### PCT Variables
  
#### Value Labels

Response options for `cts parent screen`

```{r pct-label-table, results = 'asis'}

pct_label_df <- data.frame(
  value = c("1", "2"),
  label = c("Yes",
            "No")
) %>% 
  t() %>% 
  as.data.frame()


pct_label_df <- setNames(pct_label_df[-1, ], unlist(pct_label_df[1, ]))


#create table
pct_label_table <- pct_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ pct(100)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(pct_label_table)


```


  
#### PCT Survey Items
PCT survey items are presented in the following table:
  
Leading question: Thinking about your partner, how often is it true that they:
```{r pct-var-prep}
# Pull question wording from Qualtrics data
pct_word <- qualtrics %>% 
  select(P00a, starts_with("PCT")) %>%
  slice(1)

#create table with variable name, description, and notes
pct_word_long <- pct_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = str_replace(description, "READ:", ""),
         description = str_replace(description, "\\d+[a-zA-Z]\\. ", ""),
         var_name = str_to_lower(var_name),
         notes = as.character("")) %>%
  # Edits Variable description and value
  mutate(description = if_else(var_name == "p00a", "How many times have you been pregnant since we last talked on _____, 
                               (last interview date mm/yyyy)? Please include if you were pregnant at that interview.", description)) %>%
    mutate(description = if_else(var_name == "pct0", "Has TC reported any pregnancies?", description)) %>%
    mutate(description = if_else(var_name == "pct2e", "During which pregnancy or pregnancies did this occur?", description)) %>%
    mutate(description = if_else(var_name == "pct3e", "During which pregnancy or pregnancies did this occur?", description))
```

```{r pct-var-table, results ='asis'}
# Create the gt table object and apply generic theme
pct_gt_table <- gt(pct_word_long)

# Table-specific formatting (col width, names)
pct_gt_table <- pct_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description"
             #notes = "Notes"
  ) %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
   tab_options(table.width = pct(100))%>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(pct_gt_table)
```

### Summary Statistics

#### Descriptive Statistics

Only missing percentage are presented 

```{r pct-missing}
# Create subset of BSI items
pct_data_subset <- complete %>%
  select(p00a, starts_with("pct"))

# Calculate the summary statistics for each variable
## mean is showing 2 decimals per authors
pct_summary_data <- lapply(pct_data_subset, function(x) {
  x <- replace(x, x < -40, NA)
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
pct_summary_data <- as.data.frame(pct_summary_data)

# Set items as first row
pct_summary_data <- rbind(names(pct_summary_data), pct_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
pct_tbl <- pct_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Missing = "% Missing") %>% 
   cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Missing"), align = "left") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
pct_tbl

```



# Service Utilization Survey (SUS)

  
  
### SUS Description
  
  <MARIA> please insert a breif description for this measure 


* No items need to be reverse scored. 

* This is not a a standardized questionnaire, so missing data rule was not applied. And no subscale was computed. 



Reference:
  <Maria, please add a reference if needed> 
  
### SUS Variables
  
#### Value Labels

Response options for `sus7`

```{r sus-label-table, results = 'asis'}

sus_label_df <- data.frame(
  value = c("1", "0", "-66"),
  label = c("Yes",
            "No", 
            "Don't Know")
) %>% 
  t() %>% 
  as.data.frame()


sus_label_df <- setNames(sus_label_df[-1, ], unlist(sus_label_df[1, ]))


#create table
sus_label_table <- sus_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ pct(100)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(sus_label_table)


```

Response option for `sus8`, `sus11c`, `sus12c`,, `sus13b`, `sus15b`, `sus16b`, `sus17b`, `sus18b`, `sus19b`, `sus20b`, `sus21b`, `sus22b`, `sus23b`, `sus24b`, `sus25b`, `sus26c`.

```{r sus-label-table-2, results = 'asis'}

sus_label_df2 <- data.frame(
  value = c("1", "0"),
  label = c("Yes",
            "No")
) %>% 
  t() %>% 
  as.data.frame()


sus_label_df2 <- setNames(sus_label_df2[-1, ], unlist(sus_label_df2[1, ]))


#create table
sus_label_table2 <- sus_label_df2 %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ px(180)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(sus_label_table2)


```
Response option for `sus11b`, `sus11c2b`, `sus14a`,, `sus14b2`, `sus14c1`, `sus114d1`,`sus14e1`,`sus14f1`,`sus14g1`,`sus14h1`,`sus14i1`,`sus14j1`,`sus14k1`,`sus14l1`,`sus14m1`,`sus14n1`,`sus14o1`.

```{r sus-label-table-3, results = 'asis'}

sus_label_df3 <- data.frame(
  value = c("1", "2", "3"),
  label = c("1. Physical",
            "2. Mental/Psychological",
            "3. Substance Use")
) %>% 
  t() %>% 
  as.data.frame()


sus_label_df3 <- setNames(sus_label_df3[-1, ], unlist(sus_label_df3[1, ]))


#create table
sus_label_table3 <- sus_label_df3 %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ px(180)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(sus_label_table3)


```

Response option for `sus11`, `sus12`, `sus13`, `sus15`, `sus16`, `sus17`, `sus18`, `sus19`, `sus20`, `sus21`, `sus22`, `sus23`, `sus24`, `sus25`, `sus26b`.

```{r sus-label-table-4, results = 'asis'}

sus_label_df4 <- data.frame(
  value = c("1", "2", "3", "4"),
  label = c("1. Yes, available and accessed",
            "2. No, available but did not access",
            "3. No, attempted to access but experienced a barrier",
            "4. No, was not aware service was available" )
) %>% 
  t() %>% 
  as.data.frame()


sus_label_df4 <- setNames(sus_label_df4[-1, ], unlist(sus_label_df4[1, ]))


#create table
sus_label_table4 <- sus_label_df4 %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(everything() ~ px(180)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(sus_label_table4)


```

####
sus  survey items are presented in the following table:
  
Leading question: Thinking about your partner, how often is it true that they:
```{r sus-var-prep}
# Pull question wording from Qualtrics data
sus_word <- qualtrics %>% 
  select(starts_with("SUS")) %>%
  rename("sus14b1" = "SUS14b2...2226") %>%
  rename("sus14b2" = "SUS14b2...2227") %>%
  slice(1)

#create table with variable name, description, and notes
sus_word_long <- sus_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = str_replace(description, "\\d+[a-zA-Z]\\.", ""),
         description = str_replace(description, "\\d+[a-zA-Z]\\d+\\.", ""),
         description = str_replace(description, "READ: ", ""),
         description = str_replace(description, "READ: Please use the answer choices below the image of oranges on page 56.", ""),
         description = str_replace(description, "Assessor Note: If name is unknown, get type/class of drug or condition it was prescribed for.", ""),
         var_name = str_to_lower(var_name),
         notes = as.character("")) %>%
  # Edits Variable description and value
  mutate(description = if_else(var_name == "sus screen", "Has TC reported any previous or current 
                               pregnancies or previous or current parenting of any bio, step, or other children?", description)) %>%
  mutate(description = if_else(var_name == "sus - start", "Thinking about all of your children together, 
                               how many total contacts with child welfare have you had since your last interview on ______ 
                               (last interview date)? A contact can be a meeting, call or visit related to any of your 
                               children or other children whom you may be parenting. ____________ Contacts", description)) %>%
  mutate(description = if_else(var_name == "sus3", "How many of the contacts were a session 
                               with a child welfare caseworker? This could be regular/ongoing.", description)) %>%
  mutate(description = if_else(var_name == "sus10a", "Think of appearance number 1, was it for a hearing, 
                               continuance or court monitoring?", description)) %>%  
  mutate(description = if_else(var_name == "sus11", "The next part of the interview is about health and medical services for you.
                               For example, we are going to talk about how many times you have gone to a hospital, a doctor, a dentist, or a counselor.
                               Have you been to the emergency room or urgent care at a hospital since our last interview on ______ (last interview date)?", description)) %>%  
  mutate(description = if_else(var_name %in% c("sus11b","sus12b"), "What were the primary reason(s) for these visits?", description)) %>% 
  mutate(description = if_else(var_name == "sus12", "Did you go to the hospital for a scheduled procedure, surgery, 
                               test or other type of appointment since your last interview? (non-pregnancy-related)", description)) %>%
  mutate(description = if_else(var_name == "sus13", "Have you filled any prescriptions of any type in the past 6 months? 
                               Please think about anything that has been prescribed by a doctor, 
                               including medicines, antibiotics, inhalers, birth control pills, etc...", description)) %>%
  mutate(description = if_else(var_name == "sus14", "What is the name of prescription/drug #1?", description)) %>%
  mutate(description = if_else(var_name == "sus16a", "How many times?", description)) %>%
  mutate(description = if_else(var_name == "sus17", "Have you been in short stay or evaluation inpatient treatment. 
                               This includes stays up to 72 hours (3 days), such as detox? ", description)) %>%
  mutate(description = if_else(var_name == "sus18", "Have you been in residential treatment for substance abuse?", description)) 



        
```

```{r sus-var-table, results ='asis'}
# Create the gt table object and apply generic theme
sus_gt_table <- gt(sus_word_long)

# Table-specific formatting (col width, names)
sus_gt_table <- sus_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description"
             #notes = "Notes"
  ) %>% 
  apply_tbl_theme() %>% 
  cols_width(description ~ px(300),
             var_name ~ px(100)
  ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(sus_gt_table)
```

### Summary Statistics

#### Descriptive Statistics

Only missing percentage are presented 

```{r sus-missing}
# Create subset of BSI items
sus_data_subset <- complete %>%
  select(starts_with("sus"))

# Calculate the summary statistics for each variable
## mean is showing 2 decimals per authors
sus_summary_data <- lapply(sus_data_subset, function(x) {
  x <- replace(x, (x < 40 & x!= -55 & x!= -88), NA)    
  x <- replace(x, (x == "-44" | x== "-77" | x== "-99"), NA)
  # mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  # sd_val <- round(sd(x, na.rm = TRUE), 2)
  # range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  # c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
  c(Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
sus_summary_data <- as.data.frame(sus_summary_data)

# Set items as first row
sus_summary_data <- rbind(names(sus_summary_data), sus_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
sus_tbl <- sus_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Missing = "% Missing") %>% 
  # cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Missing"), align = "left") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
sus_tbl

```


# PCL
<MARIA: you might want to switch this to full name to be consistent with other measure.> 
  
  
### PCL Description
  
  <MARIA> please insert a breif description for this measure 


* All items need to be reverse scored. 

* This is not a a standardized questionnaire, so missing data rule was not applied. And no subscale was computed. 



Reference:
  <Maria, please add a reference if needed> 
  
### PCL Variables
  
#### Value Labels


  
####
PCL survey items are presented in the following table:
  
Leading question: Thinking about your partner, how often is it true that they:
```{r pcl-var-prep}
# Pull question wording from Qualtrics data
pcl_word <- qualtrics %>% 
  select(starts_with("pcl")) %>%
  slice(1)

#create table with variable name, description, and notes
pcl_word_long <- pcl_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = str_replace(description, "\\d+[a-zA-Z]\\. ", ""),
         description = str_replace(description, "READ: Please use the answer choices below follow up 1.", ""),
         description = str_replace(description, "\\d+[a-zA-Z]\\d+ READ:", ""),
         var_name = str_to_lower(var_name),
         notes = as.character("")) %>% 
  # Edits Variable description and value
  mutate(description = if_else(var_name == "pcl1", "Natural disaster (for example, flood, hurricane, tornado, earthquake).", description)) %>%
  mutate(description = if_else(var_name == "pcl1", "How old were you when this occurred?.", description))
  
 # mutate(Value = if_else(var_name %in% everything(), paste0("This item should be reverse scored. ", var_name, "_r is reverse scored", `Value`)) 


```

```{r pcl-var-table, results ='asis'}
# Create the gt table object and apply generic theme
pcl_gt_table <- gt(pcl_word_long)

# Table-specific formatting (col width, names)
pcl_gt_table <- pcl_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description"
             #notes = "Notes"
  ) %>% 
  apply_tbl_theme() %>% 
  cols_width(description ~ px(300),
             var_name ~ px(100)
  ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(pcl_gt_table)
```

### Summary Statistics

#### Descriptive Statistics

Only missing percentage are presented 

```{r pcl-missing}
# Create subset of BSI items
pcl_data_subset <- complete %>%
  select(starts_with("sg"))

# Calculate the summary statistics for each variable
## mean is showing 2 decimals per authors
pcl_summary_data <- lapply(pcl_data_subset, function(x) {
  x <- replace(x, x < -40, NA)
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
pcl_summary_data <- as.data.frame(pcl_summary_data)

# Set items as first row
pcl_summary_data <- rbind(names(pcl_summary_data), pcl_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
pcl_tbl <- pcl_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Missing = "% Missing") %>% 
  # cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Missing"), align = "left") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
pcl_tbl

```
  
# References 


